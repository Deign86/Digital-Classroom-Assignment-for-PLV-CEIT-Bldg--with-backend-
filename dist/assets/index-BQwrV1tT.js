const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminDashboard-BKJZ7XxV.js","assets/radix-vendor-Btpt_kqv.js","assets/react-vendor-D3F3s8fL.js","assets/ProfileSettings-BaI9lWXl.js","assets/phosphor-icons-rxxn67t3.js","assets/lucide-react-DfPWT9_p.js","assets/utils-vendor-Cr9tsIwC.js","assets/analytics-sonner-DyzmvkVy.js","assets/firebase-firestore-BGtz343l.js","assets/firebase-core-M-mnVknd.js","assets/firebase-auth-MTDr6AF2.js","assets/firebase-functions-D39bosM8.js","assets/FacultyDashboard-l0L_WTk8.js","assets/FacultyDashboard-D27E_wyY.css"])))=>i.map(i=>d[i]);
import{r as u,j as a,S as ds,P as us,T as kt,I as ms,b as fs,C as Rt,V as ps,c as At,d as gs,e as hs,f as ws,g as ys,h as xs,i as bs,L as It,k as Ct,l as Tt,m as vs,n as Pt,o as st,O as Ut,p as Lt,q as Dt,D as _t,s as Ss,t as Es,u as Ft,v as qt,A as Bt,w as Ot,x as Ns,y as js,z as ks,B as Rs,E as As,R as Oe}from"./radix-vendor-Btpt_kqv.js";import{a as Is,g as Cs}from"./react-vendor-D3F3s8fL.js";import{t as Ts,c as Ps,a as Us}from"./utils-vendor-Cr9tsIwC.js";import{C as $t,a as Ls,b as Ds,X as _s,M as Qe,c as Fs,d as oe,L as Ce,U as ft,e as qs,R as Bs}from"./lucide-react-DfPWT9_p.js";import{t as x,T as Os}from"./analytics-sonner-DyzmvkVy.js";import{g as $s,d as T,a as me,c as P,q as F,w as z,b as V,u as re,e as H,f as Re,o as q,s as Ke,h as Ae}from"./firebase-firestore-BGtz343l.js";import{s as X,E as Ms,r as zs,u as Vs,c as Hs,a as Gs,b as pt,d as Qs,e as gt,f as ht,g as Ks,o as Ys}from"./firebase-auth-MTDr6AF2.js";import{B as Ws,D as Js,l as Zs}from"./firebase-core-M-mnVknd.js";import{g as Be,h as ke}from"./firebase-functions-D39bosM8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();var Te={},wt;function Xs(){if(wt)return Te;wt=1;var e=Is();return Te.createRoot=e.createRoot,Te.hydrateRoot=e.hydrateRoot,Te}var ea=Xs();const ta=Cs(ea),sa="modulepreload",aa=function(e){return"/"+e},yt={},Mt=function(t,s,r){let n=Promise.resolve();if(s&&s.length>0){let l=function(m){return Promise.all(m.map(g=>Promise.resolve(g).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),i=c?.nonce||c?.getAttribute("nonce");n=l(s.map(m=>{if(m=aa(m),m in yt)return;yt[m]=!0;const g=m.endsWith(".css"),S=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${S}`))return;const E=document.createElement("link");if(E.rel=g?"stylesheet":sa,g||(E.as="script"),E.crossOrigin="",E.href=m,i&&E.setAttribute("nonce",i),document.head.appendChild(E),g)return new Promise((y,R)=>{E.addEventListener("load",y),E.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(c){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=c,window.dispatchEvent(i),!i.defaultPrevented)throw c}return n.then(c=>{for(const i of c||[])i.status==="rejected"&&o(i.reason);return t().catch(o)})};var xt={},ra="@vercel/analytics",na="1.5.0",oa=()=>{window.va||(window.va=function(...t){(window.vaq=window.vaq||[]).push(t)})};function zt(){return typeof window<"u"}function Vt(){try{const e="production"}catch{}return"production"}function ia(e="auto"){if(e==="auto"){window.vam=Vt();return}window.vam=e}function ca(){return(zt()?window.vam:Vt())||"production"}function Ye(){return ca()==="development"}function la(e){return e.scriptSrc?e.scriptSrc:Ye()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function da(e={debug:!0}){var t;if(!zt())return;ia(e.mode),oa(),e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend));const s=la(e);if(document.head.querySelector(`script[src*="${s}"]`))return;const r=document.createElement("script");r.src=s,r.defer=!0,r.dataset.sdkn=ra+(e.framework?`/${e.framework}`:""),r.dataset.sdkv=na,e.disableAutoTrack&&(r.dataset.disableAutoTrack="1"),e.endpoint?r.dataset.endpoint=e.endpoint:e.basePath&&(r.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(r.dataset.dsn=e.dsn),r.onerror=()=>{const n=Ye()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${s}. ${n}`)},Ye()&&e.debug===!1&&(r.dataset.debug="false"),document.head.appendChild(r)}function ua({route:e,path:t}){var s;(s=window.va)==null||s.call(window,"pageview",{route:e,path:t})}function ma(){if(!(typeof process>"u"||typeof xt>"u"))return xt.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function Pe(e){return u.useEffect(()=>{var t;e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend))},[e.beforeSend]),u.useEffect(()=>{da({framework:e.framework||"react",basePath:e.basePath??ma(),...e.route!==void 0&&{disableAutoTrack:!0},...e})},[]),u.useEffect(()=>{e.route&&e.path&&ua({route:e.route,path:e.path})},[e.route,e.path]),null}function U(...e){return Ts(Ps(e))}const at=Us("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),le=u.forwardRef(({className:e,variant:t,size:s,asChild:r=!1,...n},o)=>{const c=r?ds:"button";return a.jsx(c,{"data-slot":"button",className:U(at({variant:t,size:s,className:e})),ref:o,...n})});le.displayName="Button";function ie({className:e,type:t,...s}){return a.jsx("input",{type:t,"data-slot":"input",className:U("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...s})}var fa="Label",Ht=u.forwardRef((e,t)=>a.jsx(us.label,{...e,ref:t,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));Ht.displayName=fa;var pa=Ht;function se({className:e,...t}){return a.jsx(pa,{"data-slot":"label",className:U("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...t})}function ga({...e}){return a.jsx(xs,{"data-slot":"select",...e})}function ha({...e}){return a.jsx(bs,{"data-slot":"select-value",...e})}const Gt=u.forwardRef(({className:e,size:t="default",children:s,...r},n)=>a.jsxs(kt,{ref:n,"data-slot":"select-trigger","data-size":t,className:U("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r,children:[s,a.jsx(ms,{asChild:!0,children:a.jsx($t,{className:"size-4 opacity-50"})})]}));Gt.displayName=kt.displayName;const Qt=u.forwardRef(({className:e,children:t,position:s="popper",...r},n)=>a.jsx(fs,{children:a.jsxs(Rt,{ref:n,"data-slot":"select-content",className:U("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...r,children:[a.jsx(wa,{}),a.jsx(ps,{className:U("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),a.jsx(ya,{})]})}));Qt.displayName=Rt.displayName;const Kt=u.forwardRef(({className:e,children:t,...s},r)=>a.jsxs(At,{ref:r,"data-slot":"select-item",className:U("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",e),...s,children:[a.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:a.jsx(gs,{children:a.jsx(Ls,{className:"size-4"})})}),a.jsx(hs,{children:t})]}));Kt.displayName=At.displayName;function wa({className:e,...t}){return a.jsx(ws,{"data-slot":"select-scroll-up-button",className:U("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(Ds,{className:"size-4"})})}function ya({className:e,...t}){return a.jsx(ys,{"data-slot":"select-scroll-down-button",className:U("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx($t,{className:"size-4"})})}const xa=vs,Yt=u.forwardRef(({className:e,...t},s)=>a.jsx(It,{ref:s,className:U("inline-flex h-12 items-center justify-center rounded-xl bg-gray-100 p-1 text-gray-600",e),...t}));Yt.displayName=It.displayName;const We=u.forwardRef(({className:e,...t},s)=>a.jsx(Ct,{ref:s,className:U("inline-flex items-center justify-center whitespace-nowrap rounded-lg px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-900 data-[state=active]:shadow-sm hover:text-gray-900",e),...t}));We.displayName=Ct.displayName;const Je=u.forwardRef(({className:e,...t},s)=>a.jsx(Tt,{ref:s,className:U("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Je.displayName=Tt.displayName;function ba({...e}){return a.jsx(Es,{"data-slot":"dialog",...e})}const Wt=u.forwardRef(({...e},t)=>a.jsx(Pt,{ref:t,"data-slot":"dialog-trigger",...e}));Wt.displayName=Pt.displayName;function va({...e}){return a.jsx(Ss,{"data-slot":"dialog-portal",...e})}const Sa=u.forwardRef(({...e},t)=>a.jsx(st,{ref:t,"data-slot":"dialog-close",...e}));Sa.displayName=st.displayName;const Jt=u.forwardRef(({className:e,...t},s)=>a.jsx(Ut,{ref:s,"data-slot":"dialog-overlay",className:U("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t}));Jt.displayName=Ut.displayName;const Zt=u.forwardRef(({className:e,children:t,...s},r)=>a.jsxs(va,{"data-slot":"dialog-portal",children:[a.jsx(Jt,{}),a.jsxs(Lt,{ref:r,"data-slot":"dialog-content",className:U("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...s,children:[t,a.jsxs(st,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[a.jsx(_s,{}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Zt.displayName=Lt.displayName;function Ea({className:e,...t}){return a.jsx("div",{"data-slot":"dialog-header",className:U("flex flex-col gap-2 text-center sm:text-left",e),...t})}const Xt=u.forwardRef(({className:e,...t},s)=>a.jsx(Dt,{ref:s,"data-slot":"dialog-title",className:U("text-lg leading-none font-semibold",e),...t}));Xt.displayName=Dt.displayName;const es=u.forwardRef(({className:e,...t},s)=>a.jsx(_t,{ref:s,"data-slot":"dialog-description",className:U("text-muted-foreground text-sm",e),...t}));es.displayName=_t.displayName;const Na={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyApNtEkpd38KXPSS60lAQE8dBjZBd8orPQ",VITE_FIREBASE_APP_ID:"1:361326467083:web:f83bf156d030dcf463cf0e",VITE_FIREBASE_AUTH_DOMAIN:"plv-classroom-assigment.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"361326467083",VITE_FIREBASE_PROJECT_ID:"plv-classroom-assigment",VITE_FIREBASE_STORAGE_BUCKET:"plv-classroom-assigment.firebasestorage.app"},ja=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID","VITE_FIREBASE_STORAGE_BUCKET","VITE_FIREBASE_MESSAGING_SENDER_ID","VITE_FIREBASE_APP_ID"],ka=()=>{const e=[],t=ja.reduce((s,r)=>{const n=Na[r];return n?s[r]=n:e.push(r),s},{});if(e.length>0)throw new Error(`Missing Firebase environment variables: ${e.join(", ")}. Please create a .env file based on .env.example and restart the dev server.`);return t},Ra=()=>{const e=ka(),t={apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID};try{return Ws().length===0?(console.log("Initializing Firebase app with projectId:",t.projectId),Js(t)):Zs()}catch(s){throw console.error("Failed to initialize Firebase app:",s),new Error(`Firebase initialization failed: ${s instanceof Error?s.message:"Unknown error"}`)}};let ze=null,Ve=null;const we=()=>(ze||(ze=Ra()),ze),Aa=()=>{if(!Ve)try{const e=we();Ve=$s(e),console.log("Firestore instance initialized for project:",e.options.projectId)}catch(e){throw console.error("Failed to initialize Firestore:",e),new Error(`Firestore initialization failed: ${e instanceof Error?e.message:"Unknown error"}`)}return Ve};function Fe(e){if(!e)return"";const[t,s]=e.split(":").map(Number),r=t>=12?"PM":"AM";return`${t===0?12:t>12?t-12:t}:${s.toString().padStart(2,"0")} ${r}`}function ye(e){if(!e)return"";const[t,s]=e.split(" "),[r,n]=t.split(":").map(Number);let o=r;return s==="AM"&&r===12?o=0:s==="PM"&&r!==12&&(o=r+12),`${o.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}function fr(){const e=[];for(let t=7;t<=20;t++)for(let s=0;s<60;s+=30){const r=`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;e.push(Fe(r))}return e}function pr(e){const t=ye(e),[s]=t.split(":").map(Number);return s>=7&&s<=20}function gr(e,t){const s=ye(e),r=ye(t),[n,o]=s.split(":").map(Number),[c,i]=r.split(":").map(Number),l=n*60+o,S=(c*60+i-l)/60;return S>=.5&&S<=8}function hr(e,t){if(!e)return t;const s=ye(e),[r,n]=s.split(":").map(Number),o=r*60+n;return t.filter(c=>{const i=ye(c),[l,m]=i.split(":").map(Number),g=l*60+m,E=(g-o)/60;return g>o&&E<=8&&l<=20})}function wr(e,t){return`${e} - ${t}`}function Ne(e,t){if(!e||!t)return!1;const s=new Date,[r,n,o]=e.split("-").map(Number),c=ye(t),[i,l]=c.split(":").map(Number),m=new Date(r,n-1,o,i,l,0,0),g=new Date(s.getTime()+300*1e3);return m<=g}let He=null;const ee=()=>{if(!He){const e=we();He=Ks(e)}return He},b={USERS:"users",CLASSROOMS:"classrooms",BOOKING_REQUESTS:"bookingRequests",SCHEDULES:"schedules",SIGNUP_REQUESTS:"signupRequests",SIGNUP_HISTORY:"signupHistory"};let Ue=null,Le=null;const v=()=>{if(Le)throw Le;if(Ue)return Ue;try{return Ue=Aa(),Ue}catch(e){throw Le=e instanceof Error?e:new Error(String(e)),Le}};let D=null;const Ze=new Set,Ia={classrooms:new Set,bookingRequests:new Set,schedules:new Set,signupRequests:new Set,users:new Set};let Z=[];const J=()=>{console.log(`Unsubscribing from ${Z.length} real-time listeners.`),Z.forEach(e=>{try{e()}catch(t){console.warn("Error during listener unsubscribe:",t)}}),Z=[]},Ca=(e,t)=>{const s=v(),r=P(s,b.CLASSROOMS),n=F(r,q("name")),o=Ae(n,c=>{try{const i=c.docs.map(l=>{const m=l.data();return ve(l.id,m)});e(i)}catch(i){console.error("Classrooms listener error:",i),t?.(i instanceof Error?i:new Error(String(i)))}},c=>{console.error("Classrooms listener error:",c),t?.(c)});return Z.push(o),o},bt=(e,t,s)=>{const r=v(),n=P(r,b.BOOKING_REQUESTS);let o;s?o=F(n,z("facultyId","==",s),q("requestDate","desc")):o=F(n,q("requestDate","desc"));const c=Ae(o,i=>{try{const l=i.docs.map(m=>{const g=m.data();return ge(m.id,g)});e(l)}catch(l){console.error("BookingRequests listener error:",l),t?.(l instanceof Error?l:new Error(String(l)))}},i=>{console.error("BookingRequests listener error:",i),t?.(i)});return Z.push(c),c},vt=(e,t,s)=>{const r=v(),n=P(r,b.SCHEDULES);let o;s?o=F(n,z("facultyId","==",s),q("date"),q("startTime")):o=F(n,q("date"),q("startTime"));const c=Ae(o,i=>{try{const l=i.docs.map(m=>{const g=m.data();return he(m.id,g)});e(l)}catch(l){console.error("Schedules listener error:",l),t?.(l instanceof Error?l:new Error(String(l)))}},i=>{console.error("Schedules listener error:",i),t?.(i)});return Z.push(c),c},Ta=(e,t)=>{const s=v(),r=P(s,b.SIGNUP_REQUESTS),n=F(r,q("requestDate","desc")),o=Ae(n,c=>{try{const i=c.docs.map(l=>{const m=l.data();return ce(l.id,m)});e(i)}catch(i){console.error("SignupRequests listener error:",i),t?.(i instanceof Error?i:new Error(String(i)))}},c=>{console.error("SignupRequests listener error:",c),t?.(c)});return Z.push(o),o},Pa=(e,t)=>{const s=v(),r=P(s,b.USERS),n=F(r,q("name")),o=Ae(n,c=>{try{const i=c.docs.map(l=>{const m=ue(l);return ae(l.id,m)});e(i)}catch(i){console.error("Users listener error:",i),t?.(i instanceof Error?i:new Error(String(i)))}},c=>{console.error("Users listener error:",c),t?.(c)});return Z.push(o),o},$=e=>{Ze.forEach(t=>{try{t(e)}catch(s){console.error("Auth listener error:",s)}})},_=()=>new Date().toISOString(),$e=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0)),Xe=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0));class St extends Error{status;constructor(t,s){super(s),this.name="AuthStatusError",this.status=t}}const ae=(e,t)=>({id:e,email:t.email,name:t.name,role:t.role,department:t.department,status:t.status,failedLoginAttempts:t.failedLoginAttempts||0,accountLocked:t.accountLocked||!1,lockedUntil:t.lockedUntil}),ue=e=>{const t=e.data();if(!t)throw new Error("User record is missing.");return t},Ua=async e=>{const t=e.toLowerCase(),s=v(),r=P(s,b.USERS),n=F(r,z("emailLower","==",t)),o=await V(n);if(o.empty)return null;const c=o.docs[0],i=ue(c);return{id:c.id,record:i}},La=async e=>{const t=v(),s=T(t,b.USERS,e),r=await H(s);if(!r.exists())return null;const n=ue(r);return ae(r.id,n)},ve=(e,t)=>({id:e,name:t.name,capacity:t.capacity,equipment:Array.isArray(t.equipment)?t.equipment:[],building:t.building,floor:t.floor,isAvailable:t.isAvailable}),ge=(e,t)=>({id:e,facultyId:t.facultyId,facultyName:t.facultyName,classroomId:t.classroomId,classroomName:t.classroomName,date:t.date,startTime:t.startTime,endTime:t.endTime,purpose:t.purpose,status:t.status,requestDate:t.requestDate,adminFeedback:t.adminFeedback}),he=(e,t)=>({id:e,classroomId:t.classroomId,classroomName:t.classroomName,facultyId:t.facultyId,facultyName:t.facultyName,date:t.date,startTime:t.startTime,endTime:t.endTime,purpose:t.purpose,status:t.status}),ce=(e,t)=>({id:e,userId:t.uid,email:t.email,name:t.name,department:t.department,requestDate:t.requestDate,status:t.status,adminFeedback:t.adminFeedback,resolvedAt:t.resolvedAt}),De=(e,t)=>({id:e,userId:t.uid,email:t.email,name:t.name,department:t.department,requestDate:t.requestDate,status:t.status,adminFeedback:t.adminFeedback,resolvedAt:t.resolvedAt,processedBy:t.processedBy});let Et=!1,et=null,Q=null,Se=!1;const Ee=async(e,t={})=>{const s=v(),r=T(s,b.USERS,e.uid),n=await H(r),o=t.email??e.email;if(!o)throw new Error("Authenticated user is missing an email address.");const c=o.toLowerCase(),i=_();if(!n.exists()){const E=t.role==="admin";let y=E?"approved":"pending",R=t.department,N=t.name??e.displayName??o;if(!E&&!t.status)try{const L=await qe.getById(e.uid);L&&L.status==="approved"&&(y="approved",R=R||L.department,N=t.name||L.name||e.displayName||o)}catch(L){console.warn("Could not fetch signup request for user:",e.uid,L)}const C={email:o,emailLower:c,name:N,role:t.role??(E?"admin":"faculty"),department:R,status:t.status??y,photoURL:t.photoURL??e.photoURL??void 0,lastSignInAt:i,createdAt:i,updatedAt:i},M=Xe(C);return await Ke(r,M),M}const l=ue(n),m={...t,lastSignInAt:i,updatedAt:i};m.role===void 0&&(m.role=l.role),m.status===void 0&&(m.status=l.status),e.displayName&&e.displayName!==l.name&&(m.name=e.displayName),e.photoURL&&e.photoURL!==l.photoURL&&(m.photoURL=e.photoURL);const g=Xe(m);return Object.keys(g).some(E=>E!=="lastSignInAt"&&E!=="updatedAt"&&g[E]!==l[E])||!l.lastSignInAt?(await re(r,g),{...l,...g}):l},xe=()=>{if(Et)return;Et=!0,et=new Promise(t=>{Q=t});const e=ee();Ys(e,async t=>{if(Se){console.log("Auth state change suppressed temporarily (registration/reactivation flow)"),Q&&(Q(),Q=null);return}if(!t){D=null,$(null),J(),Q&&(Q(),Q=null);return}try{try{await t.getIdToken(!0)}catch(n){console.error("Token refresh failed in auth listener:",n),D=null,$(null),J(),Q&&(Q(),Q=null);return}const s=await Ee(t),r=ae(t.uid,s);r.status!=="approved"?(D=null,$(null),J()):(D=r,$(r))}catch(s){console.error("Auth state listener error:",s),D=null,$(null),J()}finally{Q&&(Q(),Q=null)}})},Da=e=>{switch(e.code){case"auth/invalid-email":return"The provided email address is invalid.";case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":return"Invalid email or password.";case"auth/email-already-in-use":return"This email is already registered.";case"auth/weak-password":return"Password should be at least 6 characters long.";case"auth/too-many-requests":return"Too many attempts. Please try again later.";case"auth/requires-recent-login":return"Please sign in again before updating your password.";default:return"An authentication error occurred."}},K={async handleRejectedUserReactivation(e,t,s,r){if(!await je.getByEmail(e))return console.log(`Reactivation attempt for non-existent user ${e}. Treating as new registration.`),this.registerFaculty(e,t,s,r);xe();const o=ee();Se=!0;try{const i=(await pt(o,e,t)).user;i&&await gt(i,{displayName:s}).catch(()=>{});const l=await Ee(i,{email:e,name:s,department:r,role:"faculty",status:"pending"}),m=v(),g=_(),S={uid:i.uid,email:l.email,emailLower:l.emailLower,name:l.name,department:r,status:"pending",requestDate:g,createdAt:g,updatedAt:g};return await Ke(T(m,b.SIGNUP_REQUESTS,i.uid),S),await ht(i).catch(()=>{}),{request:ce(i.uid,S)}}finally{Se=!1,await X(o).catch(()=>{}),D=null,$(null)}},async registerFaculty(e,t,s,r){xe();const n=ee();Se=!0;const c=(await Qs(n,e,t)).user;try{c&&await gt(c,{displayName:s}).catch(()=>{});const i=await Ee(c,{email:e,name:s,department:r,role:"faculty",status:"pending"}),l=v(),m=_(),g={uid:c.uid,email:i.email,emailLower:i.emailLower,name:i.name,department:r,status:"pending",requestDate:m,createdAt:m,updatedAt:m};return await Ke(T(l,b.SIGNUP_REQUESTS,c.uid),g),await ht(c).catch(()=>{}),{request:ce(c.uid,g)}}catch(i){console.error("Signup failed, cleaning up Auth user:",i);try{await c.delete(),console.log("Auth user deleted successfully")}catch(l){console.error("Failed to delete Auth user:",l)}throw i}finally{Se=!1,await X(n).catch(()=>{}),D=null,$(null)}},async signIn(e,t){xe();const s=ee(),r=v(),n=Be(we());try{const c=(await pt(s,e,t)).user;try{await c.getIdToken(!0)}catch(m){console.warn("Failed to refresh token on sign in:",m)}const i=await Ee(c),l=ae(c.uid,i);if(l.accountLocked&&l.lockedUntil){const m=new Date(l.lockedUntil),g=new Date;if(g<m){await X(s),D=null,$(null);const S=Math.ceil((m.getTime()-g.getTime())/6e4);throw new Error(`Account is locked due to too many failed login attempts. Please try again in ${S} minute${S!==1?"s":""}.`)}}if(l.status!=="approved")throw await X(s),D=null,$(null),J(),new St(l.status,l.status==="pending"?"Your account is awaiting administrator approval.":"Your account was rejected. Please contact the administrator.");try{await ke(n,"resetFailedLogins")(),console.log("âœ… Failed login attempts reset")}catch(m){console.warn("âš ï¸ Failed to call resetFailedLogins cloud function:",m);try{const g=T(r,b.USERS,c.uid);await re(g,{failedLoginAttempts:0,accountLocked:!1,lockedUntil:null,lastSignInAt:_(),updatedAt:_()})}catch(g){console.error("Failed to reset login attempts (fallback):",g)}}return D=l,$(l),l}catch(o){if(o instanceof St)throw o;if(console.log("ðŸ” Login error details:",{error:o,code:o&&typeof o=="object"&&"code"in o?o.code:"no-code",message:o instanceof Error?o.message:"unknown"}),o&&typeof o=="object"&&"code"in o&&o.code?.startsWith("auth/")){console.log("ðŸ”’ Calling trackFailedLogin for:",e);try{const m=(await ke(n,"trackFailedLogin")({email:e})).data;if(console.log("âœ… trackFailedLogin response:",m),m.locked)throw new Error(m.message||"Account locked due to too many failed login attempts. Please try again in 30 minutes.");if(m.message)throw new Error(m.message)}catch(i){if(console.error("âŒ trackFailedLogin error:",i),i instanceof Error&&(i.message.includes("Account locked")||i.message.includes("attempts remaining")))throw i;console.warn("âš ï¸ Failed to track login attempt:",i)}}throw o instanceof Error&&(o.message.includes("Account locked")||o.message.includes("attempts remaining"))?o:new Error("Invalid credentials. Please check your email and password.")}},async signOut(){const e=ee();await X(e).catch(()=>{}),D=null,$(null),J()},async resetPassword(e){const t=ee();try{return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(await Gs(t,e),{success:!0,message:"Password reset instructions sent. If an account exists with this email, you will receive a link shortly."}):{success:!1,message:"Please enter a valid email address."}}catch(s){if(console.error("Password reset error:",s),s&&typeof s=="object"&&"code"in s)switch(s.code){case"auth/invalid-email":return{success:!1,message:"Please enter a valid email address."};case"auth/too-many-requests":return{success:!1,message:"Too many reset attempts. Please try again later."};case"auth/missing-email":return{success:!1,message:"Please enter an email address."};default:return{success:!1,message:"Unable to process request. Please try again or contact support."}}return{success:!1,message:"An unexpected error occurred. Please try again."}}},async confirmPasswordReset(e,t){const s=ee();try{return await Hs(s,e,t),{success:!0,message:"Password has been reset successfully. You can now log in with your new password."}}catch(r){const n=r;let o="Failed to reset password. The link may be invalid or expired.";return n.code==="auth/invalid-action-code"?o="The password reset link is invalid or has expired. Please request a new one.":n.code==="auth/weak-password"&&(o="The new password is too weak. Please choose a stronger password."),console.error("Confirm password reset error:",r),{success:!1,message:o}}},async updatePassword(e,t){const s=ee(),r=s.currentUser;if(!r||!r.email)return{success:!1,message:"No authenticated user found or user has no email."};try{const n=Ms.credential(r.email,e);return await zs(r,n),await Vs(r,t),await X(s).catch(()=>{}),D=null,$(null),J(),{success:!0,message:"Password updated successfully. You have been logged out for security.",requiresSignOut:!0}}catch(n){const o=n;return o.code==="auth/wrong-password"||o.code==="auth/invalid-credential"?{success:!1,message:"The current password you entered is incorrect."}:{success:!1,message:Da(o)}}},async getCurrentUser(){if(xe(),et&&await et,D)return D;const e=ee(),t=e.currentUser;if(!t)return null;try{try{await t.getIdToken(!0)}catch(n){return console.warn("Failed to refresh token:",n),await X(e),D=null,$(null),J(),null}const s=await Ee(t),r=ae(t.uid,s);return r.status!=="approved"?(await X(e),D=null,$(null),J(),null):(D=r,r)}catch(s){return console.error("Failed to fetch current user:",s),await X(e).catch(()=>{}),D=null,$(null),J(),null}},async isAuthenticated(){return!!await K.getCurrentUser()},onAuthStateChange(e,t){return xe(),Ze.add(e),{data:{subscription:{unsubscribe:()=>{try{Ze.delete(e)}catch(s){console.error("Failed to remove auth listener",s),t?.("Failed to unsubscribe from auth updates")}}}}}},async signOutDueToIdleTimeout(){console.log("ðŸ•’ User session expired due to inactivity - logging out");const e=ee();await X(e).catch(()=>{}),D=null,$(null),J()}},je={async getAll(){const e=v(),t=P(e,b.USERS),s=F(t,q("name"));return(await V(s)).docs.map(n=>{const o=ue(n);return ae(n.id,o)})},async getByEmail(e){const t=await Ua(e);return t?ae(t.id,t.record):null},async getById(e){return La(e)},async update(e,t){const s=v(),r=T(s,b.USERS,e),n={updatedAt:_()};typeof t.email=="string"&&(n.email=t.email,n.emailLower=t.email.toLowerCase()),typeof t.name=="string"&&(n.name=t.name),typeof t.role=="string"&&(n.role=t.role),t.department!==void 0&&(n.department=t.department),t.status&&(n.status=t.status);const o=Xe(n);Object.keys(o).length>0&&await re(r,o);const c=await H(r);if(!c.exists())throw new Error("User not found");const i=ue(c),l=ae(c.id,i);return D?.id===e&&l.status==="approved"&&(D=l,$(l)),l},async updateStatus(e,t,s={}){return je.update(e,{...s,status:t})},async unlockAccount(e){const t=v(),s=T(t,b.USERS,e);await re(s,{failedLoginAttempts:0,accountLocked:!1,lockedUntil:null,updatedAt:_()});const r=await H(s);if(!r.exists())throw new Error("User not found");const n=ue(r);return ae(r.id,n)},async delete(e){const t=v(),s=T(t,b.USERS,e);await me(s),D?.id===e&&await K.signOut()}},yr={async getAll(){const e=v(),t=P(e,b.CLASSROOMS),s=F(t,q("name"));return(await V(s)).docs.map(n=>{const o=n.data();return ve(n.id,o)})},async getById(e){const t=v(),s=T(t,b.CLASSROOMS,e),r=await H(s);if(!r.exists())return null;const n=r.data();return ve(r.id,n)},async create(e){const t=v(),s={...e,createdAt:_(),updatedAt:_()},r=await Re(P(t,b.CLASSROOMS),s);return ve(r.id,s)},async update(e,t){const s=v(),r=T(s,b.CLASSROOMS,e),o={...$e(t),updatedAt:_()};await re(r,o);const c=await H(r);if(!c.exists())throw new Error("Classroom not found");const i=c.data();return ve(c.id,i)},async delete(e){const t=v(),s=T(t,b.CLASSROOMS,e);try{const r=async E=>{for(let R=0;R<E.length;R+=450){const N=E.slice(R,R+450),C=v(),M=C&&C.batch?C.batch():null;if(M)N.forEach(L=>M.delete(L)),await M.commit();else for(const L of N)await me(L)}},n=P(t,b.BOOKING_REQUESTS),o=F(n,z("classroomId","==",e)),c=await V(o),i=[];for(const E of c.docs){const y=E.data();Ne(y.date,y.endTime)||i.push(T(t,b.BOOKING_REQUESTS,E.id))}const l=P(t,b.SCHEDULES),m=F(l,z("classroomId","==",e)),g=await V(m),S=[];for(const E of g.docs){const y=E.data();Ne(y.date,y.endTime)||S.push(T(t,b.SCHEDULES,E.id))}i.length>0&&(await r(i),console.log(`Deleted ${i.length} related booking request(s) for classroom ${e}`)),S.length>0&&(await r(S),console.log(`Deleted ${S.length} related schedule(s) for classroom ${e}`))}catch(r){console.error("Error during cascade deletion for classroom:",r)}await me(s)},async deleteCascade(e){const t=we(),s=Be(t);return(await ke(s,"deleteClassroomCascade")({classroomId:e})).data}},_a=(e,t,s,r)=>e>=s&&e<r||t>s&&t<=r||e<=s&&t>=r,_e={async getAll(){const e=v(),t=P(e,b.BOOKING_REQUESTS),s=F(t,q("requestDate","desc"));return(await V(s)).docs.map(n=>{const o=n.data();return ge(n.id,o)})},async getAllForFaculty(e){const t=v(),s=P(t,b.BOOKING_REQUESTS),r=F(s,z("facultyId","==",e),q("requestDate","desc"));return(await V(r)).docs.map(o=>{const c=o.data();return ge(o.id,c)})},async getById(e){const t=v(),s=T(t,b.BOOKING_REQUESTS,e),r=await H(s);if(!r.exists())return null;const n=r.data();return ge(r.id,n)},async create(e){const t=v(),s={...e,status:"pending",requestDate:_(),createdAt:_(),updatedAt:_()},r=await Re(P(t,b.BOOKING_REQUESTS),s);return ge(r.id,s)},async update(e,t){const s=v(),r=T(s,b.BOOKING_REQUESTS,e),o={...$e(t),updatedAt:_()};await re(r,o);const c=await H(r);if(!c.exists())throw new Error("Booking request not found");const i=c.data();return ge(c.id,i)},async delete(e){const t=v(),s=T(t,b.BOOKING_REQUESTS,e);await me(s)},async checkConflicts(e,t,s,r,n){const o=v(),c=P(o,b.BOOKING_REQUESTS),i=F(c,z("classroomId","==",e),z("date","==",t),z("status","in",["pending","approved"])),m=(await V(i)).docs.map(g=>({id:g.id,...g.data()})).filter(g=>g.id!==n);for(const g of m)if(Fa(s,r,g.startTime,g.endTime))return!0;return!1}};function Fa(e,t,s,r){return e>=s&&e<r||t>s&&t<=r||e<=s&&t>=r}const Ge={async getAll(){const e=v(),t=P(e,b.SCHEDULES),s=F(t,q("date"),q("startTime"));return(await V(s)).docs.map(n=>{const o=n.data();return he(n.id,o)})},async getAllForFaculty(e){const t=v(),s=P(t,b.SCHEDULES),r=F(s,z("facultyId","==",e),q("date"),q("startTime"));return(await V(r)).docs.map(o=>{const c=o.data();return he(o.id,c)})},async getById(e){const t=v(),s=T(t,b.SCHEDULES,e),r=await H(s);if(!r.exists())return null;const n=r.data();return he(r.id,n)},async create(e){const t=v(),s={...e,createdAt:_(),updatedAt:_()},r=await Re(P(t,b.SCHEDULES),s);return he(r.id,s)},async update(e,t){const s=v(),r=T(s,b.SCHEDULES,e),o={...$e(t),updatedAt:_()};await re(r,o);const c=await H(r);if(!c.exists())throw new Error("Schedule not found");const i=c.data();return he(c.id,i)},async delete(e){const t=v(),s=T(t,b.SCHEDULES,e);await me(s)},async checkConflict(e,t,s,r,n){const o=v(),c=P(o,b.SCHEDULES);return(await V(F(c,z("classroomId","==",e),z("date","==",t)))).docs.some(l=>{if(n&&l.id===n)return!1;const m=l.data();return m.status==="cancelled"?!1:_a(s,r,m.startTime,m.endTime)})},async cancelApprovedBooking(e){const t=await K.getCurrentUser();if(!t||t.role!=="admin")throw new Error("Only administrators can cancel approved bookings");const s=v(),r=T(s,b.SCHEDULES,e);if(!(await H(r)).exists())throw new Error("Schedule not found");await re(r,{status:"cancelled",updatedAt:_()})}},qe={async getAll(){const e=v(),t=P(e,b.SIGNUP_REQUESTS),s=F(t,q("requestDate","desc"));return(await V(s)).docs.map(n=>{const o=n.data();return ce(n.id,o)})},async getById(e){const t=v(),s=T(t,b.SIGNUP_REQUESTS,e),r=await H(s);if(!r.exists())return null;const n=r.data();return ce(r.id,n)},async getByEmail(e){const t=e.toLowerCase(),s=v(),r=P(s,b.SIGNUP_REQUESTS),n=F(r,z("emailLower","==",t),z("status","==","pending")),o=await V(n);if(o.empty)return null;const c=o.docs[0],i=c.data();return ce(c.id,i)},async create(e){const t=v(),s=_(),r={uid:e.userId,email:e.email,emailLower:e.email.toLowerCase(),name:e.name,department:e.department,status:"pending",requestDate:s,adminFeedback:e.adminFeedback,resolvedAt:e.resolvedAt,createdAt:s,updatedAt:s},n=await Re(P(t,b.SIGNUP_REQUESTS),r);return ce(n.id,r)},async update(e,t){const s=v(),r=T(s,b.SIGNUP_REQUESTS,e),n=$e(t),o={...n,updatedAt:_()};typeof n.email=="string"&&(o.emailLower=n.email.toLowerCase()),await re(r,o);const c=await H(r);if(!c.exists())throw new Error("Signup request not found");const i=c.data();return ce(c.id,i)},async delete(e){const t=v(),s=T(t,b.SIGNUP_REQUESTS,e);await me(s)},async rejectAndCleanup(e,t,s){const r=await this.getById(e);if(!r)throw new Error("Signup request not found");const n=_(),o=await tt.create({userId:r.userId,email:r.email,name:r.name,department:r.department,requestDate:r.requestDate,status:"rejected",adminFeedback:s,resolvedAt:n,processedBy:t});try{const c=we(),i=Be(c),m=await ke(i,"deleteUserAccount")({userId:r.userId});return console.log("Account deletion result:",m.data),await this.delete(e),o}catch(c){try{await tt.delete(o.id)}catch(i){console.error("Failed to clean up history record after failed rejection:",i)}throw c}},async bulkCleanupRejectedAccounts(){try{const e=we(),t=Be(e);return(await ke(t,"bulkCleanupRejectedAccounts")({})).data}catch(e){throw console.error("Bulk cleanup error:",e),new Error(`Failed to perform bulk cleanup: ${e instanceof Error?e.message:"Unknown error"}`)}}},tt={async getAll(){const e=v(),t=P(e,b.SIGNUP_HISTORY),s=F(t,q("resolvedAt","desc"));return(await V(s)).docs.map(n=>{const o=n.data();return De(n.id,o)})},async getById(e){const t=v(),s=T(t,b.SIGNUP_HISTORY,e),r=await H(s);if(!r.exists())return null;const n=r.data();return De(r.id,n)},async getByEmail(e){const t=e.toLowerCase(),s=v(),r=P(s,b.SIGNUP_HISTORY),n=F(r,z("emailLower","==",t),q("resolvedAt","desc"));return(await V(n)).docs.map(c=>{const i=c.data();return De(c.id,i)})},async create(e){const t=v(),s=_(),r={uid:e.userId,email:e.email,emailLower:e.email.toLowerCase(),name:e.name,department:e.department,requestDate:e.requestDate,status:e.status,adminFeedback:e.adminFeedback,resolvedAt:e.resolvedAt,processedBy:e.processedBy,createdAt:s,updatedAt:s},n=await Re(P(t,b.SIGNUP_HISTORY),r);return De(n.id,r)},async delete(e){const t=v(),s=T(t,b.SIGNUP_HISTORY,e);await me(s)}},be={cleanup(){console.log("ðŸ§¹ Cleaning up real-time listeners..."),Z.forEach(e=>{try{e()}catch(t){console.error("Error unsubscribing listener:",t)}}),Z=[],Object.values(Ia).forEach(e=>{e.clear()})},subscribeToData(e,t){console.log("ðŸ”„ Setting up real-time listeners for user:",e?.email),this.cleanup();const{onClassroomsUpdate:s,onBookingRequestsUpdate:r,onSchedulesUpdate:n,onSignupRequestsUpdate:o,onUsersUpdate:c,onError:i}=t;try{Ca(s,i),e?.role==="admin"?(bt(r,i),vt(n,i),o&&Ta(o,i),c&&Pa(c,i)):e?.role==="faculty"&&(bt(r,i,e.id),vt(n,i,e.id)),console.log(`âœ… Real-time listeners setup complete for ${e?.role||"anonymous"} user`)}catch(l){console.error("âŒ Failed to setup real-time listeners:",l),i?.(l instanceof Error?l:new Error(String(l)))}},getListenerCount(){return Z.length}};function qa({children:e}){const[t,s]=u.useState(""),[r,n]=u.useState(!1),[o,c]=u.useState(!1),[i,l]=u.useState(!1),m=async S=>{if(S.preventDefault(),!t.trim()){x.error("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){x.error("Please enter a valid email address");return}n(!0);try{const y=await K.resetPassword(t);y.success?(l(!0),x.success("Password reset email sent!",{description:"Please check your inbox for the reset link.",duration:5e3})):x.error("Unable to send reset email",{description:y.message,duration:5e3})}catch(y){console.error("Password reset error:",y),x.error("An error occurred",{description:"Please try again or contact your administrator.",duration:5e3})}finally{n(!1)}},g=S=>{c(S),s(""),l(!1),n(!1)};return a.jsxs(ba,{open:o,onOpenChange:g,children:[a.jsx(Wt,{asChild:!0,children:e}),a.jsxs(Zt,{className:"sm:max-w-md",children:[a.jsxs(Ea,{children:[a.jsx(Xt,{className:"text-xl font-semibold",children:"Reset Password"}),a.jsx(es,{children:i?"Check your email for reset instructions":"Enter your email address and we'll send you a link to reset your password."})]}),i?a.jsxs("div",{className:"space-y-6 pt-4",children:[a.jsxs("div",{className:"flex flex-col items-center justify-center py-6 space-y-4",children:[a.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:a.jsx(Fs,{className:"h-8 w-8 text-green-600"})}),a.jsxs("div",{className:"text-center space-y-2",children:[a.jsx("p",{className:"text-sm font-medium",children:"Email sent successfully!"}),a.jsxs("p",{className:"text-xs text-gray-600",children:["Check your inbox at ",a.jsx("span",{className:"font-medium",children:t})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"Don't see it? Check your spam folder."}),a.jsx("p",{className:"text-xs text-amber-600 font-medium",children:"âš ï¸ Link expires in 1 hour"})]})]}),a.jsx(le,{onClick:()=>c(!1),className:"w-full",children:"Close"})]}):a.jsxs("form",{onSubmit:m,className:"space-y-6 pt-4",noValidate:!0,children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"reset-email",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ie,{id:"reset-email",type:"email",placeholder:"your.email@plv.edu.ph",value:t,onChange:S=>s(S.target.value),className:"pl-10",disabled:r,autoComplete:"email"})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"You'll receive an email with a link to reset your password."})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(le,{type:"button",variant:"outline",onClick:()=>c(!1),className:"flex-1",disabled:r,children:"Cancel"}),a.jsx(le,{type:"submit",className:"flex-1",disabled:r,children:r?"Sending...":"Send Reset Link"})]})]})]})]})}function Ba({onLogin:e,onSignup:t,users:s}){const[r,n]=u.useState(""),[o,c]=u.useState(""),[i,l]=u.useState({email:"",firstName:"",lastName:"",department:"",password:"",confirmPassword:""}),[m,g]=u.useState(!1),[S,E]=u.useState("login"),[y,R]=u.useState({email:"",password:""}),[N,C]=u.useState({firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""}),M=["Civil Engineering","Information Technology"],L=j=>{if(!j)return j;let w=j.replace(/[[\r\n\t]]/g,"");return w=w.replace(/[\u200B\u200C\u200D\uFEFF]/g,""),w=w.trim(),w},Y=j=>{const w={firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""};let B=!1;return j.firstName.trim()||(w.firstName="First name is required",B=!0),j.lastName.trim()||(w.lastName="Last name is required",B=!0),j.email.trim()||(w.email="Email is required",B=!0),j.department||(w.department="Please select a department",B=!0),j.password?j.password.length<8&&(w.password="Password must be at least 8 characters long",B=!0):(w.password="Please create a password",B=!0),j.confirmPassword?j.password!==j.confirmPassword&&(w.confirmPassword="Passwords do not match",B=!0):(w.confirmPassword="Please confirm your password",B=!0),{errors:w,hasErrors:B}},ne=async j=>{j.preventDefault(),R({email:"",password:""});const w=L(o);w!==o&&c(w);const B={email:"",password:""};let te=!1;if(r.trim()||(B.email="Email is required",te=!0),w.trim()||(B.password="Password is required",te=!0),te){R(B);return}g(!0);try{await e(r,w)||c("")}finally{g(!1)}},G=async j=>{j.preventDefault(),C({firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""});const{errors:w,hasErrors:B}=Y(i);if(B){C(w);return}const te=L(i.password),W=L(i.confirmPassword);(te!==i.password||W!==i.confirmPassword)&&l(fe=>({...fe,password:te,confirmPassword:W}));const Me=`${i.firstName.trim()} ${i.lastName.trim()}`;await t(i.email,Me,i.department,i.password)&&(l({email:"",firstName:"",lastName:"",department:"",password:"",confirmPassword:""}),setTimeout(()=>{E("login")},1500))};return a.jsxs("div",{className:"w-full space-y-6",children:[a.jsxs("div",{className:"text-center space-y-4",children:[a.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Welcome Back"}),a.jsx("p",{className:"text-gray-600",children:"Sign in to access the Digital Classroom Assignment System"})]}),a.jsxs(xa,{value:S,onValueChange:E,className:"w-full",children:[a.jsxs(Yt,{className:"grid w-full grid-cols-2 mb-8 bg-gray-100 rounded-xl p-1 mx-auto max-w-full overflow-hidden",children:[a.jsx(We,{value:"login",children:"Faculty Sign In"}),a.jsx(We,{value:"signup",children:"Faculty Request"})]}),a.jsx(Je,{value:"login",className:"space-y-8 mt-8",children:a.jsxs("form",{onSubmit:ne,className:"space-y-8",noValidate:!0,children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"email",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ie,{id:"email",type:"email",placeholder:"your.email@plv.edu.ph",value:r,onChange:j=>{n(j.target.value),y.email&&R(w=>({...w,email:""}))},className:`pl-10 h-12 rounded-xl ${y.email?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),y.email&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(oe,{className:"h-3 w-3"}),y.email]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"password",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ie,{id:"password",type:"password",placeholder:"Enter your password",value:o,onChange:j=>{c(j.target.value),y.password&&R(w=>({...w,password:""}))},className:`pl-10 h-12 rounded-xl ${y.password?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),y.password&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(oe,{className:"h-3 w-3"}),y.password]}),a.jsx("div",{className:"text-right",children:a.jsx(qa,{children:a.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-700 hover:underline font-medium",children:"Forgot password?"})})})]})]}),a.jsx(le,{type:"submit",className:"w-full h-12 bg-blue-600 hover:bg-blue-700 rounded-xl",disabled:m,children:m?"Signing In...":"Sign In"})]})}),a.jsx(Je,{value:"signup",className:"space-y-8 mt-8",children:a.jsxs("form",{onSubmit:G,className:"space-y-8",noValidate:!0,children:[a.jsxs("div",{className:"space-y-5",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-firstName",children:"First Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(ft,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ie,{id:"signup-firstName",type:"text",placeholder:"First name",value:i.firstName,onChange:j=>{l(w=>({...w,firstName:j.target.value})),N.firstName&&C(w=>({...w,firstName:""}))},className:`pl-10 h-12 rounded-xl ${N.firstName?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.firstName&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(oe,{className:"h-3 w-3"}),N.firstName]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-lastName",children:"Last Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(ft,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ie,{id:"signup-lastName",type:"text",placeholder:"Last name",value:i.lastName,onChange:j=>{l(w=>({...w,lastName:j.target.value})),N.lastName&&C(w=>({...w,lastName:""}))},className:`pl-10 h-12 rounded-xl ${N.lastName?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.lastName&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(oe,{className:"h-3 w-3"}),N.lastName]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-email",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ie,{id:"signup-email",type:"email",placeholder:"your.email@plv.edu.ph",value:i.email,onChange:j=>{l(w=>({...w,email:j.target.value})),N.email&&C(w=>({...w,email:""}))},className:`pl-10 h-12 rounded-xl ${N.email?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.email&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(oe,{className:"h-3 w-3"}),N.email]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-department",children:"Department"}),a.jsxs(ga,{value:i.department,onValueChange:j=>{l(w=>({...w,department:j})),N.department&&C(w=>({...w,department:""}))},required:!0,children:[a.jsx(Gt,{className:`h-12 rounded-xl ${N.department?"border-red-500 focus-visible:ring-red-500":""}`,children:a.jsx(ha,{placeholder:"Select your department"})}),a.jsx(Qt,{children:M.map(j=>a.jsx(Kt,{value:j,children:j},j))})]}),N.department&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(oe,{className:"h-3 w-3"}),N.department]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-password",children:"Create Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ie,{id:"signup-password",type:"password",placeholder:"Enter a strong password",value:i.password,onChange:j=>{l(w=>({...w,password:j.target.value})),N.password&&C(w=>({...w,password:""}))},className:`pl-10 h-12 rounded-xl ${N.password?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.password?a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(oe,{className:"h-3 w-3"}),N.password]}):a.jsx("p",{className:"text-xs text-gray-500",children:"Minimum 8 characters. Mix letters, numbers, and symbols for a stronger password."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-confirm-password",children:"Confirm Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ie,{id:"signup-confirm-password",type:"password",placeholder:"Re-enter your password",value:i.confirmPassword,onChange:j=>{l(w=>({...w,confirmPassword:j.target.value})),N.confirmPassword&&C(w=>({...w,confirmPassword:""}))},className:`pl-10 h-12 rounded-xl ${N.confirmPassword?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.confirmPassword&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(oe,{className:"h-3 w-3"}),N.confirmPassword]})]}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Ce,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Account Review"}),a.jsx("p",{className:"text-xs text-blue-700",children:"You can sign in with this password once the administrator approves your request. If the request is rejected, the account will remain inactive."})]})]})})]}),a.jsx(le,{type:"submit",className:"w-full h-12 bg-green-600 hover:bg-green-700 rounded-xl",children:"Request Faculty Account"})]})})]})]})}function Nt(){return a.jsx("footer",{className:"bg-white/80 backdrop-blur-xl border-t border-gray-100 py-6 mt-12",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 text-center",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Â© 2025 Pamantasan ng Lungsod ng Valenzuela"}),a.jsx("p",{className:"text-sm text-gray-500",children:"College of Engineering and Information Technology"})]})})})}class Oa extends u.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("ErrorBoundary caught an error:",t,s),(t.message.includes("timeout")||t.message.includes("timed out"))&&console.error("Timeout error detected:",t)}render(){return this.state.hasError?this.props.fallback||a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-pink-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[a.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-red-500 to-pink-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4",children:a.jsx("div",{className:"text-white text-lg font-bold",children:"!"})}),a.jsx("h1",{className:"text-2xl font-bold text-red-800 mb-4",children:"Something went wrong"}),a.jsx("p",{className:"text-red-600 mb-6",children:this.state.error?.message||"An unexpected error occurred"}),a.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:void 0}),window.location.reload()},className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Refresh Page"})]})}):this.props.children}}function $a({...e}){return a.jsx(js,{"data-slot":"alert-dialog",...e})}function xr({...e}){return a.jsx(ks,{"data-slot":"alert-dialog-trigger",...e})}function Ma({...e}){return a.jsx(Ns,{"data-slot":"alert-dialog-portal",...e})}const ts=u.forwardRef(({className:e,...t},s)=>a.jsx(Ft,{ref:s,"data-slot":"alert-dialog-overlay",className:U("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t}));ts.displayName=Ft.displayName;const ss=u.forwardRef(({className:e,...t},s)=>a.jsxs(Ma,{children:[a.jsx(ts,{}),a.jsx(qt,{ref:s,"data-slot":"alert-dialog-content",className:U("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...t})]}));ss.displayName=qt.displayName;function za({className:e,...t}){return a.jsx("div",{"data-slot":"alert-dialog-header",className:U("flex flex-col gap-2 text-center sm:text-left",e),...t})}function Va({className:e,...t}){return a.jsx("div",{"data-slot":"alert-dialog-footer",className:U("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...t})}function Ha({className:e,...t}){return a.jsx(Rs,{"data-slot":"alert-dialog-title",className:U("text-lg font-semibold",e),...t})}function Ga({className:e,...t}){return a.jsx(As,{"data-slot":"alert-dialog-description",className:U("text-muted-foreground text-sm",e),...t})}const Qa=u.forwardRef(({className:e,...t},s)=>a.jsx(Bt,{ref:s,className:U(at(),e),...t}));Qa.displayName=Bt.displayName;const Ka=u.forwardRef(({className:e,...t},s)=>a.jsx(Ot,{ref:s,className:U(at({variant:"outline"}),e),...t}));Ka.displayName=Ot.displayName;function Ya({isOpen:e,timeRemaining:t,onExtendSession:s,onLogout:r}){const[n,o]=u.useState(Math.ceil(t/1e3));u.useEffect(()=>{if(!e)return;const i=setInterval(()=>{const l=Math.ceil(t/1e3);o(l),l<=0&&r()},1e3);return()=>clearInterval(i)},[e,t,r]);const c=i=>{const l=Math.floor(i/60),m=i%60;return`${l}:${m.toString().padStart(2,"0")}`};return a.jsx($a,{open:e,children:a.jsxs(ss,{className:"sm:max-w-md",children:[a.jsxs(za,{children:[a.jsxs(Ha,{className:"flex items-center gap-2",children:[a.jsx(qs,{className:"h-5 w-5 text-amber-500"}),"Session Timeout Warning"]}),a.jsxs(Ga,{className:"space-y-2",children:[a.jsx("p",{children:"Your session will expire due to inactivity. You will be automatically logged out in:"}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-mono font-bold text-amber-600",children:c(n)}),a.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"minutes:seconds"})]}),a.jsx("p",{className:"text-sm text-gray-600",children:'Click "Stay Logged In" to extend your session, or you will be redirected to the login page.'})]})]}),a.jsxs(Va,{className:"flex gap-2",children:[a.jsx(le,{variant:"outline",onClick:r,className:"flex-1",children:"Logout Now"}),a.jsxs(le,{onClick:s,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[a.jsx(Bs,{className:"h-4 w-4 mr-2"}),"Stay Logged In"]})]})]})})}var Wa=(e,t,s,r,n,o,c,i)=>{let l=document.documentElement,m=["light","dark"];function g(y){(Array.isArray(e)?e:[e]).forEach(R=>{let N=R==="class",C=N&&o?n.map(M=>o[M]||M):n;N?(l.classList.remove(...C),l.classList.add(o&&o[y]?o[y]:y)):l.setAttribute(R,y)}),S(y)}function S(y){i&&m.includes(y)&&(l.style.colorScheme=y)}function E(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(r)g(r);else try{let y=localStorage.getItem(t)||s,R=c&&y==="system"?E():y;g(R)}catch{}},Ja=u.createContext(void 0),Za={setTheme:e=>{},themes:[]},Xa=()=>{var e;return(e=u.useContext(Ja))!=null?e:Za};u.memo(({forcedTheme:e,storageKey:t,attribute:s,enableSystem:r,enableColorScheme:n,defaultTheme:o,value:c,themes:i,nonce:l,scriptProps:m})=>{let g=JSON.stringify([s,t,o,e,i,c,r,n]).slice(1,-1);return u.createElement("script",{...m,suppressHydrationWarning:!0,nonce:typeof window>"u"?l:"",dangerouslySetInnerHTML:{__html:`(${Wa.toString()})(${g})`}})});const jt=({...e})=>{const{theme:t="system"}=Xa();return a.jsx(Os,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-white group-[.toaster]:text-gray-900 group-[.toaster]:border-gray-300 group-[.toaster]:shadow-lg",title:"group-[.toast]:text-gray-900 group-[.toast]:font-semibold",description:"!group-[.toast]:text-gray-900",actionButton:"group-[.toast]:bg-blue-600 group-[.toast]:text-white group-[.toast]:hover:bg-blue-700",cancelButton:"group-[.toast]:bg-gray-200 group-[.toast]:text-gray-800 group-[.toast]:hover:bg-gray-300",error:"group-[.toaster]:bg-red-50 group-[.toaster]:text-red-900 group-[.toaster]:border-red-300",success:"group-[.toaster]:bg-green-50 group-[.toaster]:text-green-900 group-[.toaster]:border-green-300",warning:"group-[.toaster]:bg-amber-50 group-[.toaster]:text-amber-900 group-[.toaster]:border-amber-300",info:"group-[.toaster]:bg-blue-50 group-[.toaster]:text-blue-900 group-[.toaster]:border-blue-300"}},style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...e})},er=({timeout:e,onIdle:t,onActive:s,onWarning:r,warningTime:n=300*1e3,disabled:o=!1})=>{const[c,i]=u.useState(!1),[l,m]=u.useState(e),g=u.useRef(null),S=u.useRef(null),E=u.useRef(null),y=u.useRef(Date.now()),R=u.useCallback(()=>{g.current&&(clearTimeout(g.current),g.current=null),S.current&&(clearTimeout(S.current),S.current=null),E.current&&(clearInterval(E.current),E.current=null)},[]),N=u.useCallback(()=>{const Y=Date.now()+e;E.current=setInterval(()=>{const ne=Date.now(),G=Math.max(0,Y-ne);m(G),G<=0&&(R(),i(!0),t())},1e3)},[e,t,R]),C=u.useCallback(()=>{if(o)return;R(),y.current=Date.now(),m(e),c&&(i(!1),s?.()),N();const L=e-n;L>0&&(S.current=setTimeout(()=>{r?.(n)},L)),g.current=setTimeout(()=>{i(!0),t()},e)},[o,e,n,c,t,s,r,R,N]),M=u.useCallback(()=>{C()},[C]);return u.useEffect(()=>{if(o){R();return}const L=["mousedown","mousemove","keypress","scroll","touchstart","click"];let Y=null;const ne=()=>{Y||(Y=setTimeout(()=>{Y=null},1e3),C())};return L.forEach(G=>{document.addEventListener(G,ne,!0)}),C(),()=>{L.forEach(G=>{document.removeEventListener(G,ne,!0)}),R(),Y&&clearTimeout(Y)}},[o,C,R]),u.useEffect(()=>()=>{R()},[R]),{isIdle:c,timeRemaining:l,extendSession:M,resetTimer:C}},tr=Oe.lazy(()=>Mt(()=>import("./AdminDashboard-BKJZ7XxV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),sr=Oe.lazy(()=>Mt(()=>import("./FacultyDashboard-l0L_WTk8.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9,10,11,13])));function ar(){const[e,t]=u.useState(null),[s,r]=u.useState([]),[n,o]=u.useState([]),[c,i]=u.useState([]),[l,m]=u.useState([]),[g,S]=u.useState([]),[E,y]=u.useState([]),[R,N]=u.useState(!0),[C,M]=u.useState(!1),[L,Y]=u.useState(null),[ne,G]=u.useState(!1),[j,w]=u.useState(0),B=u.useMemo(()=>e?g.filter(h=>h.facultyId===e.id):[],[g,e]),te=u.useMemo(()=>e?n.filter(h=>h.facultyId===e.id):[],[n,e]),W=u.useCallback(h=>{if(console.log("ðŸ”„ Setting up real-time data listeners..."),!h){y([]),r([]),i([]),o([]),S([]),be.cleanup();return}try{N(!0),be.subscribeToData(h,{onClassroomsUpdate:f=>{console.log("ðŸ“ Real-time update: Classrooms",f.length),r(f)},onBookingRequestsUpdate:f=>{console.log("ðŸ“‹ Real-time update: Booking Requests",f.length),o(f)},onSchedulesUpdate:f=>{console.log("ðŸ“… Real-time update: Schedules",f.length),S(f)},onSignupRequestsUpdate:h.role==="admin"?f=>{console.log("ðŸ‘¥ Real-time update: Signup Requests",f.length),i(f)}:void 0,onUsersUpdate:h.role==="admin"?f=>{console.log("ðŸ‘¤ Real-time update: Users",f.length),y(f)}:void 0,onError:f=>{console.error("âŒ Real-time listener error:",f),x.error("Real-time sync error. Some data may be outdated.")}}),h.role==="faculty"?(y([h]),i([]),m([])):h.role==="admin"&&tt.getAll().then(f=>{console.log("ðŸ“œ Loaded signup history:",f.length),m(f)}).catch(f=>{console.error("âŒ Failed to load signup history:",f);try{const p=f instanceof Error?f.message:String(f);x.error("Failed to load signup history",{description:p||"Please refresh the page or try again later.",duration:7e3})}catch(p){console.warn("Could not show toast for signup history error:",p)}}),console.log("âœ… Real-time listeners setup complete")}catch(f){console.error("âŒ Failed to setup real-time listeners:",f),x.error("Failed to setup real-time data sync")}finally{N(!1)}},[]),Me=u.useCallback(async(h,f)=>{const p=K.signIn(h,f);x.promise(p,{success:d=>d?(t(d),W(d),`${d.role==="admin"?"Welcome back, Administrator":"Welcome back"}, ${d.name}!`):"Login failed. Please check your credentials.",error:d=>d instanceof Error?d.message:"An unknown login error occurred.",duration:4e3});try{return!!await p}catch{return!1}},[W]);u.useCallback(async(h,f)=>{try{const p=await K.signIn(h,f);if(p){t(p);const d=p.role==="admin"?"Welcome back, Administrator":"Welcome back";return x.success(`${d}, ${p.name}!`,{description:`You're logged in as ${p.role==="admin"?"Administrator":"Faculty"}`,duration:4e3}),W(p),!0}return h&&f&&x.error("Invalid credentials",{description:"Please check your email and password and try again."}),!1}catch(p){if(console.error("Login error:",p),p instanceof Error&&"status"in p){const k=p.status;if(k==="pending")return x.info("Awaiting approval",{description:"Your account is pending administrator approval. Watch your email for updates.",duration:6e3}),!1;if(k==="rejected")return x.error("Account rejected",{description:"Please contact the administrator for assistance.",duration:6e3}),!1}let d="Please check your email and password and try again.";if(p&&typeof p=="object"&&"code"in p){const k=p.code;switch(k){case"auth/invalid-email":d="Invalid email address format.";break;case"auth/user-not-found":d="No account found with this email address.";break;case"auth/wrong-password":d="Incorrect password. Please try again.";break;case"auth/too-many-requests":d="Too many login attempts from this device. Access temporarily restricted by Firebase security. Please wait 15-30 minutes or try password reset.";break;case"auth/user-disabled":d="This account has been disabled.";break;case"permission-denied":d="Permission denied. Please contact administrator.";break;default:"message"in p&&typeof p.message=="string"?d=p.message:d=`Authentication error: ${k}`}}else p instanceof Error&&p.message&&(p.message.includes("Account locked")||p.message.includes("Account is locked")||p.message.includes("attempts remaining"),d=p.message);return x.error("Login failed",{description:d,duration:6e3}),!1}},[W]);const rt=u.useCallback(async(h,f,p,d)=>{try{try{if(await K.getCurrentUser()&&await qe.getByEmail(h))return x.error("Request already pending",{description:"Please wait for an administrator to review your existing request."}),!1}catch(A){console.warn("Could not check for existing requests (possibly unauthenticated):",A instanceof Error?A.message:A)}let k;try{k=(await K.registerFaculty(h,d,f,p)).request}catch(A){if(A?.code==="auth/email-already-in-use")return console.log("Signup failed: email already in use. Directing user to sign in."),x.error("Account already exists",{description:"This email is already associated with an account. Please sign in or use the password reset link if you forgot your password.",duration:8e3}),!1;throw A}i(A=>{const I=A.filter(O=>O.id!==k.id);return[k,...I]});try{if(await K.getCurrentUser()){const I=await je.getByEmail(h);I&&y(O=>[...O.filter(Ie=>Ie.id!==I.id),I])}}catch(A){console.warn("Could not load user data (possibly unauthenticated):",A instanceof Error?A.message:A)}return k&&x.success("Signup request submitted!",{description:"Your account has been created with pending status. An administrator will approve your access shortly.",duration:6e3}),!0}catch(k){console.error("Signup error:",k);let A="Unable to submit signup request.";if(k&&typeof k=="object")if("code"in k){const I=k.code;switch(I){case"auth/email-already-in-use":A="This email already has an account. Try signing in or resetting your password.";break;case"auth/weak-password":A="Password should be at least 6 characters and hard to guess.";break;case"auth/password-does-not-meet-requirements":A="Password must contain uppercase letter, lowercase letter, number, and special character.";break;case"permission-denied":A="Permission denied. Please check Firebase security rules.";break;default:"message"in k&&typeof k.message=="string"?A=k.message:A=`Firebase error: ${I}`}}else"message"in k&&typeof k.message=="string"&&(A=k.message);else k instanceof Error&&k.message&&(A=k.message);return x.error("Signup failed",{description:A,duration:8e3}),!1}},[]),fe=u.useCallback(async()=>{try{console.log("ðŸ”´ Logout clicked - user:",e?.email),await K.signOut(),sessionStorage.setItem("logoutSuccess","true"),t(null),be.cleanup(),r([]),o([]),i([]),S([]),y([]),console.log("âœ… User state cleared")}catch(h){console.error("âŒ Logout error:",h),t(null),sessionStorage.setItem("logoutError","true"),be.cleanup(),r([]),o([]),i([]),S([]),y([])}},[e]),nt=u.useCallback(async()=>{console.log("ðŸ•’ Session expired due to inactivity");try{await K.signOutDueToIdleTimeout(),sessionStorage.setItem("sessionExpired","true"),t(null),r([]),o([]),i([]),S([]),y([]),G(!1)}catch(h){console.error("âŒ Idle timeout logout error:",h),sessionStorage.setItem("sessionExpired","true"),t(null),G(!1)}},[]),as=u.useCallback(h=>{console.log(`âš ï¸ Session warning - ${Math.ceil(h/1e3)}s remaining`),w(h),G(!0),x.warning("Session Expiring Soon",{description:`Your session will expire in ${Math.ceil(h/6e4)} minutes due to inactivity`,duration:8e3})},[]),rs=u.useCallback(()=>{console.log("ðŸ”„ Session extended by user"),G(!1),x.success("Session extended successfully")},[]),{extendSession:ns}=er({timeout:1800*1e3,warningTime:300*1e3,onIdle:nt,onWarning:as,disabled:!e}),ot=u.useCallback(async h=>{r(h)},[]),de=u.useCallback(async(h,f,p,d,k=!1,A)=>{if(k&&Ne(f,Fe(p)))return!0;try{return await _e.checkConflicts(h,f,p,d,A)}catch(I){return console.error("Error checking conflicts:",I),x.error("Failed to check for conflicts"),!0}},[]),it=u.useCallback(async h=>{try{if(Ne(h.date,Fe(h.startTime))){x.error("Cannot request time slots that have already passed");return}if(await de(h.classroomId,h.date,h.startTime,h.endTime,!1)){x.error("Classroom conflict detected - time slot already booked or has pending request");return}const p=await _e.create(h);o(d=>[...d,p]),x.success("Classroom request submitted!")}catch(f){console.error("Booking request error:",f);const p=f instanceof Error?f.message:"";p.includes("conflict")||p.includes("duplicate")?x.error("Request failed: time slot was just booked by another user"):x.error("Failed to submit booking request. Please try again.")}},[de]),ct=u.useCallback(async(h,f,p)=>{try{const d=n.find(I=>I.id===h);if(!d){x.error("Request not found");return}if(d.status!=="pending"){x.error("Request has already been processed");return}if(f){if(Ne(d.date,Fe(d.startTime))){x.error("Cannot approve: booking time has already passed");return}if(await de(d.classroomId,d.date,d.startTime,d.endTime,!1,h)){x.error("Cannot approve: conflicts with existing confirmed booking. Please reject this request.");return}}const k={status:f?"approved":"rejected"};p&&p.trim()&&(k.adminFeedback=p.trim());const A=await _e.update(h,k);if(o(I=>I.map(O=>O.id===h?A:O)),f){const I=await Ge.create({classroomId:d.classroomId,classroomName:d.classroomName,facultyId:d.facultyId,facultyName:d.facultyName,date:d.date,startTime:d.startTime,endTime:d.endTime,purpose:d.purpose,status:"confirmed"});S(O=>[...O,I])}x.success(f?"Request approved!":"Request rejected.")}catch(d){console.error("Approval error:",d),x.error("Failed to process request")}},[n]),lt=u.useCallback(async(h,f,p)=>{try{const d=c.find(A=>A.id===h);if(!d){x.error("Request not found");return}if(d.status!=="pending"){x.error("Request has already been processed");return}const k=new Date().toISOString();if(f){const A=await qe.update(h,{status:"approved",adminFeedback:p||"Account approved",resolvedAt:k}),I=await je.updateStatus(d.userId,"approved",{name:d.name,department:d.department,role:"faculty"});i(O=>O.map(pe=>pe.id===h?A:pe)),y(O=>{const pe=O.findIndex(ls=>ls.id===I.id);if(pe===-1)return[...O,I];const Ie=[...O];return Ie[pe]=I,Ie}),x.success(`Faculty account approved for ${d.name}!`,{description:"They can now sign in with the password they created during signup.",duration:8e3})}else{if(!p||!p.trim()){x.error("Feedback is required when rejecting a request");return}if(!e){x.error("Admin user information not available");return}if(!window.confirm(`Are you sure you want to reject and permanently delete the account for ${d.name}? This action cannot be undone.`)){x.info("Rejection cancelled");return}await qe.rejectAndCleanup(h,e.id,p),i(I=>I.filter(O=>O.id!==h)),y(I=>I.filter(O=>O.id!==d.userId)),x.success(`Signup request rejected for ${d.name}.`,{description:"The account has been completely removed. They can submit a new signup request.",duration:6e3})}}catch(d){console.error("Signup approval error:",d);const k=d instanceof Error?d.message:"Unknown error occurred";x.error("Failed to process signup request",{description:k,duration:5e3})}},[c]),dt=u.useCallback(async h=>{try{await Ge.cancelApprovedBooking(h),S(f=>f.map(p=>p.id===h?{...p,status:"cancelled"}:p)),x.success("Booking cancelled!")}catch(f){console.error("Cancel schedule error:",f),x.error("Failed to cancel booking")}},[]),ut=u.useCallback(async h=>{try{const f=g.find(p=>p.facultyId===n.find(d=>d.id===h)?.facultyId&&p.date===n.find(d=>d.id===h)?.date&&p.startTime===n.find(d=>d.id===h)?.startTime&&p.endTime===n.find(d=>d.id===h)?.endTime&&p.classroomId===n.find(d=>d.id===h)?.classroomId);f&&(await Ge.cancelApprovedBooking(f.id),S(p=>p.map(d=>d.id===f.id?{...d,status:"cancelled"}:d))),await _e.update(h,{status:"rejected",adminFeedback:"Booking cancelled by administrator"}),o(p=>p.map(d=>d.id===h?{...d,status:"rejected",adminFeedback:"Booking cancelled by administrator"}:d)),x.success("Approved booking cancelled!")}catch(f){console.error("Cancel approved booking error:",f),x.error("Failed to cancel approved booking")}},[g,n]),mt=u.useCallback(async h=>{try{const f=await je.unlockAccount(h);y(p=>p.map(d=>d.id===h?f:d)),x.success("Account unlocked successfully!",{description:`${f.name}'s account has been unlocked and can now login.`,duration:5e3})}catch(f){console.error("Unlock account error:",f),x.error("Failed to unlock account",{description:"Please try again or contact support.",duration:5e3})}},[]),os=u.useMemo(()=>({user:e,classrooms:s,bookingRequests:n,signupRequests:c,signupHistory:l,schedules:g,users:E,onLogout:fe,onClassroomUpdate:ot,onRequestApproval:ct,onSignupApproval:lt,onCancelSchedule:dt,onCancelApprovedBooking:ut,onUnlockAccount:mt,checkConflicts:de}),[e,s,n,c,l,g,E,fe,ot,ct,lt,dt,ut,mt,de]),is=u.useMemo(()=>({user:e,classrooms:s,schedules:B,allSchedules:g,bookingRequests:te,allBookingRequests:n,onLogout:fe,onBookingRequest:it,checkConflicts:de}),[e,s,B,g,te,n,fe,it,de]);if(u.useEffect(()=>{(async()=>{try{console.log("ðŸš€ Initializing app...");const f=await K.getCurrentUser();f?(console.log("âœ… Valid user session found:",f.email),t(f),console.log("ðŸ“Š Setting up real-time listeners..."),W(f),console.log("âœ… Real-time listeners setup")):console.log("â„¹ï¸ No valid session found"),console.log("âœ… App initialized successfully")}catch(f){console.error("âŒ Failed to initialize app:",f);const p=f instanceof Error?f.message:"Unknown error";Y(`Failed to load application data: ${p}. Please refresh the page.`)}finally{console.log("âœ… Setting isLoading to false"),M(!0),N(!1)}})()},[W]),u.useEffect(()=>{const{data:{subscription:h}}=K.onAuthStateChange(async f=>{console.log("ðŸ‘¤ Auth state changed, new user:",f?.email||"none"),t(p=>{if(p?.id===f?.id)return console.log("â„¹ï¸ Same user, skipping update"),p;if(f&&!p){console.log("ðŸ“Š New user detected, setting up listeners...");try{W(f)}catch(d){console.error("Failed to setup listeners after auth change:",d)}}return f})},f=>{console.error("Auth error:",f),x.error("Authentication Error",{description:f,duration:8e3})});return()=>{h.unsubscribe(),be.cleanup()}},[]),u.useEffect(()=>{e||(sessionStorage.getItem("logoutSuccess")==="true"&&(sessionStorage.removeItem("logoutSuccess"),x.success("Logged out successfully",{description:"You have been signed out",duration:4e3})),sessionStorage.getItem("logoutError")==="true"&&(sessionStorage.removeItem("logoutError"),x.error("Logged out with errors",{description:"Please refresh if you experience any issues",duration:5e3})),sessionStorage.getItem("sessionExpired")==="true"&&(sessionStorage.removeItem("sessionExpired"),x.warning("Session expired",{description:"You have been logged out due to inactivity",duration:5e3})))},[e]),Oe.useEffect(()=>{},[e]),L)return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-pink-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[a.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-red-500 to-pink-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4",children:a.jsx("div",{className:"text-white text-lg font-bold",children:"!"})}),a.jsx("h1",{className:"text-2xl font-bold text-red-800 mb-4",children:"Application Error"}),a.jsx("p",{className:"text-red-600 mb-6",children:L}),a.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Refresh Page"}),a.jsx(Pe,{})]})});if(!C||R)return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4 animate-pulse",children:a.jsx("div",{className:"text-white text-lg font-bold",children:"PLV"})}),a.jsx("p",{className:"text-gray-600",children:"Loading..."}),a.jsx(Pe,{})]})});if(!e)return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex flex-col",children:[a.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:a.jsxs("div",{className:"text-center space-y-8 w-full max-w-md",children:[a.jsxs("div",{children:[a.jsx("div",{className:"flex justify-center mb-6",children:a.jsx("div",{className:"h-24 w-24 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:a.jsx("div",{className:"text-white text-2xl font-bold",children:"PLV"})})}),a.jsx("p",{className:"text-blue-600 mb-2",children:"PLV CEIT"}),a.jsx("h1",{className:"mb-6",children:"Digital Classroom"}),a.jsx("p",{className:"text-gray-600 mb-8",children:"Streamlined classroom assignment and booking system for PLV CEIT."})]}),a.jsx("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/20",children:a.jsx(Ba,{onLogin:Me,onSignup:rt,users:E})})]})}),a.jsx(Nt,{}),a.jsx(jt,{}),a.jsx(Pe,{})]});const cs=e;return a.jsx(Oa,{children:a.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[a.jsx("div",{className:"flex-1",children:a.jsx(u.Suspense,{fallback:a.jsx("div",{className:"p-8 flex items-center justify-center",children:a.jsx("div",{className:"text-gray-600",children:"Loading dashboardâ€¦"})}),children:cs.role==="admin"?a.jsx(tr,{...os}):a.jsx(sr,{...is})})}),a.jsx(Nt,{}),a.jsx(Ya,{isOpen:ne,timeRemaining:j,onExtendSession:()=>{ns(),rs()},onLogout:nt}),a.jsx(jt,{}),a.jsx(Pe,{})]})})}ta.createRoot(document.getElementById("root")).render(a.jsx(Oe.StrictMode,{children:a.jsx(ar,{})}));export{$a as A,le as B,hr as C,ba as D,ye as E,gr as F,pr as G,K as H,ie as I,se as L,ga as S,xa as T,Wt as a,Zt as b,U as c,Ea as d,Xt as e,es as f,Gt as g,ha as h,Qt as i,Kt as j,yr as k,Ne as l,Fe as m,wr as n,xr as o,ss as p,za as q,Ha as r,Ga as s,Va as t,Ka as u,Qa as v,Yt as w,We as x,Je as y,fr as z};
