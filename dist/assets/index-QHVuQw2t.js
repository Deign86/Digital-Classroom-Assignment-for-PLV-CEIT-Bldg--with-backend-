const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminDashboard-C-uasiQr.js","assets/radix-vendor-DcvrkFKF.js","assets/react-vendor-D3F3s8fL.js","assets/ProfileSettings-DYVumFs-.js","assets/phosphor-icons-BJglnZDw.js","assets/lucide-react-CudZfZVK.js","assets/firebase-functions-D39bosM8.js","assets/firebase-core-M-mnVknd.js","assets/analytics-sonner-DTMbvkUa.js","assets/utils-vendor-Cr9tsIwC.js","assets/firebase-firestore-BGtz343l.js","assets/firebase-auth-MTDr6AF2.js","assets/FacultyDashboard-B7hXYtsn.js","assets/FacultyDashboard-D27E_wyY.css"])))=>i.map(i=>d[i]);
import{r as d,j as a,S as ms,P as fs,T as Tt,I as ps,b as gs,C as Pt,V as hs,c as Ut,d as ws,e as ys,f as xs,g as bs,h as vs,i as Ss,L as Lt,k as Dt,l as _t,m as Es,n as Ft,o as dt,O as qt,p as Bt,q as Ot,D as $t,s as Ns,t as js,u as Mt,v as zt,A as Ht,w as Vt,x as ks,y as Rs,z as As,B as Is,E as Cs,R as Me}from"./radix-vendor-DcvrkFKF.js";import{a as Ts,g as Ps}from"./react-vendor-D3F3s8fL.js";import{t as Us,c as Ls,a as Ds}from"./utils-vendor-Cr9tsIwC.js";import{C as Gt,a as _s,b as Fs,X as qs,M as tt,c as Bs,d as ie,L as Ue,E as Ye,e as We,U as yt,f as Os,R as $s}from"./lucide-react-CudZfZVK.js";import{t as x,T as Ms}from"./analytics-sonner-DTMbvkUa.js";import{g as zs,d as T,a as fe,c as P,q as F,w as V,b as G,u as re,e as K,f as Ie,o as B,s as st,h as Ce}from"./firebase-firestore-BGtz343l.js";import{s as Z,E as Hs,r as Vs,u as Gs,c as Ks,a as Qs,b as xt,d as Ys,e as bt,f as vt,g as Ws,o as Js}from"./firebase-auth-MTDr6AF2.js";import{B as Zs,D as Xs,l as ea}from"./firebase-core-M-mnVknd.js";import{g as xe,h as pe}from"./firebase-functions-D39bosM8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();var Le={},St;function ta(){if(St)return Le;St=1;var e=Ts();return Le.createRoot=e.createRoot,Le.hydrateRoot=e.hydrateRoot,Le}var sa=ta();const aa=Ps(sa),ra="modulepreload",oa=function(e){return"/"+e},Et={},Kt=function(t,s,r){let o=Promise.resolve();if(s&&s.length>0){let l=function(m){return Promise.all(m.map(g=>Promise.resolve(g).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),i=c?.nonce||c?.getAttribute("nonce");o=l(s.map(m=>{if(m=oa(m),m in Et)return;Et[m]=!0;const g=m.endsWith(".css"),S=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${S}`))return;const E=document.createElement("link");if(E.rel=g?"stylesheet":ra,g||(E.as="script"),E.crossOrigin="",E.href=m,i&&E.setAttribute("nonce",i),document.head.appendChild(E),g)return new Promise((y,R)=>{E.addEventListener("load",y),E.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${m}`)))})}))}function n(c){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=c,window.dispatchEvent(i),!i.defaultPrevented)throw c}return o.then(c=>{for(const i of c||[])i.status==="rejected"&&n(i.reason);return t().catch(n)})};var Nt={},na="@vercel/analytics",ia="1.5.0",ca=()=>{window.va||(window.va=function(...t){(window.vaq=window.vaq||[]).push(t)})};function Qt(){return typeof window<"u"}function Yt(){try{const e="production"}catch{}return"production"}function la(e="auto"){if(e==="auto"){window.vam=Yt();return}window.vam=e}function da(){return(Qt()?window.vam:Yt())||"production"}function at(){return da()==="development"}function ua(e){return e.scriptSrc?e.scriptSrc:at()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function ma(e={debug:!0}){var t;if(!Qt())return;la(e.mode),ca(),e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend));const s=ua(e);if(document.head.querySelector(`script[src*="${s}"]`))return;const r=document.createElement("script");r.src=s,r.defer=!0,r.dataset.sdkn=na+(e.framework?`/${e.framework}`:""),r.dataset.sdkv=ia,e.disableAutoTrack&&(r.dataset.disableAutoTrack="1"),e.endpoint?r.dataset.endpoint=e.endpoint:e.basePath&&(r.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(r.dataset.dsn=e.dsn),r.onerror=()=>{const o=at()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${s}. ${o}`)},at()&&e.debug===!1&&(r.dataset.debug="false"),document.head.appendChild(r)}function fa({route:e,path:t}){var s;(s=window.va)==null||s.call(window,"pageview",{route:e,path:t})}function pa(){if(!(typeof process>"u"||typeof Nt>"u"))return Nt.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function De(e){return d.useEffect(()=>{var t;e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend))},[e.beforeSend]),d.useEffect(()=>{ma({framework:e.framework||"react",basePath:e.basePath??pa(),...e.route!==void 0&&{disableAutoTrack:!0},...e})},[]),d.useEffect(()=>{e.route&&e.path&&fa({route:e.route,path:e.path})},[e.route,e.path]),null}function C(...e){return Us(Ls(e))}const ut=Ds("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),de=d.forwardRef(({className:e,variant:t,size:s,asChild:r=!1,...o},n)=>{const c=r?ms:"button";return a.jsx(c,{"data-slot":"button",className:C(ut({variant:t,size:s,className:e})),ref:n,...o})});de.displayName="Button";function ce({className:e,type:t,...s}){return a.jsx("input",{type:t,"data-slot":"input",className:C("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...s})}var ga="Label",Wt=d.forwardRef((e,t)=>a.jsx(fs.label,{...e,ref:t,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));Wt.displayName=ga;var ha=Wt;function se({className:e,...t}){return a.jsx(ha,{"data-slot":"label",className:C("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...t})}function wa({...e}){return a.jsx(vs,{"data-slot":"select",...e})}function ya({...e}){return a.jsx(Ss,{"data-slot":"select-value",...e})}const Jt=d.forwardRef(({className:e,size:t="default",children:s,...r},o)=>a.jsxs(Tt,{ref:o,"data-slot":"select-trigger","data-size":t,className:C("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r,children:[s,a.jsx(ps,{asChild:!0,children:a.jsx(Gt,{className:"size-4 opacity-50"})})]}));Jt.displayName=Tt.displayName;const Zt=d.forwardRef(({className:e,children:t,position:s="popper",...r},o)=>a.jsx(gs,{children:a.jsxs(Pt,{ref:o,"data-slot":"select-content",className:C("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...r,children:[a.jsx(xa,{}),a.jsx(hs,{className:C("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),a.jsx(ba,{})]})}));Zt.displayName=Pt.displayName;const Xt=d.forwardRef(({className:e,children:t,...s},r)=>a.jsxs(Ut,{ref:r,"data-slot":"select-item",className:C("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",e),...s,children:[a.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:a.jsx(ws,{children:a.jsx(_s,{className:"size-4"})})}),a.jsx(ys,{children:t})]}));Xt.displayName=Ut.displayName;function xa({className:e,...t}){return a.jsx(xs,{"data-slot":"select-scroll-up-button",className:C("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(Fs,{className:"size-4"})})}function ba({className:e,...t}){return a.jsx(bs,{"data-slot":"select-scroll-down-button",className:C("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(Gt,{className:"size-4"})})}const va=Es,es=d.forwardRef(({className:e,...t},s)=>a.jsx(Lt,{ref:s,className:C("inline-flex h-12 items-center justify-center rounded-xl bg-gray-100 p-1 text-gray-600",e),...t}));es.displayName=Lt.displayName;const rt=d.forwardRef(({className:e,...t},s)=>a.jsx(Dt,{ref:s,className:C("inline-flex items-center justify-center whitespace-nowrap rounded-lg px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-900 data-[state=active]:shadow-sm hover:text-gray-900",e),...t}));rt.displayName=Dt.displayName;const ot=d.forwardRef(({className:e,...t},s)=>a.jsx(_t,{ref:s,className:C("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));ot.displayName=_t.displayName;function Sa({...e}){return a.jsx(js,{"data-slot":"dialog",...e})}const ts=d.forwardRef(({...e},t)=>a.jsx(Ft,{ref:t,"data-slot":"dialog-trigger",...e}));ts.displayName=Ft.displayName;function Ea({...e}){return a.jsx(Ns,{"data-slot":"dialog-portal",...e})}const Na=d.forwardRef(({...e},t)=>a.jsx(dt,{ref:t,"data-slot":"dialog-close",...e}));Na.displayName=dt.displayName;const ss=d.forwardRef(({className:e,...t},s)=>a.jsx(qt,{ref:s,"data-slot":"dialog-overlay",className:C("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t}));ss.displayName=qt.displayName;const as=d.forwardRef(({className:e,children:t,...s},r)=>a.jsxs(Ea,{"data-slot":"dialog-portal",children:[a.jsx(ss,{}),a.jsxs(Bt,{ref:r,"data-slot":"dialog-content",className:C("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...s,children:[t,a.jsxs(dt,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[a.jsx(qs,{}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));as.displayName=Bt.displayName;function ja({className:e,...t}){return a.jsx("div",{"data-slot":"dialog-header",className:C("flex flex-col gap-2 text-center sm:text-left",e),...t})}function gr({className:e,...t}){return a.jsx("div",{"data-slot":"dialog-footer",className:C("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...t})}const rs=d.forwardRef(({className:e,...t},s)=>a.jsx(Ot,{ref:s,"data-slot":"dialog-title",className:C("text-lg leading-none font-semibold",e),...t}));rs.displayName=Ot.displayName;const os=d.forwardRef(({className:e,...t},s)=>a.jsx($t,{ref:s,"data-slot":"dialog-description",className:C("text-muted-foreground text-sm",e),...t}));os.displayName=$t.displayName;const ka={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyApNtEkpd38KXPSS60lAQE8dBjZBd8orPQ",VITE_FIREBASE_APP_ID:"1:361326467083:web:f83bf156d030dcf463cf0e",VITE_FIREBASE_AUTH_DOMAIN:"plv-classroom-assigment.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"361326467083",VITE_FIREBASE_PROJECT_ID:"plv-classroom-assigment",VITE_FIREBASE_STORAGE_BUCKET:"plv-classroom-assigment.firebasestorage.app"},Ra=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID","VITE_FIREBASE_STORAGE_BUCKET","VITE_FIREBASE_MESSAGING_SENDER_ID","VITE_FIREBASE_APP_ID"],Aa=()=>{const e=[],t=Ra.reduce((s,r)=>{const o=ka[r];return o?s[r]=o:e.push(r),s},{});if(e.length>0)throw new Error(`Missing Firebase environment variables: ${e.join(", ")}. Please create a .env file based on .env.example and restart the dev server.`);return t},Ia=()=>{const e=Aa(),t={apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID};try{return Zs().length===0?(console.log("Initializing Firebase app with projectId:",t.projectId),Xs(t)):ea()}catch(s){throw console.error("Failed to initialize Firebase app:",s),new Error(`Firebase initialization failed: ${s instanceof Error?s.message:"Unknown error"}`)}};let Je=null,Ze=null;const ue=()=>(Je||(Je=Ia()),Je),Ca=()=>{if(!Ze)try{const e=ue();Ze=zs(e),console.log("Firestore instance initialized for project:",e.options.projectId)}catch(e){throw console.error("Failed to initialize Firestore:",e),new Error(`Firestore initialization failed: ${e instanceof Error?e.message:"Unknown error"}`)}return Ze};function Oe(e){if(!e)return"";const[t,s]=e.split(":").map(Number),r=t>=12?"PM":"AM";return`${t===0?12:t>12?t-12:t}:${s.toString().padStart(2,"0")} ${r}`}function be(e){if(!e)return"";const[t,s]=e.split(" "),[r,o]=t.split(":").map(Number);let n=r;return s==="AM"&&r===12?n=0:s==="PM"&&r!==12&&(n=r+12),`${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}function hr(){const e=[];for(let t=7;t<=20;t++)for(let s=0;s<60;s+=30){const r=`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;e.push(Oe(r))}return e}function wr(e){const t=be(e),[s]=t.split(":").map(Number);return s>=7&&s<=20}function yr(e,t){const s=be(e),r=be(t),[o,n]=s.split(":").map(Number),[c,i]=r.split(":").map(Number),l=o*60+n,S=(c*60+i-l)/60;return S>=.5&&S<=8}function xr(e,t){if(!e)return t;const s=be(e),[r,o]=s.split(":").map(Number),n=r*60+o;return t.filter(c=>{const i=be(c),[l,m]=i.split(":").map(Number),g=l*60+m,E=(g-n)/60;return g>n&&E<=8&&l<=20})}function br(e,t){return`${e} - ${t}`}function Re(e,t){if(!e||!t)return!1;const s=new Date,[r,o,n]=e.split("-").map(Number),c=be(t),[i,l]=c.split(":").map(Number),m=new Date(r,o-1,n,i,l,0,0),g=new Date(s.getTime()+300*1e3);return m<=g}let Xe=null;const X=()=>{if(!Xe){const e=ue();Xe=Ws(e)}return Xe},b={USERS:"users",CLASSROOMS:"classrooms",BOOKING_REQUESTS:"bookingRequests",SCHEDULES:"schedules",SIGNUP_REQUESTS:"signupRequests",SIGNUP_HISTORY:"signupHistory"};let _e=null,Fe=null;const v=()=>{if(Fe)throw Fe;if(_e)return _e;try{return _e=Ca(),_e}catch(e){throw Fe=e instanceof Error?e:new Error(String(e)),Fe}};let D=null;const nt=new Set,Ta={classrooms:new Set,bookingRequests:new Set,schedules:new Set,signupRequests:new Set,users:new Set};let J=[];const W=()=>{console.log(`Unsubscribing from ${J.length} real-time listeners.`),J.forEach(e=>{try{e()}catch(t){console.warn("Error during listener unsubscribe:",t)}}),J=[]},Pa=(e,t)=>{const s=v(),r=P(s,b.CLASSROOMS),o=F(r,B("name")),n=Ce(o,c=>{try{const i=c.docs.map(l=>{const m=l.data();return Ne(l.id,m)});e(i)}catch(i){console.error("Classrooms listener error:",i),t?.(i instanceof Error?i:new Error(String(i)))}},c=>{console.error("Classrooms listener error:",c),t?.(c)});return J.push(n),n},jt=(e,t,s)=>{const r=v(),o=P(r,b.BOOKING_REQUESTS);let n;s?n=F(o,V("facultyId","==",s),B("requestDate","desc")):n=F(o,B("requestDate","desc"));const c=Ce(n,i=>{try{const l=i.docs.map(m=>{const g=m.data();return we(m.id,g)});e(l)}catch(l){console.error("BookingRequests listener error:",l),t?.(l instanceof Error?l:new Error(String(l)))}},i=>{console.error("BookingRequests listener error:",i),t?.(i)});return J.push(c),c},kt=(e,t,s)=>{const r=v(),o=P(r,b.SCHEDULES);let n;s?n=F(o,V("facultyId","==",s),B("date"),B("startTime")):n=F(o,B("date"),B("startTime"));const c=Ce(n,i=>{try{const l=i.docs.map(m=>{const g=m.data();return ye(m.id,g)});e(l)}catch(l){console.error("Schedules listener error:",l),t?.(l instanceof Error?l:new Error(String(l)))}},i=>{console.error("Schedules listener error:",i),t?.(i)});return J.push(c),c},Ua=(e,t)=>{const s=v(),r=P(s,b.SIGNUP_REQUESTS),o=F(r,B("requestDate","desc")),n=Ce(o,c=>{try{const i=c.docs.map(l=>{const m=l.data();return le(l.id,m)});e(i)}catch(i){console.error("SignupRequests listener error:",i),t?.(i instanceof Error?i:new Error(String(i)))}},c=>{console.error("SignupRequests listener error:",c),t?.(c)});return J.push(n),n},La=(e,t)=>{const s=v(),r=P(s,b.USERS),o=F(r,B("name")),n=Ce(o,c=>{try{const i=c.docs.map(l=>{const m=me(l);return ae(l.id,m)});e(i)}catch(i){console.error("Users listener error:",i),t?.(i instanceof Error?i:new Error(String(i)))}},c=>{console.error("Users listener error:",c),t?.(c)});return J.push(n),n},z=e=>{nt.forEach(t=>{try{t(e)}catch(s){console.error("Auth listener error:",s)}})},_=()=>new Date().toISOString(),ze=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0)),it=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0));class Rt extends Error{status;constructor(t,s){super(s),this.name="AuthStatusError",this.status=t}}const ae=(e,t)=>({id:e,email:t.email,name:t.name,role:t.role,department:t.department,status:t.status,failedLoginAttempts:t.failedLoginAttempts||0,accountLocked:t.accountLocked||!1,lockedUntil:t.lockedUntil}),me=e=>{const t=e.data();if(!t)throw new Error("User record is missing.");return t},Da=async e=>{const t=e.toLowerCase(),s=v(),r=P(s,b.USERS),o=F(r,V("emailLower","==",t)),n=await G(o);if(n.empty)return null;const c=n.docs[0],i=me(c);return{id:c.id,record:i}},_a=async e=>{const t=v(),s=T(t,b.USERS,e),r=await K(s);if(!r.exists())return null;const o=me(r);return ae(r.id,o)},Ne=(e,t)=>({id:e,name:t.name,capacity:t.capacity,equipment:Array.isArray(t.equipment)?t.equipment:[],building:t.building,floor:t.floor,isAvailable:t.isAvailable}),we=(e,t)=>({id:e,facultyId:t.facultyId,facultyName:t.facultyName,classroomId:t.classroomId,classroomName:t.classroomName,date:t.date,startTime:t.startTime,endTime:t.endTime,purpose:t.purpose,status:t.status,requestDate:t.requestDate,adminFeedback:t.adminFeedback}),ye=(e,t)=>({id:e,classroomId:t.classroomId,classroomName:t.classroomName,facultyId:t.facultyId,facultyName:t.facultyName,date:t.date,startTime:t.startTime,endTime:t.endTime,purpose:t.purpose,status:t.status}),le=(e,t)=>({id:e,userId:t.uid,email:t.email,name:t.name,department:t.department,requestDate:t.requestDate,status:t.status,adminFeedback:t.adminFeedback,resolvedAt:t.resolvedAt}),qe=(e,t)=>({id:e,userId:t.uid,email:t.email,name:t.name,department:t.department,requestDate:t.requestDate,status:t.status,adminFeedback:t.adminFeedback,resolvedAt:t.resolvedAt,processedBy:t.processedBy});let At=!1,ct=null,Q=null,je=!1;const ke=async(e,t={})=>{const s=v(),r=T(s,b.USERS,e.uid),o=await K(r),n=t.email??e.email;if(!n)throw new Error("Authenticated user is missing an email address.");const c=n.toLowerCase(),i=_();if(!o.exists()){const E=t.role==="admin";let y=E?"approved":"pending",R=t.department,N=t.name??e.displayName??n;if(!E&&!t.status)try{const L=await $e.getById(e.uid);L&&L.status==="approved"&&(y="approved",R=R||L.department,N=t.name||L.name||e.displayName||n)}catch(L){console.warn("Could not fetch signup request for user:",e.uid,L)}const U={email:n,emailLower:c,name:N,role:t.role??(E?"admin":"faculty"),department:R,status:t.status??y,photoURL:t.photoURL??e.photoURL??void 0,lastSignInAt:i,createdAt:i,updatedAt:i},q=it(U);return await st(r,q),q}const l=me(o),m={...t,lastSignInAt:i,updatedAt:i};m.role===void 0&&(m.role=l.role),m.status===void 0&&(m.status=l.status),e.displayName&&e.displayName!==l.name&&(m.name=e.displayName),e.photoURL&&e.photoURL!==l.photoURL&&(m.photoURL=e.photoURL);const g=it(m);return Object.keys(g).some(E=>E!=="lastSignInAt"&&E!=="updatedAt"&&g[E]!==l[E])||!l.lastSignInAt?(await re(r,g),{...l,...g}):l},Se=()=>{if(At)return;At=!0,ct=new Promise(t=>{Q=t});const e=X();Js(e,async t=>{if(je){console.log("Auth state change suppressed temporarily (registration/reactivation flow)"),Q&&(Q(),Q=null);return}if(!t){D=null,z(null),W(),Q&&(Q(),Q=null);return}try{try{await t.getIdToken(!0)}catch(o){console.error("Token refresh failed in auth listener:",o),D=null,z(null),W(),Q&&(Q(),Q=null);return}const s=await ke(t),r=ae(t.uid,s);r.status!=="approved"?(D=null,z(null),W()):(D=r,z(r))}catch(s){console.error("Auth state listener error:",s),D=null,z(null),W()}finally{Q&&(Q(),Q=null)}})},Fa=e=>{switch(e.code){case"auth/invalid-email":return"The provided email address is invalid.";case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":return"Invalid email or password.";case"auth/email-already-in-use":return"This email is already registered.";case"auth/weak-password":return"Password should be at least 6 characters long.";case"auth/too-many-requests":return"Too many attempts. Please try again later.";case"auth/requires-recent-login":return"Please sign in again before updating your password.";default:return"An authentication error occurred."}},Y={async handleRejectedUserReactivation(e,t,s,r){if(!await Ae.getByEmail(e))return console.log(`Reactivation attempt for non-existent user ${e}. Treating as new registration.`),this.registerFaculty(e,t,s,r);Se();const n=X();je=!0;try{const i=(await xt(n,e,t)).user;i&&await bt(i,{displayName:s}).catch(()=>{});const l=await ke(i,{email:e,name:s,department:r,role:"faculty",status:"pending"}),m=v(),g=_(),S={uid:i.uid,email:l.email,emailLower:l.emailLower,name:l.name,department:r,status:"pending",requestDate:g,createdAt:g,updatedAt:g};return await st(T(m,b.SIGNUP_REQUESTS,i.uid),S),await vt(i).catch(()=>{}),{request:le(i.uid,S)}}finally{je=!1,await Z(n).catch(()=>{}),D=null,z(null)}},async registerFaculty(e,t,s,r){Se();const o=X();je=!0;const c=(await Ys(o,e,t)).user;try{c&&await bt(c,{displayName:s}).catch(()=>{});const i=await ke(c,{email:e,name:s,department:r,role:"faculty",status:"pending"}),l=v(),m=_(),g={uid:c.uid,email:i.email,emailLower:i.emailLower,name:i.name,department:r,status:"pending",requestDate:m,createdAt:m,updatedAt:m};return await st(T(l,b.SIGNUP_REQUESTS,c.uid),g),await vt(c).catch(()=>{}),{request:le(c.uid,g)}}catch(i){console.error("Signup failed, cleaning up Auth user:",i);try{await c.delete(),console.log("Auth user deleted successfully")}catch(l){console.error("Failed to delete Auth user:",l)}throw i}finally{je=!1,await Z(o).catch(()=>{}),D=null,z(null)}},async signIn(e,t){Se();const s=X(),r=v(),o=xe(ue());try{const c=(await xt(s,e,t)).user;try{await c.getIdToken(!0)}catch(m){console.warn("Failed to refresh token on sign in:",m)}const i=await ke(c),l=ae(c.uid,i);if(l.accountLocked&&l.lockedUntil){const m=new Date(l.lockedUntil),g=new Date;if(g<m){await Z(s),D=null,z(null);const S=Math.ceil((m.getTime()-g.getTime())/6e4);throw new Error(`Account is locked due to too many failed login attempts. Please try again in ${S} minute${S!==1?"s":""}.`)}}if(l.status!=="approved")throw await Z(s),D=null,z(null),W(),new Rt(l.status,l.status==="pending"?"Your account is awaiting administrator approval.":"Your account was rejected. Please contact the administrator.");try{await pe(o,"resetFailedLogins")(),console.log("âœ… Failed login attempts reset")}catch(m){console.warn("âš ï¸ Failed to call resetFailedLogins cloud function:",m);try{const g=T(r,b.USERS,c.uid);await re(g,{failedLoginAttempts:0,accountLocked:!1,lockedUntil:null,lastSignInAt:_(),updatedAt:_()})}catch(g){console.error("Failed to reset login attempts (fallback):",g)}}return D=l,z(l),l}catch(n){if(n instanceof Rt)throw n;if(console.log("ðŸ” Login error details:",{error:n,code:n&&typeof n=="object"&&"code"in n?n.code:"no-code",message:n instanceof Error?n.message:"unknown"}),n&&typeof n=="object"&&"code"in n&&n.code?.startsWith("auth/")){console.log("ðŸ”’ Calling trackFailedLogin for:",e);try{const m=(await pe(o,"trackFailedLogin")({email:e})).data;if(console.log("âœ… trackFailedLogin response:",m),m.locked)throw new Error(m.message||"Account locked due to too many failed login attempts. Please try again in 30 minutes.");if(m.message)throw new Error(m.message)}catch(i){if(console.error("âŒ trackFailedLogin error:",i),i instanceof Error&&(i.message.includes("Account locked")||i.message.includes("attempts remaining")))throw i;console.warn("âš ï¸ Failed to track login attempt:",i)}}throw n instanceof Error&&(n.message.includes("Account locked")||n.message.includes("attempts remaining"))?n:new Error("Invalid credentials. Please check your email and password.")}},async signOut(){const e=X();await Z(e).catch(()=>{}),D=null,z(null),W()},async resetPassword(e){const t=X();try{return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(await Qs(t,e),{success:!0,message:"Password reset instructions sent. If an account exists with this email, you will receive a link shortly."}):{success:!1,message:"Please enter a valid email address."}}catch(s){if(console.error("Password reset error:",s),s&&typeof s=="object"&&"code"in s)switch(s.code){case"auth/invalid-email":return{success:!1,message:"Please enter a valid email address."};case"auth/too-many-requests":return{success:!1,message:"Too many reset attempts. Please try again later."};case"auth/missing-email":return{success:!1,message:"Please enter an email address."};default:return{success:!1,message:"Unable to process request. Please try again or contact support."}}return{success:!1,message:"An unexpected error occurred. Please try again."}}},async confirmPasswordReset(e,t){const s=X();try{return await Ks(s,e,t),{success:!0,message:"Password has been reset successfully. You can now log in with your new password."}}catch(r){const o=r;let n="Failed to reset password. The link may be invalid or expired.";return o.code==="auth/invalid-action-code"?n="The password reset link is invalid or has expired. Please request a new one.":o.code==="auth/weak-password"&&(n="The new password is too weak. Please choose a stronger password."),console.error("Confirm password reset error:",r),{success:!1,message:n}}},async updatePassword(e,t){const s=X(),r=s.currentUser;if(!r||!r.email)return{success:!1,message:"No authenticated user found or user has no email."};try{const o=Hs.credential(r.email,e);return await Vs(r,o),await Gs(r,t),await Z(s).catch(()=>{}),D=null,z(null),W(),{success:!0,message:"Password updated successfully. You have been logged out for security.",requiresSignOut:!0}}catch(o){const n=o;return n.code==="auth/wrong-password"||n.code==="auth/invalid-credential"?{success:!1,message:"The current password you entered is incorrect."}:{success:!1,message:Fa(n)}}},async getCurrentUser(){if(Se(),ct&&await ct,D)return D;const e=X(),t=e.currentUser;if(!t)return null;try{try{await t.getIdToken(!0)}catch(o){return console.warn("Failed to refresh token:",o),await Z(e),D=null,z(null),W(),null}const s=await ke(t),r=ae(t.uid,s);return r.status!=="approved"?(await Z(e),D=null,z(null),W(),null):(D=r,r)}catch(s){return console.error("Failed to fetch current user:",s),await Z(e).catch(()=>{}),D=null,z(null),W(),null}},async isAuthenticated(){return!!await Y.getCurrentUser()},onAuthStateChange(e,t){return Se(),nt.add(e),{data:{subscription:{unsubscribe:()=>{try{nt.delete(e)}catch(s){console.error("Failed to remove auth listener",s),t?.("Failed to unsubscribe from auth updates")}}}}}},async signOutDueToIdleTimeout(){console.log("ðŸ•’ User session expired due to inactivity - logging out");const e=X();await Z(e).catch(()=>{}),D=null,z(null),W()}},Ae={async getAll(){const e=v(),t=P(e,b.USERS),s=F(t,B("name"));return(await G(s)).docs.map(o=>{const n=me(o);return ae(o.id,n)})},async getByEmail(e){const t=await Da(e);return t?ae(t.id,t.record):null},async getById(e){return _a(e)},async update(e,t){const s=v(),r=T(s,b.USERS,e),o={updatedAt:_()};typeof t.email=="string"&&(o.email=t.email,o.emailLower=t.email.toLowerCase()),typeof t.name=="string"&&(o.name=t.name),typeof t.role=="string"&&(o.role=t.role),t.department!==void 0&&(o.department=t.department),t.status&&(o.status=t.status);const n=it(o);Object.keys(n).length>0&&await re(r,n);const c=await K(r);if(!c.exists())throw new Error("User not found");const i=me(c),l=ae(c.id,i);return D?.id===e&&l.status==="approved"&&(D=l,z(l)),l},async updateStatus(e,t,s={}){return Ae.update(e,{...s,status:t})},async unlockAccount(e){const t=v(),s=T(t,b.USERS,e);await re(s,{failedLoginAttempts:0,accountLocked:!1,lockedUntil:null,updatedAt:_()});const r=await K(s);if(!r.exists())throw new Error("User not found");const o=me(r);return ae(r.id,o)},async delete(e){const t=v(),s=T(t,b.USERS,e);await fe(s),D?.id===e&&await Y.signOut()}},vr={async getAll(){const e=v(),t=P(e,b.CLASSROOMS),s=F(t,B("name"));return(await G(s)).docs.map(o=>{const n=o.data();return Ne(o.id,n)})},async getById(e){const t=v(),s=T(t,b.CLASSROOMS,e),r=await K(s);if(!r.exists())return null;const o=r.data();return Ne(r.id,o)},async create(e){const t=v(),s={...e,createdAt:_(),updatedAt:_()},r=await Ie(P(t,b.CLASSROOMS),s);return Ne(r.id,s)},async update(e,t){const s=v(),r=T(s,b.CLASSROOMS,e),n={...ze(t),updatedAt:_()};await re(r,n);const c=await K(r);if(!c.exists())throw new Error("Classroom not found");const i=c.data();return Ne(c.id,i)},async delete(e){const t=v(),s=T(t,b.CLASSROOMS,e);try{const r=async E=>{for(let R=0;R<E.length;R+=450){const N=E.slice(R,R+450),q=v().batch?.();if(q)N.forEach(L=>q.delete(L)),await q.commit();else for(const L of N)await fe(L)}},o=P(t,b.BOOKING_REQUESTS),n=F(o,V("classroomId","==",e)),c=await G(n),i=[];for(const E of c.docs){const y=E.data();Re(y.date,y.endTime)||i.push(T(t,b.BOOKING_REQUESTS,E.id))}const l=P(t,b.SCHEDULES),m=F(l,V("classroomId","==",e)),g=await G(m),S=[];for(const E of g.docs){const y=E.data();Re(y.date,y.endTime)||S.push(T(t,b.SCHEDULES,E.id))}i.length>0&&(await r(i),console.log(`Deleted ${i.length} related booking request(s) for classroom ${e}`)),S.length>0&&(await r(S),console.log(`Deleted ${S.length} related schedule(s) for classroom ${e}`))}catch(r){console.error("Error during cascade deletion for classroom:",r)}await fe(s)},async deleteCascade(e){const t=ue(),s=xe(t);return(await pe(s,"deleteClassroomCascade")({classroomId:e})).data}},qa=(e,t,s,r)=>e>=s&&e<r||t>s&&t<=r||e<=s&&t>=r,Be={async getAll(){const e=v(),t=P(e,b.BOOKING_REQUESTS),s=F(t,B("requestDate","desc"));return(await G(s)).docs.map(o=>{const n=o.data();return we(o.id,n)})},async getAllForFaculty(e){const t=v(),s=P(t,b.BOOKING_REQUESTS),r=F(s,V("facultyId","==",e),B("requestDate","desc"));return(await G(r)).docs.map(n=>{const c=n.data();return we(n.id,c)})},async getById(e){const t=v(),s=T(t,b.BOOKING_REQUESTS,e),r=await K(s);if(!r.exists())return null;const o=r.data();return we(r.id,o)},async create(e){const t=v(),s={...e,status:"pending",requestDate:_(),createdAt:_(),updatedAt:_()},r=await Ie(P(t,b.BOOKING_REQUESTS),s);return we(r.id,s)},async update(e,t){const s=v(),r=T(s,b.BOOKING_REQUESTS,e),n={...ze(t),updatedAt:_()};await re(r,n);const c=await K(r);if(!c.exists())throw new Error("Booking request not found");const i=c.data();return we(c.id,i)},async delete(e){const t=v(),s=T(t,b.BOOKING_REQUESTS,e);await fe(s)},async checkConflicts(e,t,s,r,o){const n=v(),c=P(n,b.BOOKING_REQUESTS),i=F(c,V("classroomId","==",e),V("date","==",t),V("status","in",["pending","approved"])),m=(await G(i)).docs.map(g=>({id:g.id,...g.data()})).filter(g=>g.id!==o);for(const g of m)if(Ba(s,r,g.startTime,g.endTime))return!0;return!1}};function Ba(e,t,s,r){return e>=s&&e<r||t>s&&t<=r||e<=s&&t>=r}const et={async getAll(){const e=v(),t=P(e,b.SCHEDULES),s=F(t,B("date"),B("startTime"));return(await G(s)).docs.map(o=>{const n=o.data();return ye(o.id,n)})},async getAllForFaculty(e){const t=v(),s=P(t,b.SCHEDULES),r=F(s,V("facultyId","==",e),B("date"),B("startTime"));return(await G(r)).docs.map(n=>{const c=n.data();return ye(n.id,c)})},async getById(e){const t=v(),s=T(t,b.SCHEDULES,e),r=await K(s);if(!r.exists())return null;const o=r.data();return ye(r.id,o)},async create(e){const t=v(),s={...e,createdAt:_(),updatedAt:_()},r=await Ie(P(t,b.SCHEDULES),s);return ye(r.id,s)},async update(e,t){const s=v(),r=T(s,b.SCHEDULES,e),n={...ze(t),updatedAt:_()};await re(r,n);const c=await K(r);if(!c.exists())throw new Error("Schedule not found");const i=c.data();return ye(c.id,i)},async delete(e){const t=v(),s=T(t,b.SCHEDULES,e);await fe(s)},async checkConflict(e,t,s,r,o){const n=v(),c=P(n,b.SCHEDULES);return(await G(F(c,V("classroomId","==",e),V("date","==",t)))).docs.some(l=>{if(o&&l.id===o)return!1;const m=l.data();return m.status==="cancelled"?!1:qa(s,r,m.startTime,m.endTime)})},async cancelApprovedBooking(e){const t=await Y.getCurrentUser();if(!t||t.role!=="admin")throw new Error("Only administrators can cancel approved bookings");const s=v(),r=T(s,b.SCHEDULES,e);if(!(await K(r)).exists())throw new Error("Schedule not found");await re(r,{status:"cancelled",updatedAt:_()})}},$e={async getAll(){const e=v(),t=P(e,b.SIGNUP_REQUESTS),s=F(t,B("requestDate","desc"));return(await G(s)).docs.map(o=>{const n=o.data();return le(o.id,n)})},async getById(e){const t=v(),s=T(t,b.SIGNUP_REQUESTS,e),r=await K(s);if(!r.exists())return null;const o=r.data();return le(r.id,o)},async getByEmail(e){const t=e.toLowerCase(),s=v(),r=P(s,b.SIGNUP_REQUESTS),o=F(r,V("emailLower","==",t),V("status","==","pending")),n=await G(o);if(n.empty)return null;const c=n.docs[0],i=c.data();return le(c.id,i)},async create(e){const t=v(),s=_(),r={uid:e.userId,email:e.email,emailLower:e.email.toLowerCase(),name:e.name,department:e.department,status:"pending",requestDate:s,adminFeedback:e.adminFeedback,resolvedAt:e.resolvedAt,createdAt:s,updatedAt:s},o=await Ie(P(t,b.SIGNUP_REQUESTS),r);return le(o.id,r)},async update(e,t){const s=v(),r=T(s,b.SIGNUP_REQUESTS,e),o=ze(t),n={...o,updatedAt:_()};typeof o.email=="string"&&(n.emailLower=o.email.toLowerCase()),await re(r,n);const c=await K(r);if(!c.exists())throw new Error("Signup request not found");const i=c.data();return le(c.id,i)},async delete(e){const t=v(),s=T(t,b.SIGNUP_REQUESTS,e);await fe(s)},async rejectAndCleanup(e,t,s){const r=await this.getById(e);if(!r)throw new Error("Signup request not found");const o=_(),n=await lt.create({userId:r.userId,email:r.email,name:r.name,department:r.department,requestDate:r.requestDate,status:"rejected",adminFeedback:s,resolvedAt:o,processedBy:t});try{const c=ue(),i=xe(c),m=await pe(i,"deleteUserAccount")({userId:r.userId});return console.log("Account deletion result:",m.data),await this.delete(e),n}catch(c){try{await lt.delete(n.id)}catch(i){console.error("Failed to clean up history record after failed rejection:",i)}throw c}},async bulkCleanupRejectedAccounts(){try{const e=ue(),t=xe(e);return(await pe(t,"bulkCleanupRejectedAccounts")({})).data}catch(e){throw console.error("Bulk cleanup error:",e),new Error(`Failed to perform bulk cleanup: ${e instanceof Error?e.message:"Unknown error"}`)}}},lt={async getAll(){const e=v(),t=P(e,b.SIGNUP_HISTORY),s=F(t,B("resolvedAt","desc"));return(await G(s)).docs.map(o=>{const n=o.data();return qe(o.id,n)})},async getById(e){const t=v(),s=T(t,b.SIGNUP_HISTORY,e),r=await K(s);if(!r.exists())return null;const o=r.data();return qe(r.id,o)},async getByEmail(e){const t=e.toLowerCase(),s=v(),r=P(s,b.SIGNUP_HISTORY),o=F(r,V("emailLower","==",t),B("resolvedAt","desc"));return(await G(o)).docs.map(c=>{const i=c.data();return qe(c.id,i)})},async create(e){const t=v(),s=_(),r={uid:e.userId,email:e.email,emailLower:e.email.toLowerCase(),name:e.name,department:e.department,requestDate:e.requestDate,status:e.status,adminFeedback:e.adminFeedback,resolvedAt:e.resolvedAt,processedBy:e.processedBy,createdAt:s,updatedAt:s},o=await Ie(P(t,b.SIGNUP_HISTORY),r);return qe(o.id,r)},async delete(e){const t=v(),s=T(t,b.SIGNUP_HISTORY,e);await fe(s)}},Ee={cleanup(){console.log("ðŸ§¹ Cleaning up real-time listeners..."),J.forEach(e=>{try{e()}catch(t){console.error("Error unsubscribing listener:",t)}}),J=[],Object.values(Ta).forEach(e=>{e.clear()})},subscribeToData(e,t){console.log("ðŸ”„ Setting up real-time listeners for user:",e?.email),this.cleanup();const{onClassroomsUpdate:s,onBookingRequestsUpdate:r,onSchedulesUpdate:o,onSignupRequestsUpdate:n,onUsersUpdate:c,onError:i}=t;try{Pa(s,i),e?.role==="admin"?(jt(r,i),kt(o,i),n&&Ua(n,i),c&&La(c,i)):e?.role==="faculty"&&(jt(r,i,e.id),kt(o,i,e.id)),console.log(`âœ… Real-time listeners setup complete for ${e?.role||"anonymous"} user`)}catch(l){console.error("âŒ Failed to setup real-time listeners:",l),i?.(l instanceof Error?l:new Error(String(l)))}},getListenerCount(){return J.length}},Sr=async e=>{const t=ue(),s=xe(t,"us-central1");return(await pe(s,"testPush")({userId:e})).data},Er=async()=>{try{const e=ue(),t=xe(e,"us-central1");return(await pe(t,"getVapidPublicKey")({})).data}catch(e){return console.warn("Failed to fetch VAPID public key",e),{ok:!1}}};function Oa({children:e}){const[t,s]=d.useState(""),[r,o]=d.useState(!1),[n,c]=d.useState(!1),[i,l]=d.useState(!1),m=async S=>{if(S.preventDefault(),!t.trim()){x.error("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){x.error("Please enter a valid email address");return}o(!0);try{const y=await Y.resetPassword(t);y.success?(l(!0),x.success("Password reset email sent!",{description:"Please check your inbox for the reset link.",duration:5e3})):x.error("Unable to send reset email",{description:y.message,duration:5e3})}catch(y){console.error("Password reset error:",y),x.error("An error occurred",{description:"Please try again or contact your administrator.",duration:5e3})}finally{o(!1)}},g=S=>{c(S),s(""),l(!1),o(!1)};return a.jsxs(Sa,{open:n,onOpenChange:g,children:[a.jsx(ts,{asChild:!0,children:e}),a.jsxs(as,{className:"sm:max-w-md",children:[a.jsxs(ja,{children:[a.jsx(rs,{className:"text-xl font-semibold",children:"Reset Password"}),a.jsx(os,{children:i?"Check your email for reset instructions":"Enter your email address and we'll send you a link to reset your password."})]}),i?a.jsxs("div",{className:"space-y-6 pt-4",children:[a.jsxs("div",{className:"flex flex-col items-center justify-center py-6 space-y-4",children:[a.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:a.jsx(Bs,{className:"h-8 w-8 text-green-600"})}),a.jsxs("div",{className:"text-center space-y-2",children:[a.jsx("p",{className:"text-sm font-medium",children:"Email sent successfully!"}),a.jsxs("p",{className:"text-xs text-gray-600",children:["Check your inbox at ",a.jsx("span",{className:"font-medium",children:t})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"Don't see it? Check your spam folder."}),a.jsx("p",{className:"text-xs text-amber-600 font-medium",children:"âš ï¸ Link expires in 1 hour"})]})]}),a.jsx(de,{onClick:()=>c(!1),className:"w-full",children:"Close"})]}):a.jsxs("form",{onSubmit:m,className:"space-y-6 pt-4",noValidate:!0,children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"reset-email",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(tt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"reset-email",type:"email",placeholder:"your.email@plv.edu.ph",value:t,onChange:S=>s(S.target.value),className:"pl-10",disabled:r,autoComplete:"email"})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"You'll receive an email with a link to reset your password."})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(de,{type:"button",variant:"outline",onClick:()=>c(!1),className:"flex-1",disabled:r,children:"Cancel"}),a.jsx(de,{type:"submit",className:"flex-1",disabled:r,children:r?"Sending...":"Send Reset Link"})]})]})]})]})}function $a({onLogin:e,onSignup:t,users:s}){const[r,o]=d.useState(""),[n,c]=d.useState(""),[i,l]=d.useState({email:"",firstName:"",lastName:"",department:"",password:"",confirmPassword:""}),[m,g]=d.useState(!1),[S,E]=d.useState("login"),[y,R]=d.useState({email:"",password:""}),[N,U]=d.useState({firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""}),[q,L]=d.useState(!1),[H,oe]=d.useState(!1),[O,He]=d.useState(!1),Ve=["Civil Engineering","Information Technology"],ge=j=>{if(!j)return j;let w=j.replace(/[[\r\n\t]]/g,"");return w=w.replace(/[\u200B\u200C\u200D\uFEFF]/g,""),w=w.trim(),w},Te=j=>{const w={firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""};let $=!1;return j.firstName.trim()||(w.firstName="First name is required",$=!0),j.lastName.trim()||(w.lastName="Last name is required",$=!0),j.email.trim()||(w.email="Email is required",$=!0),j.department||(w.department="Please select a department",$=!0),j.password?j.password.length<8&&(w.password="Password must be at least 8 characters long",$=!0):(w.password="Please create a password",$=!0),j.confirmPassword?j.password!==j.confirmPassword&&(w.confirmPassword="Passwords do not match",$=!0):(w.confirmPassword="Please confirm your password",$=!0),{errors:w,hasErrors:$}},ee=async j=>{j.preventDefault(),R({email:"",password:""});const w=ge(n);w!==n&&c(w);const $={email:"",password:""};let ne=!1;if(r.trim()||($.email="Email is required",ne=!0),w.trim()||($.password="Password is required",ne=!0),ne){R($);return}g(!0);try{await e(r,w)||c("")}finally{g(!1)}},Ge=async j=>{j.preventDefault(),U({firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""});const{errors:w,hasErrors:$}=Te(i);if($){U(w);return}const ne=ge(i.password),ve=ge(i.confirmPassword);(ne!==i.password||ve!==i.confirmPassword)&&l(te=>({...te,password:ne,confirmPassword:ve}));const Ke=`${i.firstName.trim()} ${i.lastName.trim()}`;await t(i.email,Ke,i.department,i.password)&&(l({email:"",firstName:"",lastName:"",department:"",password:"",confirmPassword:""}),setTimeout(()=>{E("login")},1500))};return a.jsxs("div",{className:"w-full space-y-6",children:[a.jsxs("div",{className:"text-center space-y-4",children:[a.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Welcome Back"}),a.jsx("p",{className:"text-gray-600",children:"Sign in to access the Digital Classroom Assignment System"})]}),a.jsxs(va,{value:S,onValueChange:E,className:"w-full",children:[a.jsxs(es,{className:"grid w-full grid-cols-2 mb-8 bg-gray-100 rounded-xl p-1 mx-auto max-w-full overflow-hidden",children:[a.jsx(rt,{value:"login",children:"Faculty Sign In"}),a.jsx(rt,{value:"signup",children:"Faculty Request"})]}),a.jsx(ot,{value:"login",className:"space-y-8 mt-8",children:a.jsxs("form",{onSubmit:ee,className:"space-y-8",noValidate:!0,children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"email",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(tt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"email",type:"email",placeholder:"your.email@plv.edu.ph",value:r,onChange:j=>{o(j.target.value),y.email&&R(w=>({...w,email:""}))},className:`pl-10 h-12 rounded-xl ${y.email?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),y.email&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),y.email]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"password",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"password",type:q?"text":"password",placeholder:"Enter your password",value:n,onChange:j=>{c(j.target.value),y.password&&R(w=>({...w,password:""}))},className:`pl-10 h-12 rounded-xl ${y.password?"border-red-500 focus-visible:ring-red-500":""}`,required:!0}),a.jsx("button",{type:"button",onClick:()=>L(!q),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":q?"Hide password":"Show password","aria-pressed":q,title:q?"Hide password":"Show password",children:q?a.jsx(Ye,{className:"h-4 w-4"}):a.jsx(We,{className:"h-4 w-4"})})]}),y.password&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),y.password]}),a.jsx("div",{className:"text-right",children:a.jsx(Oa,{children:a.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-700 hover:underline font-medium",children:"Forgot password?"})})})]})]}),a.jsx(de,{type:"submit",className:"w-full h-12 bg-blue-600 hover:bg-blue-700 rounded-xl",disabled:m,children:m?"Signing In...":"Sign In"})]})}),a.jsx(ot,{value:"signup",className:"space-y-8 mt-8",children:a.jsxs("form",{onSubmit:Ge,className:"space-y-8",noValidate:!0,children:[a.jsxs("div",{className:"space-y-5",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-firstName",children:"First Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(yt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"signup-firstName",type:"text",placeholder:"First name",value:i.firstName,onChange:j=>{l(w=>({...w,firstName:j.target.value})),N.firstName&&U(w=>({...w,firstName:""}))},className:`pl-10 h-12 rounded-xl ${N.firstName?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.firstName&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.firstName]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-lastName",children:"Last Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(yt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"signup-lastName",type:"text",placeholder:"Last name",value:i.lastName,onChange:j=>{l(w=>({...w,lastName:j.target.value})),N.lastName&&U(w=>({...w,lastName:""}))},className:`pl-10 h-12 rounded-xl ${N.lastName?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.lastName&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.lastName]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-email",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(tt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"signup-email",type:"email",placeholder:"your.email@plv.edu.ph",value:i.email,onChange:j=>{l(w=>({...w,email:j.target.value})),N.email&&U(w=>({...w,email:""}))},className:`pl-10 h-12 rounded-xl ${N.email?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.email&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.email]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-department",children:"Department"}),a.jsxs(wa,{value:i.department,onValueChange:j=>{l(w=>({...w,department:j})),N.department&&U(w=>({...w,department:""}))},required:!0,children:[a.jsx(Jt,{className:`h-12 rounded-xl ${N.department?"border-red-500 focus-visible:ring-red-500":""}`,children:a.jsx(ya,{placeholder:"Select your department"})}),a.jsx(Zt,{children:Ve.map(j=>a.jsx(Xt,{value:j,children:j},j))})]}),N.department&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.department]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-password",children:"Create Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"signup-password",type:H?"text":"password",placeholder:"Enter a strong password",value:i.password,onChange:j=>{l(w=>({...w,password:j.target.value})),N.password&&U(w=>({...w,password:""}))},className:`pl-10 h-12 rounded-xl ${N.password?"border-red-500 focus-visible:ring-red-500":""}`,required:!0}),a.jsx("button",{type:"button",onClick:()=>oe(!H),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":H?"Hide password":"Show password","aria-pressed":H,title:H?"Hide password":"Show password",children:H?a.jsx(Ye,{className:"h-4 w-4"}):a.jsx(We,{className:"h-4 w-4"})})]}),N.password?a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.password]}):a.jsx("p",{className:"text-xs text-gray-500",children:"Minimum 8 characters. Mix letters, numbers, and symbols for a stronger password."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(se,{htmlFor:"signup-confirm-password",children:"Confirm Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"signup-confirm-password",type:O?"text":"password",placeholder:"Re-enter your password",value:i.confirmPassword,onChange:j=>{l(w=>({...w,confirmPassword:j.target.value})),N.confirmPassword&&U(w=>({...w,confirmPassword:""}))},className:`pl-10 h-12 rounded-xl ${N.confirmPassword?"border-red-500 focus-visible:ring-red-500":""}`,required:!0}),a.jsx("button",{type:"button",onClick:()=>He(!O),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":O?"Hide confirm password":"Show confirm password","aria-pressed":O,title:O?"Hide confirm password":"Show confirm password",children:O?a.jsx(Ye,{className:"h-4 w-4"}):a.jsx(We,{className:"h-4 w-4"})})]}),N.confirmPassword&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.confirmPassword]})]}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Ue,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Account Review"}),a.jsx("p",{className:"text-xs text-blue-700",children:"You can sign in with this password once the administrator approves your request. If the request is rejected, the account will remain inactive."})]})]})})]}),a.jsx(de,{type:"submit",className:"w-full h-12 bg-green-600 hover:bg-green-700 rounded-xl",children:"Request Faculty Account"})]})})]})]})}function It(){return a.jsx("footer",{className:"bg-white/80 backdrop-blur-xl border-t border-gray-100 py-6 mt-12",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 text-center",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Â© 2025 Pamantasan ng Lungsod ng Valenzuela"}),a.jsx("p",{className:"text-sm text-gray-500",children:"College of Engineering and Information Technology"})]})})})}class Ma extends d.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("ErrorBoundary caught an error:",t,s),(t.message.includes("timeout")||t.message.includes("timed out"))&&console.error("Timeout error detected:",t)}render(){return this.state.hasError?this.props.fallback||a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-pink-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[a.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-red-500 to-pink-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4",children:a.jsx("div",{className:"text-white text-lg font-bold",children:"!"})}),a.jsx("h1",{className:"text-2xl font-bold text-red-800 mb-4",children:"Something went wrong"}),a.jsx("p",{className:"text-red-600 mb-6",children:this.state.error?.message||"An unexpected error occurred"}),a.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:void 0}),window.location.reload()},className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Refresh Page"})]})}):this.props.children}}function za({...e}){return a.jsx(Rs,{"data-slot":"alert-dialog",...e})}function Nr({...e}){return a.jsx(As,{"data-slot":"alert-dialog-trigger",...e})}function Ha({...e}){return a.jsx(ks,{"data-slot":"alert-dialog-portal",...e})}const ns=d.forwardRef(({className:e,...t},s)=>a.jsx(Mt,{ref:s,"data-slot":"alert-dialog-overlay",className:C("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t}));ns.displayName=Mt.displayName;const is=d.forwardRef(({className:e,...t},s)=>a.jsxs(Ha,{children:[a.jsx(ns,{}),a.jsx(zt,{ref:s,"data-slot":"alert-dialog-content",className:C("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...t})]}));is.displayName=zt.displayName;function Va({className:e,...t}){return a.jsx("div",{"data-slot":"alert-dialog-header",className:C("flex flex-col gap-2 text-center sm:text-left",e),...t})}function Ga({className:e,...t}){return a.jsx("div",{"data-slot":"alert-dialog-footer",className:C("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...t})}function Ka({className:e,...t}){return a.jsx(Is,{"data-slot":"alert-dialog-title",className:C("text-lg font-semibold",e),...t})}function Qa({className:e,...t}){return a.jsx(Cs,{"data-slot":"alert-dialog-description",className:C("text-muted-foreground text-sm",e),...t})}const Ya=d.forwardRef(({className:e,...t},s)=>a.jsx(Ht,{ref:s,className:C(ut(),e),...t}));Ya.displayName=Ht.displayName;const Wa=d.forwardRef(({className:e,...t},s)=>a.jsx(Vt,{ref:s,className:C(ut({variant:"outline"}),e),...t}));Wa.displayName=Vt.displayName;function Ja({isOpen:e,timeRemaining:t,onExtendSession:s,onLogout:r}){const[o,n]=d.useState(Math.ceil(t/1e3));d.useEffect(()=>{if(!e)return;const i=setInterval(()=>{const l=Math.ceil(t/1e3);n(l),l<=0&&r()},1e3);return()=>clearInterval(i)},[e,t,r]);const c=i=>{const l=Math.floor(i/60),m=i%60;return`${l}:${m.toString().padStart(2,"0")}`};return a.jsx(za,{open:e,children:a.jsxs(is,{className:"sm:max-w-md",children:[a.jsxs(Va,{children:[a.jsxs(Ka,{className:"flex items-center gap-2",children:[a.jsx(Os,{className:"h-5 w-5 text-amber-500"}),"Session Timeout Warning"]}),a.jsxs(Qa,{className:"space-y-2",children:[a.jsx("p",{children:"Your session will expire due to inactivity. You will be automatically logged out in:"}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-mono font-bold text-amber-600",children:c(o)}),a.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"minutes:seconds"})]}),a.jsx("p",{className:"text-sm text-gray-600",children:'Click "Stay Logged In" to extend your session, or you will be redirected to the login page.'})]})]}),a.jsxs(Ga,{className:"flex gap-2",children:[a.jsx(de,{variant:"outline",onClick:r,className:"flex-1",children:"Logout Now"}),a.jsxs(de,{onClick:s,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[a.jsx($s,{className:"h-4 w-4 mr-2"}),"Stay Logged In"]})]})]})})}var Za=(e,t,s,r,o,n,c,i)=>{let l=document.documentElement,m=["light","dark"];function g(y){(Array.isArray(e)?e:[e]).forEach(R=>{let N=R==="class",U=N&&n?o.map(q=>n[q]||q):o;N?(l.classList.remove(...U),l.classList.add(n&&n[y]?n[y]:y)):l.setAttribute(R,y)}),S(y)}function S(y){i&&m.includes(y)&&(l.style.colorScheme=y)}function E(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(r)g(r);else try{let y=localStorage.getItem(t)||s,R=c&&y==="system"?E():y;g(R)}catch{}},Xa=d.createContext(void 0),er={setTheme:e=>{},themes:[]},tr=()=>{var e;return(e=d.useContext(Xa))!=null?e:er};d.memo(({forcedTheme:e,storageKey:t,attribute:s,enableSystem:r,enableColorScheme:o,defaultTheme:n,value:c,themes:i,nonce:l,scriptProps:m})=>{let g=JSON.stringify([s,t,n,e,i,c,r,o]).slice(1,-1);return d.createElement("script",{...m,suppressHydrationWarning:!0,nonce:typeof window>"u"?l:"",dangerouslySetInnerHTML:{__html:`(${Za.toString()})(${g})`}})});const Ct=({...e})=>{const{theme:t="system"}=tr();return a.jsx(Ms,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-white group-[.toaster]:text-gray-900 group-[.toaster]:border-gray-300 group-[.toaster]:shadow-lg",title:"group-[.toast]:text-gray-900 group-[.toast]:font-semibold",description:"!group-[.toast]:text-gray-900",actionButton:"group-[.toast]:bg-blue-600 group-[.toast]:text-white group-[.toast]:hover:bg-blue-700",cancelButton:"group-[.toast]:bg-gray-200 group-[.toast]:text-gray-800 group-[.toast]:hover:bg-gray-300",error:"group-[.toaster]:bg-red-50 group-[.toaster]:text-red-900 group-[.toaster]:border-red-300",success:"group-[.toaster]:bg-green-50 group-[.toaster]:text-green-900 group-[.toaster]:border-green-300",warning:"group-[.toaster]:bg-amber-50 group-[.toaster]:text-amber-900 group-[.toaster]:border-amber-300",info:"group-[.toaster]:bg-blue-50 group-[.toaster]:text-blue-900 group-[.toaster]:border-blue-300"}},style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...e})},sr=({timeout:e,onIdle:t,onActive:s,onWarning:r,warningTime:o=300*1e3,disabled:n=!1})=>{const[c,i]=d.useState(!1),[l,m]=d.useState(e),g=d.useRef(null),S=d.useRef(null),E=d.useRef(null),y=d.useRef(Date.now()),R=d.useCallback(()=>{g.current&&(clearTimeout(g.current),g.current=null),S.current&&(clearTimeout(S.current),S.current=null),E.current&&(clearInterval(E.current),E.current=null)},[]),N=d.useCallback(()=>{const H=Date.now()+e;E.current=setInterval(()=>{const oe=Date.now(),O=Math.max(0,H-oe);m(O),O<=0&&(R(),i(!0),t())},1e3)},[e,t,R]),U=d.useCallback(()=>{if(n)return;R(),y.current=Date.now(),m(e),c&&(i(!1),s?.()),N();const L=e-o;L>0&&(S.current=setTimeout(()=>{r?.(o)},L)),g.current=setTimeout(()=>{i(!0),t()},e)},[n,e,o,c,t,s,r,R,N]),q=d.useCallback(()=>{U()},[U]);return d.useEffect(()=>{if(n){R();return}const L=["mousedown","mousemove","keypress","scroll","touchstart","click"];let H=null;const oe=()=>{H||(H=setTimeout(()=>{H=null},1e3),U())};return L.forEach(O=>{document.addEventListener(O,oe,!0)}),U(),()=>{L.forEach(O=>{document.removeEventListener(O,oe,!0)}),R(),H&&clearTimeout(H)}},[n,U,R]),d.useEffect(()=>()=>{R()},[R]),{isIdle:c,timeRemaining:l,extendSession:q,resetTimer:U}},ar=Me.lazy(()=>Kt(()=>import("./AdminDashboard-C-uasiQr.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),rr=Me.lazy(()=>Kt(()=>import("./FacultyDashboard-B7hXYtsn.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9,10,11,13])));function or(){const[e,t]=d.useState(null),[s,r]=d.useState([]),[o,n]=d.useState([]),[c,i]=d.useState([]),[l,m]=d.useState([]),[g,S]=d.useState([]),[E,y]=d.useState([]),[R,N]=d.useState(!0),[U,q]=d.useState(!1),[L,H]=d.useState(null),[oe,O]=d.useState(!1),[He,Ve]=d.useState(0),ge=d.useMemo(()=>e?g.filter(h=>h.facultyId===e.id):[],[g,e]),Te=d.useMemo(()=>e?o.filter(h=>h.facultyId===e.id):[],[o,e]),ee=d.useCallback(h=>{if(console.log("ðŸ”„ Setting up real-time data listeners..."),!h){y([]),r([]),i([]),n([]),S([]),Ee.cleanup();return}try{N(!0),Ee.subscribeToData(h,{onClassroomsUpdate:f=>{console.log("ðŸ“ Real-time update: Classrooms",f.length),r(f)},onBookingRequestsUpdate:f=>{console.log("ðŸ“‹ Real-time update: Booking Requests",f.length),n(f)},onSchedulesUpdate:f=>{console.log("ðŸ“… Real-time update: Schedules",f.length),S(f)},onSignupRequestsUpdate:h.role==="admin"?f=>{console.log("ðŸ‘¥ Real-time update: Signup Requests",f.length),i(f)}:void 0,onUsersUpdate:h.role==="admin"?f=>{console.log("ðŸ‘¤ Real-time update: Users",f.length),y(f)}:void 0,onError:f=>{console.error("âŒ Real-time listener error:",f),x.error("Real-time sync error. Some data may be outdated.")}}),h.role==="faculty"?(y([h]),i([]),m([])):h.role==="admin"&&lt.getAll().then(f=>{console.log("ðŸ“œ Loaded signup history:",f.length),m(f)}).catch(f=>{console.error("âŒ Failed to load signup history:",f);try{const p=f instanceof Error?f.message:String(f);x.error("Failed to load signup history",{description:p||"Please refresh the page or try again later.",duration:7e3})}catch(p){console.warn("Could not show toast for signup history error:",p)}}),console.log("âœ… Real-time listeners setup complete")}catch(f){console.error("âŒ Failed to setup real-time listeners:",f),x.error("Failed to setup real-time data sync")}finally{N(!1)}},[]),Ge=d.useCallback(async(h,f)=>{const p=Y.signIn(h,f);x.promise(p,{success:u=>u?(t(u),ee(u),`${u.role==="admin"?"Welcome back, Administrator":"Welcome back"}, ${u.name}!`):"Login failed. Please check your credentials.",error:u=>u instanceof Error?u.message:"An unknown login error occurred.",duration:4e3});try{return!!await p}catch{return!1}},[ee]);d.useCallback(async(h,f)=>{try{const p=await Y.signIn(h,f);if(p){t(p);const u=p.role==="admin"?"Welcome back, Administrator":"Welcome back";return x.success(`${u}, ${p.name}!`,{description:`You're logged in as ${p.role==="admin"?"Administrator":"Faculty"}`,duration:4e3}),ee(p),!0}return h&&f&&x.error("Invalid credentials",{description:"Please check your email and password and try again."}),!1}catch(p){if(console.error("Login error:",p),p instanceof Error&&"status"in p){const k=p.status;if(k==="pending")return x.info("Awaiting approval",{description:"Your account is pending administrator approval. Watch your email for updates.",duration:6e3}),!1;if(k==="rejected")return x.error("Account rejected",{description:"Please contact the administrator for assistance.",duration:6e3}),!1}let u="Please check your email and password and try again.";if(p&&typeof p=="object"&&"code"in p){const k=p.code;switch(k){case"auth/invalid-email":u="Invalid email address format.";break;case"auth/user-not-found":u="No account found with this email address.";break;case"auth/wrong-password":u="Incorrect password. Please try again.";break;case"auth/too-many-requests":u="Too many login attempts from this device. Access temporarily restricted by Firebase security. Please wait 15-30 minutes or try password reset.";break;case"auth/user-disabled":u="This account has been disabled.";break;case"permission-denied":u="Permission denied. Please contact administrator.";break;default:"message"in p&&typeof p.message=="string"?u=p.message:u=`Authentication error: ${k}`}}else p instanceof Error&&p.message&&(p.message.includes("Account locked")||p.message.includes("Account is locked")||p.message.includes("attempts remaining"),u=p.message);return x.error("Login failed",{description:u,duration:6e3}),!1}},[ee]);const j=d.useCallback(async(h,f,p,u)=>{try{try{if(await Y.getCurrentUser()&&await $e.getByEmail(h))return x.error("Request already pending",{description:"Please wait for an administrator to review your existing request."}),!1}catch(A){console.warn("Could not check for existing requests (possibly unauthenticated):",A instanceof Error?A.message:A)}let k;try{k=(await Y.registerFaculty(h,u,f,p)).request}catch(A){if(A?.code==="auth/email-already-in-use")return console.log("Signup failed: email already in use. Directing user to sign in."),x.error("Account already exists",{description:"This email is already associated with an account. Please sign in or use the password reset link if you forgot your password.",duration:8e3}),!1;throw A}i(A=>{const I=A.filter(M=>M.id!==k.id);return[k,...I]});try{if(await Y.getCurrentUser()){const I=await Ae.getByEmail(h);I&&y(M=>[...M.filter(Pe=>Pe.id!==I.id),I])}}catch(A){console.warn("Could not load user data (possibly unauthenticated):",A instanceof Error?A.message:A)}return k&&x.success("Signup request submitted!",{description:"Your account has been created with pending status. An administrator will approve your access shortly.",duration:6e3}),!0}catch(k){console.error("Signup error:",k);let A="Unable to submit signup request.";if(k&&typeof k=="object")if("code"in k){const I=k.code;switch(I){case"auth/email-already-in-use":A="This email already has an account. Try signing in or resetting your password.";break;case"auth/weak-password":A="Password should be at least 6 characters and hard to guess.";break;case"auth/password-does-not-meet-requirements":A="Password must contain uppercase letter, lowercase letter, number, and special character.";break;case"permission-denied":A="Permission denied. Please check Firebase security rules.";break;default:"message"in k&&typeof k.message=="string"?A=k.message:A=`Firebase error: ${I}`}}else"message"in k&&typeof k.message=="string"&&(A=k.message);else k instanceof Error&&k.message&&(A=k.message);return x.error("Signup failed",{description:A,duration:8e3}),!1}},[]),w=d.useCallback(async()=>{try{console.log("ðŸ”´ Logout clicked - user:",e?.email),await Y.signOut(),sessionStorage.setItem("logoutSuccess","true"),t(null),Ee.cleanup(),r([]),n([]),i([]),S([]),y([]),console.log("âœ… User state cleared")}catch(h){console.error("âŒ Logout error:",h),t(null),sessionStorage.setItem("logoutError","true"),Ee.cleanup(),r([]),n([]),i([]),S([]),y([])}},[e]),$=d.useCallback(async()=>{console.log("ðŸ•’ Session expired due to inactivity");try{await Y.signOutDueToIdleTimeout(),sessionStorage.setItem("sessionExpired","true"),t(null),r([]),n([]),i([]),S([]),y([]),O(!1)}catch(h){console.error("âŒ Idle timeout logout error:",h),sessionStorage.setItem("sessionExpired","true"),t(null),O(!1)}},[]),ne=d.useCallback(h=>{console.log(`âš ï¸ Session warning - ${Math.ceil(h/1e3)}s remaining`),Ve(h),O(!0),x.warning("Session Expiring Soon",{description:`Your session will expire in ${Math.ceil(h/6e4)} minutes due to inactivity`,duration:8e3})},[]),ve=d.useCallback(()=>{console.log("ðŸ”„ Session extended by user"),O(!1),x.success("Session extended successfully")},[]),{extendSession:Ke}=sr({timeout:1800*1e3,warningTime:300*1e3,onIdle:$,onWarning:ne,disabled:!e}),Qe=d.useCallback(async h=>{r(h)},[]),te=d.useCallback(async(h,f,p,u,k=!1,A)=>{if(k&&Re(f,Oe(p)))return!0;try{return await Be.checkConflicts(h,f,p,u,A)}catch(I){return console.error("Error checking conflicts:",I),x.error("Failed to check for conflicts"),!0}},[]),mt=d.useCallback(async h=>{try{if(Re(h.date,Oe(h.startTime))){x.error("Cannot request time slots that have already passed");return}if(await te(h.classroomId,h.date,h.startTime,h.endTime,!1)){x.error("Classroom conflict detected - time slot already booked or has pending request");return}const p=await Be.create(h);n(u=>[...u,p]),x.success("Classroom request submitted!")}catch(f){console.error("Booking request error:",f);const p=f instanceof Error?f.message:"";p.includes("conflict")||p.includes("duplicate")?x.error("Request failed: time slot was just booked by another user"):x.error("Failed to submit booking request. Please try again.")}},[te]),ft=d.useCallback(async(h,f,p)=>{try{const u=o.find(I=>I.id===h);if(!u){x.error("Request not found");return}if(u.status!=="pending"){x.error("Request has already been processed");return}if(f){if(Re(u.date,Oe(u.startTime))){x.error("Cannot approve: booking time has already passed");return}if(await te(u.classroomId,u.date,u.startTime,u.endTime,!1,h)){x.error("Cannot approve: conflicts with existing confirmed booking. Please reject this request.");return}}const k={status:f?"approved":"rejected"};p&&p.trim()&&(k.adminFeedback=p.trim());const A=await Be.update(h,k);if(n(I=>I.map(M=>M.id===h?A:M)),f){const I=await et.create({classroomId:u.classroomId,classroomName:u.classroomName,facultyId:u.facultyId,facultyName:u.facultyName,date:u.date,startTime:u.startTime,endTime:u.endTime,purpose:u.purpose,status:"confirmed"});S(M=>[...M,I])}x.success(f?"Request approved!":"Request rejected.")}catch(u){console.error("Approval error:",u),x.error("Failed to process request")}},[o]),pt=d.useCallback(async(h,f,p)=>{try{const u=c.find(A=>A.id===h);if(!u){x.error("Request not found");return}if(u.status!=="pending"){x.error("Request has already been processed");return}const k=new Date().toISOString();if(f){const A=await $e.update(h,{status:"approved",adminFeedback:p||"Account approved",resolvedAt:k}),I=await Ae.updateStatus(u.userId,"approved",{name:u.name,department:u.department,role:"faculty"});i(M=>M.map(he=>he.id===h?A:he)),y(M=>{const he=M.findIndex(us=>us.id===I.id);if(he===-1)return[...M,I];const Pe=[...M];return Pe[he]=I,Pe}),x.success(`Faculty account approved for ${u.name}!`,{description:"They can now sign in with the password they created during signup.",duration:8e3})}else{if(!p||!p.trim()){x.error("Feedback is required when rejecting a request");return}if(!e){x.error("Admin user information not available");return}if(!window.confirm(`Are you sure you want to reject and permanently delete the account for ${u.name}? This action cannot be undone.`)){x.info("Rejection cancelled");return}await $e.rejectAndCleanup(h,e.id,p),i(I=>I.filter(M=>M.id!==h)),y(I=>I.filter(M=>M.id!==u.userId)),x.success(`Signup request rejected for ${u.name}.`,{description:"The account has been completely removed. They can submit a new signup request.",duration:6e3})}}catch(u){console.error("Signup approval error:",u);const k=u instanceof Error?u.message:"Unknown error occurred";x.error("Failed to process signup request",{description:k,duration:5e3})}},[c]),gt=d.useCallback(async h=>{try{await et.cancelApprovedBooking(h),S(f=>f.map(p=>p.id===h?{...p,status:"cancelled"}:p)),x.success("Booking cancelled!")}catch(f){console.error("Cancel schedule error:",f),x.error("Failed to cancel booking")}},[]),ht=d.useCallback(async h=>{try{const f=g.find(p=>p.facultyId===o.find(u=>u.id===h)?.facultyId&&p.date===o.find(u=>u.id===h)?.date&&p.startTime===o.find(u=>u.id===h)?.startTime&&p.endTime===o.find(u=>u.id===h)?.endTime&&p.classroomId===o.find(u=>u.id===h)?.classroomId);f&&(await et.cancelApprovedBooking(f.id),S(p=>p.map(u=>u.id===f.id?{...u,status:"cancelled"}:u))),await Be.update(h,{status:"rejected",adminFeedback:"Booking cancelled by administrator"}),n(p=>p.map(u=>u.id===h?{...u,status:"rejected",adminFeedback:"Booking cancelled by administrator"}:u)),x.success("Approved booking cancelled!")}catch(f){console.error("Cancel approved booking error:",f),x.error("Failed to cancel approved booking")}},[g,o]),wt=d.useCallback(async h=>{try{const f=await Ae.unlockAccount(h);y(p=>p.map(u=>u.id===h?f:u)),x.success("Account unlocked successfully!",{description:`${f.name}'s account has been unlocked and can now login.`,duration:5e3})}catch(f){console.error("Unlock account error:",f),x.error("Failed to unlock account",{description:"Please try again or contact support.",duration:5e3})}},[]),cs=d.useMemo(()=>({user:e,classrooms:s,bookingRequests:o,signupRequests:c,signupHistory:l,schedules:g,users:E,onLogout:w,onClassroomUpdate:Qe,onRequestApproval:ft,onSignupApproval:pt,onCancelSchedule:gt,onCancelApprovedBooking:ht,onUnlockAccount:wt,checkConflicts:te}),[e,s,o,c,l,g,E,w,Qe,ft,pt,gt,ht,wt,te]),ls=d.useMemo(()=>({user:e,classrooms:s,schedules:ge,allSchedules:g,bookingRequests:Te,allBookingRequests:o,onLogout:w,onBookingRequest:mt,checkConflicts:te}),[e,s,ge,g,Te,o,w,mt,te]);if(d.useEffect(()=>{(async()=>{try{console.log("ðŸš€ Initializing app...");const f=await Y.getCurrentUser();f?(console.log("âœ… Valid user session found:",f.email),t(f),console.log("ðŸ“Š Setting up real-time listeners..."),ee(f),console.log("âœ… Real-time listeners setup")):console.log("â„¹ï¸ No valid session found"),console.log("âœ… App initialized successfully")}catch(f){console.error("âŒ Failed to initialize app:",f);const p=f instanceof Error?f.message:"Unknown error";H(`Failed to load application data: ${p}. Please refresh the page.`)}finally{console.log("âœ… Setting isLoading to false"),q(!0),N(!1)}})()},[ee]),d.useEffect(()=>{const{data:{subscription:h}}=Y.onAuthStateChange(async f=>{console.log("ðŸ‘¤ Auth state changed, new user:",f?.email||"none"),t(p=>{if(p?.id===f?.id)return console.log("â„¹ï¸ Same user, skipping update"),p;if(f&&!p){console.log("ðŸ“Š New user detected, setting up listeners...");try{ee(f)}catch(u){console.error("Failed to setup listeners after auth change:",u)}}return f})},f=>{console.error("Auth error:",f),x.error("Authentication Error",{description:f,duration:8e3})});return()=>{h.unsubscribe(),Ee.cleanup()}},[]),d.useEffect(()=>{e||(sessionStorage.getItem("logoutSuccess")==="true"&&(sessionStorage.removeItem("logoutSuccess"),x.success("Logged out successfully",{description:"You have been signed out",duration:4e3})),sessionStorage.getItem("logoutError")==="true"&&(sessionStorage.removeItem("logoutError"),x.error("Logged out with errors",{description:"Please refresh if you experience any issues",duration:5e3})),sessionStorage.getItem("sessionExpired")==="true"&&(sessionStorage.removeItem("sessionExpired"),x.warning("Session expired",{description:"You have been logged out due to inactivity",duration:5e3})))},[e]),Me.useEffect(()=>{},[e]),L)return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-pink-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[a.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-red-500 to-pink-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4",children:a.jsx("div",{className:"text-white text-lg font-bold",children:"!"})}),a.jsx("h1",{className:"text-2xl font-bold text-red-800 mb-4",children:"Application Error"}),a.jsx("p",{className:"text-red-600 mb-6",children:L}),a.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Refresh Page"}),a.jsx(De,{})]})});if(!U||R)return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4 animate-pulse",children:a.jsx("div",{className:"text-white text-lg font-bold",children:"PLV"})}),a.jsx("p",{className:"text-gray-600",children:"Loading..."}),a.jsx(De,{})]})});if(!e)return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex flex-col",children:[a.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:a.jsxs("div",{className:"text-center space-y-8 w-full max-w-md",children:[a.jsxs("div",{children:[a.jsx("div",{className:"flex justify-center mb-6",children:a.jsx("div",{className:"h-24 w-24 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:a.jsx("div",{className:"text-white text-2xl font-bold",children:"PLV"})})}),a.jsx("p",{className:"text-blue-600 mb-2",children:"PLV CEIT"}),a.jsx("h1",{className:"mb-6",children:"Digital Classroom"}),a.jsx("p",{className:"text-gray-600 mb-8",children:"Streamlined classroom assignment and reservation system for PLV CEIT."})]}),a.jsx("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/20",children:a.jsx($a,{onLogin:Ge,onSignup:j,users:E})})]})}),a.jsx(It,{}),a.jsx(Ct,{}),a.jsx(De,{})]});const ds=e;return a.jsx(Ma,{children:a.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[a.jsx("div",{className:"flex-1",children:a.jsx(d.Suspense,{fallback:a.jsx("div",{className:"p-8 flex items-center justify-center",children:a.jsx("div",{className:"text-gray-600",children:"Loading dashboardâ€¦"})}),children:ds.role==="admin"?a.jsx(ar,{...cs}):a.jsx(rr,{...ls})})}),a.jsx(It,{}),a.jsx(Ja,{isOpen:oe,timeRemaining:He,onExtendSession:()=>{Ke(),ve()},onLogout:$}),a.jsx(Ct,{}),a.jsx(De,{})]})})}aa.createRoot(document.getElementById("root")).render(a.jsx(Me.StrictMode,{children:a.jsx(or,{})}));export{za as A,de as B,gr as C,Sa as D,Na as E,Sr as F,xr as G,be as H,ce as I,yr as J,wr as K,se as L,Er as M,ue as N,Y as O,wa as S,va as T,ts as a,as as b,C as c,ja as d,rs as e,os as f,Jt as g,ya as h,Zt as i,Xt as j,vr as k,Re as l,Oe as m,br as n,Nr as o,is as p,Va as q,Ka as r,Qa as s,Ga as t,Wa as u,Ya as v,es as w,rt as x,ot as y,hr as z};
