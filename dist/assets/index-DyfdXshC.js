const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminDashboard-DlEoVZb1.js","assets/radix-vendor-aPP0ZBMt.js","assets/react-vendor-D3F3s8fL.js","assets/ProfileSettings-DOJKlkuf.js","assets/utils-vendor-Cr9tsIwC.js","assets/analytics-sonner-C2wJrx07.js","assets/lucide-react-Eou995ch.js","assets/phosphor-icons-D1IUpDlo.js","assets/firebase-firestore-BGtz343l.js","assets/firebase-core-M-mnVknd.js","assets/firebase-auth-MTDr6AF2.js","assets/firebase-functions-D39bosM8.js","assets/FacultyDashboard-DN3MwlIM.js","assets/FacultyDashboard-D27E_wyY.css"])))=>i.map(i=>d[i]);
import{r as u,j as a,S as ds,P as us,T as kt,I as ms,b as fs,C as Rt,V as ps,c as At,d as gs,e as hs,f as ws,g as ys,h as xs,i as bs,L as It,k as Ct,l as Tt,m as vs,n as Pt,o as st,O as Ut,p as Lt,q as Dt,D as _t,s as Ss,t as Es,u as Ft,v as qt,A as Bt,w as Ot,x as Ns,y as js,z as ks,B as Rs,E as As,R as $e}from"./radix-vendor-aPP0ZBMt.js";import{a as Is,g as Cs}from"./react-vendor-D3F3s8fL.js";import{t as Ts,c as Ps,a as Us}from"./utils-vendor-Cr9tsIwC.js";import{C as $t,a as Ls,b as Ds,X as _s,M as Qe,c as Fs,d as ie,L as Te,U as ft,e as qs,R as Bs}from"./lucide-react-Eou995ch.js";import{t as b,T as Os}from"./analytics-sonner-C2wJrx07.js";import{g as $s,d as T,a as pe,c as P,q as F,w as V,b as H,u as ne,e as G,f as Ae,o as q,s as Ke,h as Ie}from"./firebase-firestore-BGtz343l.js";import{s as ee,E as Ms,r as zs,u as Vs,c as Hs,a as Gs,b as pt,d as Qs,e as gt,f as ht,g as Ks,o as Ys}from"./firebase-auth-MTDr6AF2.js";import{B as Ws,D as Js,l as Zs}from"./firebase-core-M-mnVknd.js";import{g as Oe,h as Re}from"./firebase-functions-D39bosM8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var Pe={},wt;function Xs(){if(wt)return Pe;wt=1;var e=Is();return Pe.createRoot=e.createRoot,Pe.hydrateRoot=e.hydrateRoot,Pe}var ea=Xs();const ta=Cs(ea),sa="modulepreload",aa=function(e){return"/"+e},yt={},Mt=function(t,s,r){let n=Promise.resolve();if(s&&s.length>0){let l=function(m){return Promise.all(m.map(g=>Promise.resolve(g).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),o=c?.nonce||c?.getAttribute("nonce");n=l(s.map(m=>{if(m=aa(m),m in yt)return;yt[m]=!0;const g=m.endsWith(".css"),S=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${S}`))return;const E=document.createElement("link");if(E.rel=g?"stylesheet":sa,g||(E.as="script"),E.crossOrigin="",E.href=m,o&&E.setAttribute("nonce",o),document.head.appendChild(E),g)return new Promise((w,k)=>{E.addEventListener("load",w),E.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${m}`)))})}))}function i(c){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=c,window.dispatchEvent(o),!o.defaultPrevented)throw c}return n.then(c=>{for(const o of c||[])o.status==="rejected"&&i(o.reason);return t().catch(i)})};var xt={},ra="@vercel/analytics",na="1.5.0",oa=()=>{window.va||(window.va=function(...t){(window.vaq=window.vaq||[]).push(t)})};function zt(){return typeof window<"u"}function Vt(){try{const e="production"}catch{}return"production"}function ia(e="auto"){if(e==="auto"){window.vam=Vt();return}window.vam=e}function ca(){return(zt()?window.vam:Vt())||"production"}function Ye(){return ca()==="development"}function la(e){return e.scriptSrc?e.scriptSrc:Ye()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function da(e={debug:!0}){var t;if(!zt())return;ia(e.mode),oa(),e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend));const s=la(e);if(document.head.querySelector(`script[src*="${s}"]`))return;const r=document.createElement("script");r.src=s,r.defer=!0,r.dataset.sdkn=ra+(e.framework?`/${e.framework}`:""),r.dataset.sdkv=na,e.disableAutoTrack&&(r.dataset.disableAutoTrack="1"),e.endpoint?r.dataset.endpoint=e.endpoint:e.basePath&&(r.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(r.dataset.dsn=e.dsn),r.onerror=()=>{const n=Ye()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${s}. ${n}`)},Ye()&&e.debug===!1&&(r.dataset.debug="false"),document.head.appendChild(r)}function ua({route:e,path:t}){var s;(s=window.va)==null||s.call(window,"pageview",{route:e,path:t})}function ma(){if(!(typeof process>"u"||typeof xt>"u"))return xt.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function Ue(e){return u.useEffect(()=>{var t;e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend))},[e.beforeSend]),u.useEffect(()=>{da({framework:e.framework||"react",basePath:e.basePath??ma(),...e.route!==void 0&&{disableAutoTrack:!0},...e})},[]),u.useEffect(()=>{e.route&&e.path&&ua({route:e.route,path:e.path})},[e.route,e.path]),null}function U(...e){return Ts(Ps(e))}const at=Us("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),de=u.forwardRef(({className:e,variant:t,size:s,asChild:r=!1,...n},i)=>{const c=r?ds:"button";return a.jsx(c,{"data-slot":"button",className:U(at({variant:t,size:s,className:e})),ref:i,...n})});de.displayName="Button";function ce({className:e,type:t,...s}){return a.jsx("input",{type:t,"data-slot":"input",className:U("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...s})}var fa="Label",Ht=u.forwardRef((e,t)=>a.jsx(us.label,{...e,ref:t,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));Ht.displayName=fa;var pa=Ht;function ae({className:e,...t}){return a.jsx(pa,{"data-slot":"label",className:U("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...t})}function ga({...e}){return a.jsx(xs,{"data-slot":"select",...e})}function ha({...e}){return a.jsx(bs,{"data-slot":"select-value",...e})}const Gt=u.forwardRef(({className:e,size:t="default",children:s,...r},n)=>a.jsxs(kt,{ref:n,"data-slot":"select-trigger","data-size":t,className:U("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r,children:[s,a.jsx(ms,{asChild:!0,children:a.jsx($t,{className:"size-4 opacity-50"})})]}));Gt.displayName=kt.displayName;const Qt=u.forwardRef(({className:e,children:t,position:s="popper",...r},n)=>a.jsx(fs,{children:a.jsxs(Rt,{ref:n,"data-slot":"select-content",className:U("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...r,children:[a.jsx(wa,{}),a.jsx(ps,{className:U("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),a.jsx(ya,{})]})}));Qt.displayName=Rt.displayName;const Kt=u.forwardRef(({className:e,children:t,...s},r)=>a.jsxs(At,{ref:r,"data-slot":"select-item",className:U("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",e),...s,children:[a.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:a.jsx(gs,{children:a.jsx(Ls,{className:"size-4"})})}),a.jsx(hs,{children:t})]}));Kt.displayName=At.displayName;function wa({className:e,...t}){return a.jsx(ws,{"data-slot":"select-scroll-up-button",className:U("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(Ds,{className:"size-4"})})}function ya({className:e,...t}){return a.jsx(ys,{"data-slot":"select-scroll-down-button",className:U("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx($t,{className:"size-4"})})}const xa=vs,Yt=u.forwardRef(({className:e,...t},s)=>a.jsx(It,{ref:s,className:U("inline-flex h-12 items-center justify-center rounded-xl bg-gray-100 p-1 text-gray-600",e),...t}));Yt.displayName=It.displayName;const We=u.forwardRef(({className:e,...t},s)=>a.jsx(Ct,{ref:s,className:U("inline-flex items-center justify-center whitespace-nowrap rounded-lg px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-900 data-[state=active]:shadow-sm hover:text-gray-900",e),...t}));We.displayName=Ct.displayName;const Je=u.forwardRef(({className:e,...t},s)=>a.jsx(Tt,{ref:s,className:U("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Je.displayName=Tt.displayName;function ba({...e}){return a.jsx(Es,{"data-slot":"dialog",...e})}const Wt=u.forwardRef(({...e},t)=>a.jsx(Pt,{ref:t,"data-slot":"dialog-trigger",...e}));Wt.displayName=Pt.displayName;function va({...e}){return a.jsx(Ss,{"data-slot":"dialog-portal",...e})}const Sa=u.forwardRef(({...e},t)=>a.jsx(st,{ref:t,"data-slot":"dialog-close",...e}));Sa.displayName=st.displayName;const Jt=u.forwardRef(({className:e,...t},s)=>a.jsx(Ut,{ref:s,"data-slot":"dialog-overlay",className:U("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t}));Jt.displayName=Ut.displayName;const Zt=u.forwardRef(({className:e,children:t,...s},r)=>a.jsxs(va,{"data-slot":"dialog-portal",children:[a.jsx(Jt,{}),a.jsxs(Lt,{ref:r,"data-slot":"dialog-content",className:U("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...s,children:[t,a.jsxs(st,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[a.jsx(_s,{}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Zt.displayName=Lt.displayName;function Ea({className:e,...t}){return a.jsx("div",{"data-slot":"dialog-header",className:U("flex flex-col gap-2 text-center sm:text-left",e),...t})}const Xt=u.forwardRef(({className:e,...t},s)=>a.jsx(Dt,{ref:s,"data-slot":"dialog-title",className:U("text-lg leading-none font-semibold",e),...t}));Xt.displayName=Dt.displayName;const es=u.forwardRef(({className:e,...t},s)=>a.jsx(_t,{ref:s,"data-slot":"dialog-description",className:U("text-muted-foreground text-sm",e),...t}));es.displayName=_t.displayName;const Na={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_ADMIN_EMAILS:"admin@plv.edu.ph,registrar@plv.edu.ph",VITE_FIREBASE_API_KEY:"AIzaSyApNtEkpd38KXPSS60lAQE8dBjZBd8orPQ",VITE_FIREBASE_APP_ID:"1:361326467083:web:f83bf156d030dcf463cf0e",VITE_FIREBASE_AUTH_DOMAIN:"plv-classroom-assigment.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"361326467083",VITE_FIREBASE_PROJECT_ID:"plv-classroom-assigment",VITE_FIREBASE_STORAGE_BUCKET:"plv-classroom-assigment.firebasestorage.app"},ja=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID","VITE_FIREBASE_STORAGE_BUCKET","VITE_FIREBASE_MESSAGING_SENDER_ID","VITE_FIREBASE_APP_ID"],ka=()=>{const e=[],t=ja.reduce((s,r)=>{const n=Na[r];return n?s[r]=n:e.push(r),s},{});if(e.length>0)throw new Error(`Missing Firebase environment variables: ${e.join(", ")}. Please create a .env file based on .env.example and restart the dev server.`);return t},Ra=()=>{const e=ka(),t={apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID};try{return Ws().length===0?(console.log("Initializing Firebase app with projectId:",t.projectId),Js(t)):Zs()}catch(s){throw console.error("Failed to initialize Firebase app:",s),new Error(`Firebase initialization failed: ${s instanceof Error?s.message:"Unknown error"}`)}};let ze=null,Ve=null;const ye=()=>(ze||(ze=Ra()),ze),Aa=()=>{if(!Ve)try{const e=ye();Ve=$s(e),console.log("Firestore instance initialized for project:",e.options.projectId)}catch(e){throw console.error("Failed to initialize Firestore:",e),new Error(`Firestore initialization failed: ${e instanceof Error?e.message:"Unknown error"}`)}return Ve};function qe(e){if(!e)return"";const[t,s]=e.split(":").map(Number),r=t>=12?"PM":"AM";return`${t===0?12:t>12?t-12:t}:${s.toString().padStart(2,"0")} ${r}`}function xe(e){if(!e)return"";const[t,s]=e.split(" "),[r,n]=t.split(":").map(Number);let i=r;return s==="AM"&&r===12?i=0:s==="PM"&&r!==12&&(i=r+12),`${i.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}function fr(){const e=[];for(let t=7;t<=20;t++)for(let s=0;s<60;s+=30){const r=`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;e.push(qe(r))}return e}function pr(e){const t=xe(e),[s]=t.split(":").map(Number);return s>=7&&s<=20}function gr(e,t){const s=xe(e),r=xe(t),[n,i]=s.split(":").map(Number),[c,o]=r.split(":").map(Number),l=n*60+i,S=(c*60+o-l)/60;return S>=.5&&S<=8}function hr(e,t){if(!e)return t;const s=xe(e),[r,n]=s.split(":").map(Number),i=r*60+n;return t.filter(c=>{const o=xe(c),[l,m]=o.split(":").map(Number),g=l*60+m,E=(g-i)/60;return g>i&&E<=8&&l<=20})}function wr(e,t){return`${e} - ${t}`}function je(e,t){if(!e||!t)return!1;const s=new Date,[r,n,i]=e.split("-").map(Number),c=xe(t),[o,l]=c.split(":").map(Number),m=new Date(r,n-1,i,o,l,0,0),g=new Date(s.getTime()+300*1e3);return m<=g}let He=null;const te=()=>{if(!He){const e=ye();He=Ks(e)}return He},x={USERS:"users",CLASSROOMS:"classrooms",BOOKING_REQUESTS:"bookingRequests",SCHEDULES:"schedules",SIGNUP_REQUESTS:"signupRequests",SIGNUP_HISTORY:"signupHistory"};let Le=null,De=null;const v=()=>{if(De)throw De;if(Le)return Le;try{return Le=Aa(),Le}catch(e){throw De=e instanceof Error?e:new Error(String(e)),De}};let D=null;const Ze=new Set,Ia={classrooms:new Set,bookingRequests:new Set,schedules:new Set,signupRequests:new Set,users:new Set};let J=[];const W=()=>{console.log(`Unsubscribing from ${J.length} real-time listeners.`),J.forEach(e=>{try{e()}catch(t){console.warn("Error during listener unsubscribe:",t)}}),J=[]},Ca=(e,t)=>{const s=v(),r=P(s,x.CLASSROOMS),n=F(r,q("name")),i=Ie(n,c=>{try{const o=c.docs.map(l=>{const m=l.data();return Se(l.id,m)});e(o)}catch(o){console.error("Classrooms listener error:",o),t?.(o instanceof Error?o:new Error(String(o)))}},c=>{console.error("Classrooms listener error:",c),t?.(c)});return J.push(i),i},bt=(e,t,s)=>{const r=v(),n=P(r,x.BOOKING_REQUESTS);let i;s?i=F(n,V("facultyId","==",s),q("requestDate","desc")):i=F(n,q("requestDate","desc"));const c=Ie(i,o=>{try{const l=o.docs.map(m=>{const g=m.data();return he(m.id,g)});e(l)}catch(l){console.error("BookingRequests listener error:",l),t?.(l instanceof Error?l:new Error(String(l)))}},o=>{console.error("BookingRequests listener error:",o),t?.(o)});return J.push(c),c},vt=(e,t,s)=>{const r=v(),n=P(r,x.SCHEDULES);let i;s?i=F(n,V("facultyId","==",s),q("date"),q("startTime")):i=F(n,q("date"),q("startTime"));const c=Ie(i,o=>{try{const l=o.docs.map(m=>{const g=m.data();return we(m.id,g)});e(l)}catch(l){console.error("Schedules listener error:",l),t?.(l instanceof Error?l:new Error(String(l)))}},o=>{console.error("Schedules listener error:",o),t?.(o)});return J.push(c),c},Ta=(e,t)=>{const s=v(),r=P(s,x.SIGNUP_REQUESTS),n=F(r,q("requestDate","desc")),i=Ie(n,c=>{try{const o=c.docs.map(l=>{const m=l.data();return le(l.id,m)});e(o)}catch(o){console.error("SignupRequests listener error:",o),t?.(o instanceof Error?o:new Error(String(o)))}},c=>{console.error("SignupRequests listener error:",c),t?.(c)});return J.push(i),i},Pa=(e,t)=>{const s=v(),r=P(s,x.USERS),n=F(r,q("name")),i=Ie(n,c=>{try{const o=c.docs.map(l=>{const m=fe(l);return re(l.id,m)});e(o)}catch(o){console.error("Users listener error:",o),t?.(o instanceof Error?o:new Error(String(o)))}},c=>{console.error("Users listener error:",c),t?.(c)});return J.push(i),i},O=e=>{Ze.forEach(t=>{try{t(e)}catch(s){console.error("Auth listener error:",s)}})},_=()=>new Date().toISOString(),Me=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0)),Xe=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0));class St extends Error{status;constructor(t,s){super(s),this.name="AuthStatusError",this.status=t}}const re=(e,t)=>({id:e,email:t.email,name:t.name,role:t.role,department:t.department,status:t.status,failedLoginAttempts:t.failedLoginAttempts||0,accountLocked:t.accountLocked||!1,lockedUntil:t.lockedUntil}),fe=e=>{const t=e.data();if(!t)throw new Error("User record is missing.");return t},Ua=async e=>{const t=e.toLowerCase(),s=v(),r=P(s,x.USERS),n=F(r,V("emailLower","==",t)),i=await H(n);if(i.empty)return null;const c=i.docs[0],o=fe(c);return{id:c.id,record:o}},La=async e=>{const t=v(),s=T(t,x.USERS,e),r=await G(s);if(!r.exists())return null;const n=fe(r);return re(r.id,n)},Se=(e,t)=>({id:e,name:t.name,capacity:t.capacity,equipment:Array.isArray(t.equipment)?t.equipment:[],building:t.building,floor:t.floor,isAvailable:t.isAvailable}),he=(e,t)=>({id:e,facultyId:t.facultyId,facultyName:t.facultyName,classroomId:t.classroomId,classroomName:t.classroomName,date:t.date,startTime:t.startTime,endTime:t.endTime,purpose:t.purpose,status:t.status,requestDate:t.requestDate,adminFeedback:t.adminFeedback}),we=(e,t)=>({id:e,classroomId:t.classroomId,classroomName:t.classroomName,facultyId:t.facultyId,facultyName:t.facultyName,date:t.date,startTime:t.startTime,endTime:t.endTime,purpose:t.purpose,status:t.status}),le=(e,t)=>({id:e,userId:t.uid,email:t.email,name:t.name,department:t.department,requestDate:t.requestDate,status:t.status,adminFeedback:t.adminFeedback,resolvedAt:t.resolvedAt}),_e=(e,t)=>({id:e,userId:t.uid,email:t.email,name:t.name,department:t.department,requestDate:t.requestDate,status:t.status,adminFeedback:t.adminFeedback,resolvedAt:t.resolvedAt,processedBy:t.processedBy});let Et=!1,et=null,Q=null,Ee=!1;const Ne=async(e,t={})=>{const s=v(),r=T(s,x.USERS,e.uid),n=await G(r),i=t.email??e.email;if(!i)throw new Error("Authenticated user is missing an email address.");const c=i.toLowerCase(),o=_();if(!n.exists()){const E=t.role==="admin";let w=E?"approved":"pending",k=t.department,N=t.name??e.displayName??i;if(!E&&!t.status)try{const L=await Be.getById(e.uid);L&&L.status==="approved"&&(w="approved",k=k||L.department,N=t.name||L.name||e.displayName||i)}catch(L){console.warn("Could not fetch signup request for user:",e.uid,L)}const C={email:i,emailLower:c,name:N,role:t.role??(E?"admin":"faculty"),department:k,status:t.status??w,photoURL:t.photoURL??e.photoURL??void 0,lastSignInAt:o,createdAt:o,updatedAt:o},M=Xe(C);return await Ke(r,M),M}const l=fe(n),m={...t,lastSignInAt:o,updatedAt:o};m.role===void 0&&(m.role=l.role),m.status===void 0&&(m.status=l.status),e.displayName&&e.displayName!==l.name&&(m.name=e.displayName),e.photoURL&&e.photoURL!==l.photoURL&&(m.photoURL=e.photoURL);const g=Xe(m);return Object.keys(g).some(E=>E!=="lastSignInAt"&&E!=="updatedAt"&&g[E]!==l[E])||!l.lastSignInAt?(await ne(r,g),{...l,...g}):l},be=()=>{if(Et)return;Et=!0,et=new Promise(t=>{Q=t});const e=te();Ys(e,async t=>{if(Ee){console.log("Auth state change suppressed temporarily (registration/reactivation flow)"),Q&&(Q(),Q=null);return}if(!t){D=null,O(null),W(),Q&&(Q(),Q=null);return}try{try{await t.getIdToken(!0)}catch(n){console.error("Token refresh failed in auth listener:",n),D=null,O(null),W(),Q&&(Q(),Q=null);return}const s=await Ne(t),r=re(t.uid,s);r.status!=="approved"?(D=null,O(null),W()):(D=r,O(r))}catch(s){console.error("Auth state listener error:",s),D=null,O(null),W()}finally{Q&&(Q(),Q=null)}})},Da=e=>{switch(e.code){case"auth/invalid-email":return"The provided email address is invalid.";case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":return"Invalid email or password.";case"auth/email-already-in-use":return"This email is already registered.";case"auth/weak-password":return"Password should be at least 6 characters long.";case"auth/too-many-requests":return"Too many attempts. Please try again later.";case"auth/requires-recent-login":return"Please sign in again before updating your password.";default:return"An authentication error occurred."}},K={async handleRejectedUserReactivation(e,t,s,r){if(!await ke.getByEmail(e))return console.log(`Reactivation attempt for non-existent user ${e}. Treating as new registration.`),this.registerFaculty(e,t,s,r);be();const i=te();Ee=!0;try{const o=(await pt(i,e,t)).user;o&&await gt(o,{displayName:s}).catch(()=>{});const l=await Ne(o,{email:e,name:s,department:r,role:"faculty",status:"pending"}),m=v(),g=_(),S={uid:o.uid,email:l.email,emailLower:l.emailLower,name:l.name,department:r,status:"pending",requestDate:g,createdAt:g,updatedAt:g};return await Ke(T(m,x.SIGNUP_REQUESTS,o.uid),S),await ht(o).catch(()=>{}),{request:le(o.uid,S)}}finally{Ee=!1,await ee(i).catch(()=>{}),D=null,O(null)}},async registerFaculty(e,t,s,r){be();const n=te();Ee=!0;const c=(await Qs(n,e,t)).user;try{c&&await gt(c,{displayName:s}).catch(()=>{});const o=await Ne(c,{email:e,name:s,department:r,role:"faculty",status:"pending"}),l=v(),m=_(),g={uid:c.uid,email:o.email,emailLower:o.emailLower,name:o.name,department:r,status:"pending",requestDate:m,createdAt:m,updatedAt:m};return await Ke(T(l,x.SIGNUP_REQUESTS,c.uid),g),await ht(c).catch(()=>{}),{request:le(c.uid,g)}}catch(o){console.error("Signup failed, cleaning up Auth user:",o);try{await c.delete(),console.log("Auth user deleted successfully")}catch(l){console.error("Failed to delete Auth user:",l)}throw o}finally{Ee=!1,await ee(n).catch(()=>{}),D=null,O(null)}},async signIn(e,t){be();const s=te(),r=v(),n=Oe(ye());try{const c=(await pt(s,e,t)).user;try{await c.getIdToken(!0)}catch(m){console.warn("Failed to refresh token on sign in:",m)}const o=await Ne(c),l=re(c.uid,o);if(l.accountLocked&&l.lockedUntil){const m=new Date(l.lockedUntil),g=new Date;if(g<m){await ee(s),D=null,O(null);const S=Math.ceil((m.getTime()-g.getTime())/6e4);throw new Error(`Account is locked due to too many failed login attempts. Please try again in ${S} minute${S!==1?"s":""}.`)}}if(l.status!=="approved")throw await ee(s),D=null,O(null),W(),new St(l.status,l.status==="pending"?"Your account is awaiting administrator approval.":"Your account was rejected. Please contact the administrator.");try{await Re(n,"resetFailedLogins")(),console.log("âœ… Failed login attempts reset")}catch(m){console.warn("âš ï¸ Failed to call resetFailedLogins cloud function:",m);try{const g=T(r,x.USERS,c.uid);await ne(g,{failedLoginAttempts:0,accountLocked:!1,lockedUntil:null,lastSignInAt:_(),updatedAt:_()})}catch(g){console.error("Failed to reset login attempts (fallback):",g)}}return D=l,O(l),l}catch(i){if(i instanceof St)throw i;if(console.log("ðŸ” Login error details:",{error:i,code:i&&typeof i=="object"&&"code"in i?i.code:"no-code",message:i instanceof Error?i.message:"unknown"}),i&&typeof i=="object"&&"code"in i&&i.code?.startsWith("auth/")){console.log("ðŸ”’ Calling trackFailedLogin for:",e);try{const m=(await Re(n,"trackFailedLogin")({email:e})).data;if(console.log("âœ… trackFailedLogin response:",m),m.locked)throw new Error(m.message||"Account locked due to too many failed login attempts. Please try again in 30 minutes.");if(m.message)throw new Error(m.message)}catch(o){if(console.error("âŒ trackFailedLogin error:",o),o instanceof Error&&(o.message.includes("Account locked")||o.message.includes("attempts remaining")))throw o;console.warn("âš ï¸ Failed to track login attempt:",o)}}throw i instanceof Error&&(i.message.includes("Account locked")||i.message.includes("attempts remaining"))?i:new Error("Invalid credentials. Please check your email and password.")}},async signOut(){const e=te();await ee(e).catch(()=>{}),D=null,O(null),W()},async resetPassword(e){const t=te();try{return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(await Gs(t,e),{success:!0,message:"Password reset instructions sent. If an account exists with this email, you will receive a link shortly."}):{success:!1,message:"Please enter a valid email address."}}catch(s){if(console.error("Password reset error:",s),s&&typeof s=="object"&&"code"in s)switch(s.code){case"auth/invalid-email":return{success:!1,message:"Please enter a valid email address."};case"auth/too-many-requests":return{success:!1,message:"Too many reset attempts. Please try again later."};case"auth/missing-email":return{success:!1,message:"Please enter an email address."};default:return{success:!1,message:"Unable to process request. Please try again or contact support."}}return{success:!1,message:"An unexpected error occurred. Please try again."}}},async confirmPasswordReset(e,t){const s=te();try{return await Hs(s,e,t),{success:!0,message:"Password has been reset successfully. You can now log in with your new password."}}catch(r){const n=r;let i="Failed to reset password. The link may be invalid or expired.";return n.code==="auth/invalid-action-code"?i="The password reset link is invalid or has expired. Please request a new one.":n.code==="auth/weak-password"&&(i="The new password is too weak. Please choose a stronger password."),console.error("Confirm password reset error:",r),{success:!1,message:i}}},async updatePassword(e,t){const s=te(),r=s.currentUser;if(!r||!r.email)return{success:!1,message:"No authenticated user found or user has no email."};try{const n=Ms.credential(r.email,e);return await zs(r,n),await Vs(r,t),await ee(s).catch(()=>{}),D=null,O(null),W(),{success:!0,message:"Password updated successfully. You have been logged out for security.",requiresSignOut:!0}}catch(n){const i=n;return i.code==="auth/wrong-password"||i.code==="auth/invalid-credential"?{success:!1,message:"The current password you entered is incorrect."}:{success:!1,message:Da(i)}}},async getCurrentUser(){if(be(),et&&await et,D)return D;const e=te(),t=e.currentUser;if(!t)return null;try{try{await t.getIdToken(!0)}catch(n){return console.warn("Failed to refresh token:",n),await ee(e),D=null,O(null),W(),null}const s=await Ne(t),r=re(t.uid,s);return r.status!=="approved"?(await ee(e),D=null,O(null),W(),null):(D=r,r)}catch(s){return console.error("Failed to fetch current user:",s),await ee(e).catch(()=>{}),D=null,O(null),W(),null}},async isAuthenticated(){return!!await K.getCurrentUser()},onAuthStateChange(e,t){return be(),Ze.add(e),{data:{subscription:{unsubscribe:()=>{try{Ze.delete(e)}catch(s){console.error("Failed to remove auth listener",s),t?.("Failed to unsubscribe from auth updates")}}}}}},async signOutDueToIdleTimeout(){console.log("ðŸ•’ User session expired due to inactivity - logging out");const e=te();await ee(e).catch(()=>{}),D=null,O(null),W()}},ke={async getAll(){const e=v(),t=P(e,x.USERS),s=F(t,q("name"));return(await H(s)).docs.map(n=>{const i=fe(n);return re(n.id,i)})},async getByEmail(e){const t=await Ua(e);return t?re(t.id,t.record):null},async getById(e){return La(e)},async update(e,t){const s=v(),r=T(s,x.USERS,e),n={updatedAt:_()};typeof t.email=="string"&&(n.email=t.email,n.emailLower=t.email.toLowerCase()),typeof t.name=="string"&&(n.name=t.name),typeof t.role=="string"&&(n.role=t.role),t.department!==void 0&&(n.department=t.department),t.status&&(n.status=t.status);const i=Xe(n);Object.keys(i).length>0&&await ne(r,i);const c=await G(r);if(!c.exists())throw new Error("User not found");const o=fe(c),l=re(c.id,o);return D?.id===e&&l.status==="approved"&&(D=l,O(l)),l},async updateStatus(e,t,s={}){return ke.update(e,{...s,status:t})},async unlockAccount(e){const t=v(),s=T(t,x.USERS,e);await ne(s,{failedLoginAttempts:0,accountLocked:!1,lockedUntil:null,updatedAt:_()});const r=await G(s);if(!r.exists())throw new Error("User not found");const n=fe(r);return re(r.id,n)},async delete(e){const t=v(),s=T(t,x.USERS,e);await pe(s),D?.id===e&&await K.signOut()}},yr={async getAll(){const e=v(),t=P(e,x.CLASSROOMS),s=F(t,q("name"));return(await H(s)).docs.map(n=>{const i=n.data();return Se(n.id,i)})},async getById(e){const t=v(),s=T(t,x.CLASSROOMS,e),r=await G(s);if(!r.exists())return null;const n=r.data();return Se(r.id,n)},async create(e){const t=v(),s={...e,createdAt:_(),updatedAt:_()},r=await Ae(P(t,x.CLASSROOMS),s);return Se(r.id,s)},async update(e,t){const s=v(),r=T(s,x.CLASSROOMS,e),i={...Me(t),updatedAt:_()};await ne(r,i);const c=await G(r);if(!c.exists())throw new Error("Classroom not found");const o=c.data();return Se(c.id,o)},async delete(e){const t=v(),s=T(t,x.CLASSROOMS,e);try{const r=async E=>{for(let k=0;k<E.length;k+=450){const N=E.slice(k,k+450),C=v(),M=C&&C.batch?C.batch():null;if(M)N.forEach(L=>M.delete(L)),await M.commit();else for(const L of N)await pe(L)}},n=P(t,x.BOOKING_REQUESTS),i=F(n,V("classroomId","==",e)),c=await H(i),o=[];for(const E of c.docs){const w=E.data();je(w.date,w.endTime)||o.push(T(t,x.BOOKING_REQUESTS,E.id))}const l=P(t,x.SCHEDULES),m=F(l,V("classroomId","==",e)),g=await H(m),S=[];for(const E of g.docs){const w=E.data();je(w.date,w.endTime)||S.push(T(t,x.SCHEDULES,E.id))}o.length>0&&(await r(o),console.log(`Deleted ${o.length} related booking request(s) for classroom ${e}`)),S.length>0&&(await r(S),console.log(`Deleted ${S.length} related schedule(s) for classroom ${e}`))}catch(r){console.error("Error during cascade deletion for classroom:",r)}await pe(s)},async deleteCascade(e){const t=ye(),s=Oe(t);return(await Re(s,"deleteClassroomCascade")({classroomId:e})).data}},_a=(e,t,s,r)=>e>=s&&e<r||t>s&&t<=r||e<=s&&t>=r,Fe={async getAll(){const e=v(),t=P(e,x.BOOKING_REQUESTS),s=F(t,q("requestDate","desc"));return(await H(s)).docs.map(n=>{const i=n.data();return he(n.id,i)})},async getAllForFaculty(e){const t=v(),s=P(t,x.BOOKING_REQUESTS),r=F(s,V("facultyId","==",e),q("requestDate","desc"));return(await H(r)).docs.map(i=>{const c=i.data();return he(i.id,c)})},async getById(e){const t=v(),s=T(t,x.BOOKING_REQUESTS,e),r=await G(s);if(!r.exists())return null;const n=r.data();return he(r.id,n)},async create(e){const t=v(),s={...e,status:"pending",requestDate:_(),createdAt:_(),updatedAt:_()},r=await Ae(P(t,x.BOOKING_REQUESTS),s);return he(r.id,s)},async update(e,t){const s=v(),r=T(s,x.BOOKING_REQUESTS,e),i={...Me(t),updatedAt:_()};await ne(r,i);const c=await G(r);if(!c.exists())throw new Error("Booking request not found");const o=c.data();return he(c.id,o)},async delete(e){const t=v(),s=T(t,x.BOOKING_REQUESTS,e);await pe(s)},async checkConflicts(e,t,s,r,n){const i=v(),c=P(i,x.BOOKING_REQUESTS),o=F(c,V("classroomId","==",e),V("date","==",t),V("status","in",["pending","approved"])),m=(await H(o)).docs.map(g=>({id:g.id,...g.data()})).filter(g=>g.id!==n);for(const g of m)if(Fa(s,r,g.startTime,g.endTime))return!0;return!1}};function Fa(e,t,s,r){return e>=s&&e<r||t>s&&t<=r||e<=s&&t>=r}const Ge={async getAll(){const e=v(),t=P(e,x.SCHEDULES),s=F(t,q("date"),q("startTime"));return(await H(s)).docs.map(n=>{const i=n.data();return we(n.id,i)})},async getAllForFaculty(e){const t=v(),s=P(t,x.SCHEDULES),r=F(s,V("facultyId","==",e),q("date"),q("startTime"));return(await H(r)).docs.map(i=>{const c=i.data();return we(i.id,c)})},async getById(e){const t=v(),s=T(t,x.SCHEDULES,e),r=await G(s);if(!r.exists())return null;const n=r.data();return we(r.id,n)},async create(e){const t=v(),s={...e,createdAt:_(),updatedAt:_()},r=await Ae(P(t,x.SCHEDULES),s);return we(r.id,s)},async update(e,t){const s=v(),r=T(s,x.SCHEDULES,e),i={...Me(t),updatedAt:_()};await ne(r,i);const c=await G(r);if(!c.exists())throw new Error("Schedule not found");const o=c.data();return we(c.id,o)},async delete(e){const t=v(),s=T(t,x.SCHEDULES,e);await pe(s)},async checkConflict(e,t,s,r,n){const i=v(),c=P(i,x.SCHEDULES);return(await H(F(c,V("classroomId","==",e),V("date","==",t)))).docs.some(l=>{if(n&&l.id===n)return!1;const m=l.data();return m.status==="cancelled"?!1:_a(s,r,m.startTime,m.endTime)})},async cancelApprovedBooking(e){const t=await K.getCurrentUser();if(!t||t.role!=="admin")throw new Error("Only administrators can cancel approved bookings");const s=v(),r=T(s,x.SCHEDULES,e);if(!(await G(r)).exists())throw new Error("Schedule not found");await ne(r,{status:"cancelled",updatedAt:_()})}},Be={async getAll(){const e=v(),t=P(e,x.SIGNUP_REQUESTS),s=F(t,q("requestDate","desc"));return(await H(s)).docs.map(n=>{const i=n.data();return le(n.id,i)})},async getById(e){const t=v(),s=T(t,x.SIGNUP_REQUESTS,e),r=await G(s);if(!r.exists())return null;const n=r.data();return le(r.id,n)},async getByEmail(e){const t=e.toLowerCase(),s=v(),r=P(s,x.SIGNUP_REQUESTS),n=F(r,V("emailLower","==",t),V("status","==","pending")),i=await H(n);if(i.empty)return null;const c=i.docs[0],o=c.data();return le(c.id,o)},async create(e){const t=v(),s=_(),r={uid:e.userId,email:e.email,emailLower:e.email.toLowerCase(),name:e.name,department:e.department,status:"pending",requestDate:s,adminFeedback:e.adminFeedback,resolvedAt:e.resolvedAt,createdAt:s,updatedAt:s},n=await Ae(P(t,x.SIGNUP_REQUESTS),r);return le(n.id,r)},async update(e,t){const s=v(),r=T(s,x.SIGNUP_REQUESTS,e),n=Me(t),i={...n,updatedAt:_()};typeof n.email=="string"&&(i.emailLower=n.email.toLowerCase()),await ne(r,i);const c=await G(r);if(!c.exists())throw new Error("Signup request not found");const o=c.data();return le(c.id,o)},async delete(e){const t=v(),s=T(t,x.SIGNUP_REQUESTS,e);await pe(s)},async rejectAndCleanup(e,t,s){const r=await this.getById(e);if(!r)throw new Error("Signup request not found");const n=_(),i=await tt.create({userId:r.userId,email:r.email,name:r.name,department:r.department,requestDate:r.requestDate,status:"rejected",adminFeedback:s,resolvedAt:n,processedBy:t});try{const c=ye(),o=Oe(c),m=await Re(o,"deleteUserAccount")({userId:r.userId});return console.log("Account deletion result:",m.data),await this.delete(e),i}catch(c){try{await tt.delete(i.id)}catch(o){console.error("Failed to clean up history record after failed rejection:",o)}throw c}},async bulkCleanupRejectedAccounts(){try{const e=ye(),t=Oe(e);return(await Re(t,"bulkCleanupRejectedAccounts")({})).data}catch(e){throw console.error("Bulk cleanup error:",e),new Error(`Failed to perform bulk cleanup: ${e instanceof Error?e.message:"Unknown error"}`)}}},tt={async getAll(){const e=v(),t=P(e,x.SIGNUP_HISTORY),s=F(t,q("resolvedAt","desc"));return(await H(s)).docs.map(n=>{const i=n.data();return _e(n.id,i)})},async getById(e){const t=v(),s=T(t,x.SIGNUP_HISTORY,e),r=await G(s);if(!r.exists())return null;const n=r.data();return _e(r.id,n)},async getByEmail(e){const t=e.toLowerCase(),s=v(),r=P(s,x.SIGNUP_HISTORY),n=F(r,V("emailLower","==",t),q("resolvedAt","desc"));return(await H(n)).docs.map(c=>{const o=c.data();return _e(c.id,o)})},async create(e){const t=v(),s=_(),r={uid:e.userId,email:e.email,emailLower:e.email.toLowerCase(),name:e.name,department:e.department,requestDate:e.requestDate,status:e.status,adminFeedback:e.adminFeedback,resolvedAt:e.resolvedAt,processedBy:e.processedBy,createdAt:s,updatedAt:s},n=await Ae(P(t,x.SIGNUP_HISTORY),r);return _e(n.id,r)},async delete(e){const t=v(),s=T(t,x.SIGNUP_HISTORY,e);await pe(s)}},ve={cleanup(){console.log("ðŸ§¹ Cleaning up real-time listeners..."),J.forEach(e=>{try{e()}catch(t){console.error("Error unsubscribing listener:",t)}}),J=[],Object.values(Ia).forEach(e=>{e.clear()})},subscribeToData(e,t){console.log("ðŸ”„ Setting up real-time listeners for user:",e?.email),this.cleanup();const{onClassroomsUpdate:s,onBookingRequestsUpdate:r,onSchedulesUpdate:n,onSignupRequestsUpdate:i,onUsersUpdate:c,onError:o}=t;try{Ca(s,o),e?.role==="admin"?(bt(r,o),vt(n,o),i&&Ta(i,o),c&&Pa(c,o)):e?.role==="faculty"&&(bt(r,o,e.id),vt(n,o,e.id)),console.log(`âœ… Real-time listeners setup complete for ${e?.role||"anonymous"} user`)}catch(l){console.error("âŒ Failed to setup real-time listeners:",l),o?.(l instanceof Error?l:new Error(String(l)))}},getListenerCount(){return J.length}};function qa({children:e}){const[t,s]=u.useState(""),[r,n]=u.useState(!1),[i,c]=u.useState(!1),[o,l]=u.useState(!1),m=async S=>{if(S.preventDefault(),!t.trim()){b.error("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){b.error("Please enter a valid email address");return}n(!0);try{const w=await K.resetPassword(t);w.success?(l(!0),b.success("Password reset email sent!",{description:"Please check your inbox for the reset link.",duration:5e3})):b.error("Unable to send reset email",{description:w.message,duration:5e3})}catch(w){console.error("Password reset error:",w),b.error("An error occurred",{description:"Please try again or contact your administrator.",duration:5e3})}finally{n(!1)}},g=S=>{c(S),s(""),l(!1),n(!1)};return a.jsxs(ba,{open:i,onOpenChange:g,children:[a.jsx(Wt,{asChild:!0,children:e}),a.jsxs(Zt,{className:"sm:max-w-md",children:[a.jsxs(Ea,{children:[a.jsx(Xt,{className:"text-xl font-semibold",children:"Reset Password"}),a.jsx(es,{children:o?"Check your email for reset instructions":"Enter your email address and we'll send you a link to reset your password."})]}),o?a.jsxs("div",{className:"space-y-6 pt-4",children:[a.jsxs("div",{className:"flex flex-col items-center justify-center py-6 space-y-4",children:[a.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:a.jsx(Fs,{className:"h-8 w-8 text-green-600"})}),a.jsxs("div",{className:"text-center space-y-2",children:[a.jsx("p",{className:"text-sm font-medium",children:"Email sent successfully!"}),a.jsxs("p",{className:"text-xs text-gray-600",children:["Check your inbox at ",a.jsx("span",{className:"font-medium",children:t})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"Don't see it? Check your spam folder."}),a.jsx("p",{className:"text-xs text-amber-600 font-medium",children:"âš ï¸ Link expires in 1 hour"})]})]}),a.jsx(de,{onClick:()=>c(!1),className:"w-full",children:"Close"})]}):a.jsxs("form",{onSubmit:m,className:"space-y-6 pt-4",noValidate:!0,children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(ae,{htmlFor:"reset-email",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"reset-email",type:"email",placeholder:"your.email@plv.edu.ph",value:t,onChange:S=>s(S.target.value),className:"pl-10",disabled:r,autoComplete:"email"})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"You'll receive an email with a link to reset your password."})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(de,{type:"button",variant:"outline",onClick:()=>c(!1),className:"flex-1",disabled:r,children:"Cancel"}),a.jsx(de,{type:"submit",className:"flex-1",disabled:r,children:r?"Sending...":"Send Reset Link"})]})]})]})]})}function Ba({onLogin:e,onSignup:t,users:s}){const[r,n]=u.useState(""),[i,c]=u.useState(""),[o,l]=u.useState({email:"",firstName:"",lastName:"",department:"",password:"",confirmPassword:""}),[m,g]=u.useState(!1),[S,E]=u.useState("login"),[w,k]=u.useState({email:"",password:""}),[N,C]=u.useState({firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""}),M=["Civil Engineering","Information Technology"],L=async A=>{A.preventDefault(),k({email:"",password:""});const $=(Z=>{if(!Z)return Z;let z=Z.replace(/[\r\n\t]/g,"");return z=z.replace(/[\u200B\u200C\u200D\uFEFF]/g,""),z=z.trim(),z})(i);$!==i&&c($);const oe={email:"",password:""};let se=!1;if(r.trim()||(oe.email="Email is required",se=!0),$.trim()||(oe.password="Password is required",se=!0),se){k(oe);return}g(!0);try{await e(r,$)||c("")}finally{g(!1)}},Y=async A=>{A.preventDefault(),C({firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""});const y={firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""};let $=!1;if(o.firstName.trim()||(y.firstName="First name is required",$=!0),o.lastName.trim()||(y.lastName="Last name is required",$=!0),o.email.trim()||(y.email="Email is required",$=!0),o.department||(y.department="Please select a department",$=!0),o.password?o.password.length<8&&(y.password="Password must be at least 8 characters long",$=!0):(y.password="Please create a password",$=!0),o.confirmPassword?o.password!==o.confirmPassword&&(y.confirmPassword="Passwords do not match",$=!0):(y.confirmPassword="Please confirm your password",$=!0),$){C(y);return}const oe=ue=>{if(!ue)return ue;let X=ue.replace(/[\r\n\t]/g,"");return X=X.replace(/[\u200B\u200C\u200D\uFEFF]/g,""),X=X.trim(),X},se=oe(o.password),Z=oe(o.confirmPassword);(se!==o.password||Z!==o.confirmPassword)&&l(ue=>({...ue,password:se,confirmPassword:Z}));const z=`${o.firstName.trim()} ${o.lastName.trim()}`;await t(o.email,z,o.department,o.password)&&(l({email:"",firstName:"",lastName:"",department:"",password:"",confirmPassword:""}),setTimeout(()=>{E("login")},1500))};return a.jsxs("div",{className:"w-full space-y-6",children:[a.jsxs("div",{className:"text-center space-y-4",children:[a.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Welcome Back"}),a.jsx("p",{className:"text-gray-600",children:"Sign in to access the Digital Classroom Assignment System"})]}),a.jsxs(xa,{value:S,onValueChange:E,className:"w-full",children:[a.jsxs(Yt,{className:"grid w-full grid-cols-2 mb-8 bg-gray-100 rounded-xl p-1 mx-auto max-w-full overflow-hidden",children:[a.jsx(We,{value:"login",children:"Faculty Sign In"}),a.jsx(We,{value:"signup",children:"Faculty Request"})]}),a.jsx(Je,{value:"login",className:"space-y-8 mt-8",children:a.jsxs("form",{onSubmit:L,className:"space-y-8",noValidate:!0,children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(ae,{htmlFor:"email",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"email",type:"email",placeholder:"your.email@plv.edu.ph",value:r,onChange:A=>{n(A.target.value),w.email&&k(y=>({...y,email:""}))},className:`pl-10 h-12 rounded-xl ${w.email?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),w.email&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),w.email]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ae,{htmlFor:"password",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"password",type:"password",placeholder:"Enter your password",value:i,onChange:A=>{c(A.target.value),w.password&&k(y=>({...y,password:""}))},className:`pl-10 h-12 rounded-xl ${w.password?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),w.password&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),w.password]}),a.jsx("div",{className:"text-right",children:a.jsx(qa,{children:a.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-700 hover:underline font-medium",children:"Forgot password?"})})})]})]}),a.jsx(de,{type:"submit",className:"w-full h-12 bg-blue-600 hover:bg-blue-700 rounded-xl",disabled:m,children:m?"Signing In...":"Sign In"})]})}),a.jsx(Je,{value:"signup",className:"space-y-8 mt-8",children:a.jsxs("form",{onSubmit:Y,className:"space-y-8",noValidate:!0,children:[a.jsxs("div",{className:"space-y-5",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(ae,{htmlFor:"signup-firstName",children:"First Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(ft,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"signup-firstName",type:"text",placeholder:"First name",value:o.firstName,onChange:A=>{l(y=>({...y,firstName:A.target.value})),N.firstName&&C(y=>({...y,firstName:""}))},className:`pl-10 h-12 rounded-xl ${N.firstName?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.firstName&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.firstName]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ae,{htmlFor:"signup-lastName",children:"Last Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(ft,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"signup-lastName",type:"text",placeholder:"Last name",value:o.lastName,onChange:A=>{l(y=>({...y,lastName:A.target.value})),N.lastName&&C(y=>({...y,lastName:""}))},className:`pl-10 h-12 rounded-xl ${N.lastName?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.lastName&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.lastName]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ae,{htmlFor:"signup-email",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"signup-email",type:"email",placeholder:"your.email@plv.edu.ph",value:o.email,onChange:A=>{l(y=>({...y,email:A.target.value})),N.email&&C(y=>({...y,email:""}))},className:`pl-10 h-12 rounded-xl ${N.email?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.email&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.email]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ae,{htmlFor:"signup-department",children:"Department"}),a.jsxs(ga,{value:o.department,onValueChange:A=>{l(y=>({...y,department:A})),N.department&&C(y=>({...y,department:""}))},required:!0,children:[a.jsx(Gt,{className:`h-12 rounded-xl ${N.department?"border-red-500 focus-visible:ring-red-500":""}`,children:a.jsx(ha,{placeholder:"Select your department"})}),a.jsx(Qt,{children:M.map(A=>a.jsx(Kt,{value:A,children:A},A))})]}),N.department&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.department]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ae,{htmlFor:"signup-password",children:"Create Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"signup-password",type:"password",placeholder:"Enter a strong password",value:o.password,onChange:A=>{l(y=>({...y,password:A.target.value})),N.password&&C(y=>({...y,password:""}))},className:`pl-10 h-12 rounded-xl ${N.password?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.password?a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.password]}):a.jsx("p",{className:"text-xs text-gray-500",children:"Minimum 8 characters. Mix letters, numbers, and symbols for a stronger password."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ae,{htmlFor:"signup-confirm-password",children:"Confirm Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{id:"signup-confirm-password",type:"password",placeholder:"Re-enter your password",value:o.confirmPassword,onChange:A=>{l(y=>({...y,confirmPassword:A.target.value})),N.confirmPassword&&C(y=>({...y,confirmPassword:""}))},className:`pl-10 h-12 rounded-xl ${N.confirmPassword?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),N.confirmPassword&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[a.jsx(ie,{className:"h-3 w-3"}),N.confirmPassword]})]}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Te,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Account Review"}),a.jsx("p",{className:"text-xs text-blue-700",children:"You can sign in with this password once the administrator approves your request. If the request is rejected, the account will remain inactive."})]})]})})]}),a.jsx(de,{type:"submit",className:"w-full h-12 bg-green-600 hover:bg-green-700 rounded-xl",children:"Request Faculty Account"})]})})]})]})}function Nt(){return a.jsx("footer",{className:"bg-white/80 backdrop-blur-xl border-t border-gray-100 py-6 mt-12",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 text-center",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Â© 2025 Pamantasan ng Lungsod ng Valenzuela"}),a.jsx("p",{className:"text-sm text-gray-500",children:"College of Engineering and Information Technology"})]})})})}class Oa extends u.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("ErrorBoundary caught an error:",t,s),(t.message.includes("timeout")||t.message.includes("timed out"))&&console.error("Timeout error detected:",t)}render(){return this.state.hasError?this.props.fallback||a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-pink-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[a.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-red-500 to-pink-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4",children:a.jsx("div",{className:"text-white text-lg font-bold",children:"!"})}),a.jsx("h1",{className:"text-2xl font-bold text-red-800 mb-4",children:"Something went wrong"}),a.jsx("p",{className:"text-red-600 mb-6",children:this.state.error?.message||"An unexpected error occurred"}),a.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:void 0}),window.location.reload()},className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Refresh Page"})]})}):this.props.children}}function $a({...e}){return a.jsx(js,{"data-slot":"alert-dialog",...e})}function xr({...e}){return a.jsx(As,{"data-slot":"alert-dialog-trigger",...e})}function Ma({...e}){return a.jsx(Ns,{"data-slot":"alert-dialog-portal",...e})}const ts=u.forwardRef(({className:e,...t},s)=>a.jsx(Ft,{ref:s,"data-slot":"alert-dialog-overlay",className:U("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t}));ts.displayName=Ft.displayName;const ss=u.forwardRef(({className:e,...t},s)=>a.jsxs(Ma,{children:[a.jsx(ts,{}),a.jsx(qt,{ref:s,"data-slot":"alert-dialog-content",className:U("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...t})]}));ss.displayName=qt.displayName;function za({className:e,...t}){return a.jsx("div",{"data-slot":"alert-dialog-header",className:U("flex flex-col gap-2 text-center sm:text-left",e),...t})}function Va({className:e,...t}){return a.jsx("div",{"data-slot":"alert-dialog-footer",className:U("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...t})}function Ha({className:e,...t}){return a.jsx(ks,{"data-slot":"alert-dialog-title",className:U("text-lg font-semibold",e),...t})}function Ga({className:e,...t}){return a.jsx(Rs,{"data-slot":"alert-dialog-description",className:U("text-muted-foreground text-sm",e),...t})}const Qa=u.forwardRef(({className:e,...t},s)=>a.jsx(Bt,{ref:s,className:U(at(),e),...t}));Qa.displayName=Bt.displayName;const Ka=u.forwardRef(({className:e,...t},s)=>a.jsx(Ot,{ref:s,className:U(at({variant:"outline"}),e),...t}));Ka.displayName=Ot.displayName;function Ya({isOpen:e,timeRemaining:t,onExtendSession:s,onLogout:r}){const[n,i]=u.useState(Math.ceil(t/1e3));u.useEffect(()=>{if(!e)return;const o=setInterval(()=>{const l=Math.ceil(t/1e3);i(l),l<=0&&r()},1e3);return()=>clearInterval(o)},[e,t,r]);const c=o=>{const l=Math.floor(o/60),m=o%60;return`${l}:${m.toString().padStart(2,"0")}`};return a.jsx($a,{open:e,children:a.jsxs(ss,{className:"sm:max-w-md",children:[a.jsxs(za,{children:[a.jsxs(Ha,{className:"flex items-center gap-2",children:[a.jsx(qs,{className:"h-5 w-5 text-amber-500"}),"Session Timeout Warning"]}),a.jsxs(Ga,{className:"space-y-2",children:[a.jsx("p",{children:"Your session will expire due to inactivity. You will be automatically logged out in:"}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-mono font-bold text-amber-600",children:c(n)}),a.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"minutes:seconds"})]}),a.jsx("p",{className:"text-sm text-gray-600",children:'Click "Stay Logged In" to extend your session, or you will be redirected to the login page.'})]})]}),a.jsxs(Va,{className:"flex gap-2",children:[a.jsx(de,{variant:"outline",onClick:r,className:"flex-1",children:"Logout Now"}),a.jsxs(de,{onClick:s,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[a.jsx(Bs,{className:"h-4 w-4 mr-2"}),"Stay Logged In"]})]})]})})}var Wa=(e,t,s,r,n,i,c,o)=>{let l=document.documentElement,m=["light","dark"];function g(w){(Array.isArray(e)?e:[e]).forEach(k=>{let N=k==="class",C=N&&i?n.map(M=>i[M]||M):n;N?(l.classList.remove(...C),l.classList.add(i&&i[w]?i[w]:w)):l.setAttribute(k,w)}),S(w)}function S(w){o&&m.includes(w)&&(l.style.colorScheme=w)}function E(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(r)g(r);else try{let w=localStorage.getItem(t)||s,k=c&&w==="system"?E():w;g(k)}catch{}},Ja=u.createContext(void 0),Za={setTheme:e=>{},themes:[]},Xa=()=>{var e;return(e=u.useContext(Ja))!=null?e:Za};u.memo(({forcedTheme:e,storageKey:t,attribute:s,enableSystem:r,enableColorScheme:n,defaultTheme:i,value:c,themes:o,nonce:l,scriptProps:m})=>{let g=JSON.stringify([s,t,i,e,o,c,r,n]).slice(1,-1);return u.createElement("script",{...m,suppressHydrationWarning:!0,nonce:typeof window>"u"?l:"",dangerouslySetInnerHTML:{__html:`(${Wa.toString()})(${g})`}})});const jt=({...e})=>{const{theme:t="system"}=Xa();return a.jsx(Os,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-white group-[.toaster]:text-gray-900 group-[.toaster]:border-gray-300 group-[.toaster]:shadow-lg",title:"group-[.toast]:text-gray-900 group-[.toast]:font-semibold",description:"!group-[.toast]:text-gray-900",actionButton:"group-[.toast]:bg-blue-600 group-[.toast]:text-white group-[.toast]:hover:bg-blue-700",cancelButton:"group-[.toast]:bg-gray-200 group-[.toast]:text-gray-800 group-[.toast]:hover:bg-gray-300",error:"group-[.toaster]:bg-red-50 group-[.toaster]:text-red-900 group-[.toaster]:border-red-300",success:"group-[.toaster]:bg-green-50 group-[.toaster]:text-green-900 group-[.toaster]:border-green-300",warning:"group-[.toaster]:bg-amber-50 group-[.toaster]:text-amber-900 group-[.toaster]:border-amber-300",info:"group-[.toaster]:bg-blue-50 group-[.toaster]:text-blue-900 group-[.toaster]:border-blue-300"}},style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...e})},er=({timeout:e,onIdle:t,onActive:s,onWarning:r,warningTime:n=300*1e3,disabled:i=!1})=>{const[c,o]=u.useState(!1),[l,m]=u.useState(e),g=u.useRef(null),S=u.useRef(null),E=u.useRef(null),w=u.useRef(Date.now()),k=u.useCallback(()=>{g.current&&(clearTimeout(g.current),g.current=null),S.current&&(clearTimeout(S.current),S.current=null),E.current&&(clearInterval(E.current),E.current=null)},[]),N=u.useCallback(()=>{const Y=Date.now()+e;E.current=setInterval(()=>{const A=Date.now(),y=Math.max(0,Y-A);m(y),y<=0&&(k(),o(!0),t())},1e3)},[e,t,k]),C=u.useCallback(()=>{if(i)return;k(),w.current=Date.now(),m(e),c&&(o(!1),s?.()),N();const L=e-n;L>0&&(S.current=setTimeout(()=>{r?.(n)},L)),g.current=setTimeout(()=>{o(!0),t()},e)},[i,e,n,c,t,s,r,k,N]),M=u.useCallback(()=>{C()},[C]);return u.useEffect(()=>{if(i){k();return}const L=["mousedown","mousemove","keypress","scroll","touchstart","click"];let Y=null;const A=()=>{Y||(Y=setTimeout(()=>{Y=null},1e3),C())};return L.forEach(y=>{document.addEventListener(y,A,!0)}),C(),()=>{L.forEach(y=>{document.removeEventListener(y,A,!0)}),k(),Y&&clearTimeout(Y)}},[i,C,k]),u.useEffect(()=>()=>{k()},[k]),{isIdle:c,timeRemaining:l,extendSession:M,resetTimer:C}},tr=$e.lazy(()=>Mt(()=>import("./AdminDashboard-DlEoVZb1.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),sr=$e.lazy(()=>Mt(()=>import("./FacultyDashboard-DN3MwlIM.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9,10,11,13])));function ar(){const[e,t]=u.useState(null),[s,r]=u.useState([]),[n,i]=u.useState([]),[c,o]=u.useState([]),[l,m]=u.useState([]),[g,S]=u.useState([]),[E,w]=u.useState([]),[k,N]=u.useState(!0),[C,M]=u.useState(!1),[L,Y]=u.useState(null),[A,y]=u.useState(!1),[$,oe]=u.useState(0),se=u.useMemo(()=>e?g.filter(h=>h.facultyId===e.id):[],[g,e]),Z=u.useMemo(()=>e?n.filter(h=>h.facultyId===e.id):[],[n,e]),z=u.useCallback(h=>{if(console.log("ðŸ”„ Setting up real-time data listeners..."),!h){w([]),r([]),o([]),i([]),S([]),ve.cleanup();return}try{N(!0),ve.subscribeToData(h,{onClassroomsUpdate:f=>{console.log("ðŸ“ Real-time update: Classrooms",f.length),r(f)},onBookingRequestsUpdate:f=>{console.log("ðŸ“‹ Real-time update: Booking Requests",f.length),i(f)},onSchedulesUpdate:f=>{console.log("ðŸ“… Real-time update: Schedules",f.length),S(f)},onSignupRequestsUpdate:h.role==="admin"?f=>{console.log("ðŸ‘¥ Real-time update: Signup Requests",f.length),o(f)}:void 0,onUsersUpdate:h.role==="admin"?f=>{console.log("ðŸ‘¤ Real-time update: Users",f.length),w(f)}:void 0,onError:f=>{console.error("âŒ Real-time listener error:",f),b.error("Real-time sync error. Some data may be outdated.")}}),h.role==="faculty"?(w([h]),o([]),m([])):h.role==="admin"&&tt.getAll().then(f=>{console.log("ðŸ“œ Loaded signup history:",f.length),m(f)}).catch(f=>{console.error("âŒ Failed to load signup history:",f)}),console.log("âœ… Real-time listeners setup complete")}catch(f){console.error("âŒ Failed to setup real-time listeners:",f),b.error("Failed to setup real-time data sync")}finally{N(!1)}},[]),rt=u.useCallback(async(h,f)=>{const p=K.signIn(h,f);b.promise(p,{loading:"Signing in...",success:d=>d?(t(d),z(d),`${d.role==="admin"?"Welcome back, Administrator":"Welcome back"}, ${d.name}!`):"Login failed. Please check your credentials.",error:d=>d instanceof Error?d.message:"An unknown login error occurred.",duration:4e3});try{return!!await p}catch{return!1}},[z]);u.useCallback(async(h,f)=>{try{const p=await K.signIn(h,f);if(p){t(p);const d=p.role==="admin"?"Welcome back, Administrator":"Welcome back";return b.success(`${d}, ${p.name}!`,{description:`You're logged in as ${p.role==="admin"?"Administrator":"Faculty"}`,duration:4e3}),z(p),!0}return h&&f&&b.error("Invalid credentials",{description:"Please check your email and password and try again."}),!1}catch(p){if(console.error("Login error:",p),p instanceof Error&&"status"in p){const j=p.status;if(j==="pending")return b.info("Awaiting approval",{description:"Your account is pending administrator approval. Watch your email for updates.",duration:6e3}),!1;if(j==="rejected")return b.error("Account rejected",{description:"Please contact the administrator for assistance.",duration:6e3}),!1}let d="Please check your email and password and try again.";if(p&&typeof p=="object"&&"code"in p){const j=p.code;switch(j){case"auth/invalid-email":d="Invalid email address format.";break;case"auth/user-not-found":d="No account found with this email address.";break;case"auth/wrong-password":d="Incorrect password. Please try again.";break;case"auth/too-many-requests":d="Too many login attempts from this device. Access temporarily restricted by Firebase security. Please wait 15-30 minutes or try password reset.";break;case"auth/user-disabled":d="This account has been disabled.";break;case"permission-denied":d="Permission denied. Please contact administrator.";break;default:"message"in p&&typeof p.message=="string"?d=p.message:d=`Authentication error: ${j}`}}else p instanceof Error&&p.message&&(p.message.includes("Account locked")||p.message.includes("Account is locked")||p.message.includes("attempts remaining"),d=p.message);return b.error("Login failed",{description:d,duration:6e3}),!1}},[z]);const ue=u.useCallback(async(h,f,p,d)=>{try{try{if(await K.getCurrentUser()&&await Be.getByEmail(h))return b.error("Request already pending",{description:"Please wait for an administrator to review your existing request."}),!1}catch(R){console.warn("Could not check for existing requests (possibly unauthenticated):",R instanceof Error?R.message:R)}let j;try{j=(await K.registerFaculty(h,d,f,p)).request}catch(R){if(R?.code==="auth/email-already-in-use")return console.log("Signup failed: email already in use. Directing user to sign in."),b.error("Account already exists",{description:"This email is already associated with an account. Please sign in or use the password reset link if you forgot your password.",duration:8e3}),!1;throw R}o(R=>{const I=R.filter(B=>B.id!==j.id);return[j,...I]});try{if(await K.getCurrentUser()){const I=await ke.getByEmail(h);I&&w(B=>[...B.filter(Ce=>Ce.id!==I.id),I])}}catch(R){console.warn("Could not load user data (possibly unauthenticated):",R instanceof Error?R.message:R)}return j&&b.success("Signup request submitted!",{description:"Your account has been created with pending status. An administrator will approve your access shortly.",duration:6e3}),!0}catch(j){console.error("Signup error:",j);let R="Unable to submit signup request.";if(j&&typeof j=="object")if("code"in j){const I=j.code;switch(I){case"auth/email-already-in-use":R="This email already has an account. Try signing in or resetting your password.";break;case"auth/weak-password":R="Password should be at least 6 characters and hard to guess.";break;case"auth/password-does-not-meet-requirements":R="Password must contain uppercase letter, lowercase letter, number, and special character.";break;case"permission-denied":R="Permission denied. Please check Firebase security rules.";break;default:"message"in j&&typeof j.message=="string"?R=j.message:R=`Firebase error: ${I}`}}else"message"in j&&typeof j.message=="string"&&(R=j.message);else j instanceof Error&&j.message&&(R=j.message);return b.error("Signup failed",{description:R,duration:8e3}),!1}},[]),X=u.useCallback(async()=>{try{console.log("ðŸ”´ Logout clicked - user:",e?.email),await K.signOut(),sessionStorage.setItem("logoutSuccess","true"),t(null),ve.cleanup(),r([]),i([]),o([]),S([]),w([]),console.log("âœ… User state cleared")}catch(h){console.error("âŒ Logout error:",h),t(null),sessionStorage.setItem("logoutError","true"),ve.cleanup(),r([]),i([]),o([]),S([]),w([])}},[e]),nt=u.useCallback(async()=>{console.log("ðŸ•’ Session expired due to inactivity");try{await K.signOutDueToIdleTimeout(),sessionStorage.setItem("sessionExpired","true"),t(null),r([]),i([]),o([]),S([]),w([]),y(!1)}catch(h){console.error("âŒ Idle timeout logout error:",h),sessionStorage.setItem("sessionExpired","true"),t(null),y(!1)}},[]),as=u.useCallback(h=>{console.log(`âš ï¸ Session warning - ${Math.ceil(h/1e3)}s remaining`),oe(h),y(!0),b.warning("Session Expiring Soon",{description:`Your session will expire in ${Math.ceil(h/6e4)} minutes due to inactivity`,duration:8e3})},[]),rs=u.useCallback(()=>{console.log("ðŸ”„ Session extended by user"),y(!1),b.success("Session extended successfully")},[]),{extendSession:ns}=er({timeout:1800*1e3,warningTime:300*1e3,onIdle:nt,onWarning:as,disabled:!e}),ot=u.useCallback(async h=>{r(h)},[]),me=u.useCallback(async(h,f,p,d,j=!1,R)=>{if(j&&je(f,qe(p)))return!0;try{return await Fe.checkConflicts(h,f,p,d,R)}catch(I){return console.error("Error checking conflicts:",I),b.error("Failed to check for conflicts"),!0}},[]),it=u.useCallback(async h=>{try{if(je(h.date,qe(h.startTime))){b.error("Cannot request time slots that have already passed");return}if(await me(h.classroomId,h.date,h.startTime,h.endTime,!1)){b.error("Classroom conflict detected - time slot already booked or has pending request");return}const p=await Fe.create(h);i(d=>[...d,p]),b.success("Classroom request submitted!")}catch(f){console.error("Booking request error:",f);const p=f instanceof Error?f.message:"";p.includes("conflict")||p.includes("duplicate")?b.error("Request failed: time slot was just booked by another user"):b.error("Failed to submit booking request. Please try again.")}},[me]),ct=u.useCallback(async(h,f,p)=>{try{const d=n.find(I=>I.id===h);if(!d){b.error("Request not found");return}if(d.status!=="pending"){b.error("Request has already been processed");return}if(f){if(je(d.date,qe(d.startTime))){b.error("Cannot approve: booking time has already passed");return}if(await me(d.classroomId,d.date,d.startTime,d.endTime,!1,h)){b.error("Cannot approve: conflicts with existing confirmed booking. Please reject this request.");return}}const j={status:f?"approved":"rejected"};p&&p.trim()&&(j.adminFeedback=p.trim());const R=await Fe.update(h,j);if(i(I=>I.map(B=>B.id===h?R:B)),f){const I=await Ge.create({classroomId:d.classroomId,classroomName:d.classroomName,facultyId:d.facultyId,facultyName:d.facultyName,date:d.date,startTime:d.startTime,endTime:d.endTime,purpose:d.purpose,status:"confirmed"});S(B=>[...B,I])}b.success(f?"Request approved!":"Request rejected.")}catch(d){console.error("Approval error:",d),b.error("Failed to process request")}},[n]),lt=u.useCallback(async(h,f,p)=>{try{const d=c.find(R=>R.id===h);if(!d){b.error("Request not found");return}if(d.status!=="pending"){b.error("Request has already been processed");return}const j=new Date().toISOString();if(f){const R=await Be.update(h,{status:"approved",adminFeedback:p||"Account approved",resolvedAt:j}),I=await ke.updateStatus(d.userId,"approved",{name:d.name,department:d.department,role:"faculty"});o(B=>B.map(ge=>ge.id===h?R:ge)),w(B=>{const ge=B.findIndex(ls=>ls.id===I.id);if(ge===-1)return[...B,I];const Ce=[...B];return Ce[ge]=I,Ce}),b.success(`Faculty account approved for ${d.name}!`,{description:"They can now sign in with the password they created during signup.",duration:8e3})}else{if(!p||!p.trim()){b.error("Feedback is required when rejecting a request");return}if(!e){b.error("Admin user information not available");return}if(!window.confirm(`Are you sure you want to reject and permanently delete the account for ${d.name}? This action cannot be undone.`)){b.info("Rejection cancelled");return}await Be.rejectAndCleanup(h,e.id,p),o(I=>I.filter(B=>B.id!==h)),w(I=>I.filter(B=>B.id!==d.userId)),b.success(`Signup request rejected for ${d.name}.`,{description:"The account has been completely removed. They can submit a new signup request.",duration:6e3})}}catch(d){console.error("Signup approval error:",d);const j=d instanceof Error?d.message:"Unknown error occurred";b.error("Failed to process signup request",{description:j,duration:5e3})}},[c]),dt=u.useCallback(async h=>{try{await Ge.cancelApprovedBooking(h),S(f=>f.map(p=>p.id===h?{...p,status:"cancelled"}:p)),b.success("Booking cancelled!")}catch(f){console.error("Cancel schedule error:",f),b.error("Failed to cancel booking")}},[]),ut=u.useCallback(async h=>{try{const f=g.find(p=>p.facultyId===n.find(d=>d.id===h)?.facultyId&&p.date===n.find(d=>d.id===h)?.date&&p.startTime===n.find(d=>d.id===h)?.startTime&&p.endTime===n.find(d=>d.id===h)?.endTime&&p.classroomId===n.find(d=>d.id===h)?.classroomId);f&&(await Ge.cancelApprovedBooking(f.id),S(p=>p.map(d=>d.id===f.id?{...d,status:"cancelled"}:d))),await Fe.update(h,{status:"rejected",adminFeedback:"Booking cancelled by administrator"}),i(p=>p.map(d=>d.id===h?{...d,status:"rejected",adminFeedback:"Booking cancelled by administrator"}:d)),b.success("Approved booking cancelled!")}catch(f){console.error("Cancel approved booking error:",f),b.error("Failed to cancel approved booking")}},[g,n]),mt=u.useCallback(async h=>{try{const f=await ke.unlockAccount(h);w(p=>p.map(d=>d.id===h?f:d)),b.success("Account unlocked successfully!",{description:`${f.name}'s account has been unlocked and can now login.`,duration:5e3})}catch(f){console.error("Unlock account error:",f),b.error("Failed to unlock account",{description:"Please try again or contact support.",duration:5e3})}},[]),os=u.useMemo(()=>({user:e,classrooms:s,bookingRequests:n,signupRequests:c,signupHistory:l,schedules:g,users:E,onLogout:X,onClassroomUpdate:ot,onRequestApproval:ct,onSignupApproval:lt,onCancelSchedule:dt,onCancelApprovedBooking:ut,onUnlockAccount:mt,checkConflicts:me}),[e,s,n,c,l,g,E,X,ot,ct,lt,dt,ut,mt,me]),is=u.useMemo(()=>({user:e,classrooms:s,schedules:se,allSchedules:g,bookingRequests:Z,allBookingRequests:n,onLogout:X,onBookingRequest:it,checkConflicts:me}),[e,s,se,g,Z,n,X,it,me]);if(u.useEffect(()=>{(async()=>{try{console.log("ðŸš€ Initializing app...");const f=await K.getCurrentUser();f?(console.log("âœ… Valid user session found:",f.email),t(f),console.log("ðŸ“Š Setting up real-time listeners..."),z(f),console.log("âœ… Real-time listeners setup")):console.log("â„¹ï¸ No valid session found"),console.log("âœ… App initialized successfully")}catch(f){console.error("âŒ Failed to initialize app:",f);const p=f instanceof Error?f.message:"Unknown error";Y(`Failed to load application data: ${p}. Please refresh the page.`)}finally{console.log("âœ… Setting isLoading to false"),M(!0),N(!1)}})()},[z]),u.useEffect(()=>{const{data:{subscription:h}}=K.onAuthStateChange(async f=>{console.log("ðŸ‘¤ Auth state changed, new user:",f?.email||"none"),t(p=>{if(p?.id===f?.id)return console.log("â„¹ï¸ Same user, skipping update"),p;if(f&&!p){console.log("ðŸ“Š New user detected, setting up listeners...");try{z(f)}catch(d){console.error("Failed to setup listeners after auth change:",d)}}return f})},f=>{console.error("Auth error:",f),b.error("Authentication Error",{description:f,duration:8e3})});return()=>{h.unsubscribe(),ve.cleanup()}},[]),u.useEffect(()=>{e||(sessionStorage.getItem("logoutSuccess")==="true"&&(sessionStorage.removeItem("logoutSuccess"),b.success("Logged out successfully",{description:"You have been signed out",duration:4e3})),sessionStorage.getItem("logoutError")==="true"&&(sessionStorage.removeItem("logoutError"),b.error("Logged out with errors",{description:"Please refresh if you experience any issues",duration:5e3})),sessionStorage.getItem("sessionExpired")==="true"&&(sessionStorage.removeItem("sessionExpired"),b.warning("Session expired",{description:"You have been logged out due to inactivity",duration:5e3})))},[e]),$e.useEffect(()=>{},[e]),L)return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-pink-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[a.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-red-500 to-pink-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4",children:a.jsx("div",{className:"text-white text-lg font-bold",children:"!"})}),a.jsx("h1",{className:"text-2xl font-bold text-red-800 mb-4",children:"Application Error"}),a.jsx("p",{className:"text-red-600 mb-6",children:L}),a.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Refresh Page"}),a.jsx(Ue,{})]})});if(!C||k)return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4 animate-pulse",children:a.jsx("div",{className:"text-white text-lg font-bold",children:"PLV"})}),a.jsx("p",{className:"text-gray-600",children:"Loading..."}),a.jsx(Ue,{})]})});if(!e)return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex flex-col",children:[a.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:a.jsxs("div",{className:"text-center space-y-8 w-full max-w-md",children:[a.jsxs("div",{children:[a.jsx("div",{className:"flex justify-center mb-6",children:a.jsx("div",{className:"h-24 w-24 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:a.jsx("div",{className:"text-white text-2xl font-bold",children:"PLV"})})}),a.jsx("p",{className:"text-blue-600 mb-2",children:"PLV CEIT"}),a.jsx("h1",{className:"mb-6",children:"Digital Classroom"}),a.jsx("p",{className:"text-gray-600 mb-8",children:"Streamlined classroom assignment and booking system for PLV CEIT."})]}),a.jsx("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/20",children:a.jsx(Ba,{onLogin:rt,onSignup:ue,users:E})})]})}),a.jsx(Nt,{}),a.jsx(jt,{}),a.jsx(Ue,{})]});const cs=e;return a.jsx(Oa,{children:a.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[a.jsx("div",{className:"flex-1",children:a.jsx(u.Suspense,{fallback:a.jsx("div",{className:"p-8 flex items-center justify-center",children:a.jsx("div",{className:"text-gray-600",children:"Loading dashboardâ€¦"})}),children:cs.role==="admin"?a.jsx(tr,{...os}):a.jsx(sr,{...is})})}),a.jsx(Nt,{}),a.jsx(Ya,{isOpen:A,timeRemaining:$,onExtendSession:()=>{ns(),rs()},onLogout:nt}),a.jsx(jt,{}),a.jsx(Ue,{})]})})}ta.createRoot(document.getElementById("root")).render(a.jsx($e.StrictMode,{children:a.jsx(ar,{})}));export{$a as A,de as B,xe as C,ba as D,je as E,gr as F,pr as G,K as H,ce as I,ae as L,ga as S,xa as T,Wt as a,Zt as b,U as c,Ea as d,Xt as e,es as f,Gt as g,ha as h,Qt as i,Kt as j,yr as k,Yt as l,We as m,Je as n,wr as o,qe as p,xr as q,ss as r,za as s,Ha as t,Ga as u,Va as v,Ka as w,Qa as x,fr as y,hr as z};
