import{j as s,S as rs,m as as,r as l,L as K,k as $,l as O}from"./radix-vendor-DcvrkFKF.js";import{c as m,M as ts,N as ns,B as v,L as h,I as D,A as is,p as os,q as cs,r as ls,s as ds,t as us,u as ms,v as ws,O as fs}from"./index-QHVuQw2t.js";import{P as ps}from"./phosphor-icons-BJglnZDw.js";import{W as Y,c as G,h as hs,x as F,S as gs,y as xs,U as W,M as bs,z as E,B as ys,L as N,E as T,e as z,d as I}from"./lucide-react-CudZfZVK.js";import{g as vs,h as js}from"./firebase-functions-D39bosM8.js";import{t as d}from"./analytics-sonner-DTMbvkUa.js";import{a as Z}from"./utils-vendor-Cr9tsIwC.js";function L({className:r,...e}){return s.jsx("div",{"data-slot":"card",className:m("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",r),...e})}function B({className:r,...e}){return s.jsx("div",{"data-slot":"card-header",className:m("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",r),...e})}function _({className:r,...e}){return s.jsx("h4",{"data-slot":"card-title",className:m("leading-none",r),...e})}function H({className:r,...e}){return s.jsx("div",{"data-slot":"card-description",className:m("text-muted-foreground",r),...e})}function R({className:r,...e}){return s.jsx("div",{"data-slot":"card-content",className:m("px-6 [&:last-child]:pb-6",r),...e})}const Ps=Z("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Ns({className:r,variant:e,asChild:t=!1,...i}){const c=t?rs:"span";return s.jsx(c,{"data-slot":"badge",className:m(Ps({variant:e}),r),...i})}const Ks=as,Cs=l.forwardRef(({className:r,...e},t)=>s.jsx(K,{ref:t,className:m("bg-gray-100 text-gray-600 relative inline-flex h-10 w-full items-center justify-center rounded-xl p-1",r),...e}));Cs.displayName=K.displayName;const Ss=l.forwardRef(({className:r,...e},t)=>s.jsx($,{ref:t,className:m("relative z-10 inline-flex items-center justify-center whitespace-nowrap rounded-lg px-3 py-1.5 text-sm font-medium ring-offset-background transition-all duration-300 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-900 data-[state=active]:shadow-sm hover:text-gray-900",r),...e}));Ss.displayName=$.displayName;const ks=l.forwardRef(({className:r,...e},t)=>s.jsx(O,{ref:t,className:m("ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...e}));ks.displayName=O.displayName;const q=ps,w=(r,e={})=>{for(const t of r){const i=q[t]??q[`${t}Icon`];if(i)return s.jsx(i,{...e})}return null},g={Projector:w(["ProjectorScreenChart","Projector","ProjectorScreen"],{className:"h-4 w-4"})||s.jsx(xs,{className:"h-4 w-4"}),Computer:w(["Monitor","Desktop"],{className:"h-4 w-4"})||s.jsx(F,{className:"h-4 w-4"}),Computers:w(["Monitor","Desktop"],{className:"h-4 w-4"})||s.jsx(F,{className:"h-4 w-4"}),WiFi:w(["Wifi","WifiSimple"],{className:"h-4 w-4"})||s.jsx(Y,{className:"h-4 w-4"}),Whiteboard:w(["Chalkboard","ChalkboardSimple"],{className:"h-4 w-4"})||s.jsx(gs,{className:"h-4 w-4"}),TV:w(["Television","Tv","MonitorPlay"],{className:"h-4 w-4"})||s.jsx(F,{className:"h-4 w-4"}),Podium:w(["Podium","Presentation","Microphone"],{className:"h-4 w-4"})||s.jsx(hs,{className:"h-4 w-4"}),Speakers:w(["SpeakerHigh","SpeakerSimple"],{className:"h-4 w-4"})||null,Speaker:w(["SpeakerHigh","SpeakerSimple"],{className:"h-4 w-4"})||null,"Air Conditioner":w(["Fan","FanSimple","Snowflake"],{className:"h-4 w-4"})||null,AC:w(["Fan","FanSimple","Snowflake"],{className:"h-4 w-4"})||null},y=r=>r.replace(/[^a-z0-9]/gi,"").toLowerCase(),$s=r=>{if(!r)return null;const e=Object.keys(g).find(c=>y(c)===y(r));if(e&&g[e])return g[e];const t=r.endsWith("s")?r.slice(0,-1):`${r}s`,i=Object.keys(g).find(c=>y(c)===y(t));return i&&g[i]?g[i]:y(r).includes("wifi")?s.jsx(Y,{className:"h-4 w-4"}):s.jsx(G,{className:"h-4 w-4 text-gray-500"})};let C="";const As=r=>{const e="=".repeat((4-r.length%4)%4),t=(r+e).replace(/-/g,"+").replace(/_/g,"/"),i=atob(t),c=new Uint8Array(i.length);for(let o=0;o<i.length;++o)c[o]=i.charCodeAt(o);return c};async function Ds(){if(!("serviceWorker"in navigator))return null;try{return await navigator.serviceWorker.register("/sw.js")}catch(r){return console.warn("SW registration failed:",r),null}}async function Fs(){try{return await Notification.requestPermission()}catch(r){return console.warn("Notification permission request failed",r),"denied"}}async function Es(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return null;const r=await Ds();if(!r)return null;try{if(!C)try{const t=await ts();t&&t.ok&&typeof t.publicKey=="string"&&(C=t.publicKey)}catch(t){console.warn("Failed to retrieve VAPID key from backend",t)}if(!C)throw console.error("Missing VAPID public key (VITE_VAPID_PUBLIC_KEY or getVapidPublicKey callable)"),new Error("Missing VAPID public key for push subscriptions");return await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:As(C)})}catch(e){return console.warn("Push subscription failed:",e),null}}async function Ts(r,e){if(!r)return{ok:!1,message:"No subscription"};try{const t=ns(),i=vs(t),c=js(i,"registerPush"),o={subscription:r.toJSON(),userId:e};return{ok:!0,result:(await c(o)).data}}catch(t){return console.warn("Failed to send subscription to server",t),{ok:!1,message:String(t)}}}async function zs(){if(!("serviceWorker"in navigator))return!1;const r=await navigator.serviceWorker.getRegistration();if(!r)return!1;try{const e=await r.pushManager.getSubscription();return e?await e.unsubscribe():!0}catch(e){return console.warn("Unsubscribe failed",e),!1}}function Os({userId:r}){const[e,t]=l.useState(!1),[i,c]=l.useState(Notification.permission),[o,x]=l.useState(!1);l.useEffect(()=>{t("serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window)},[]);const p=async()=>{const f=await Fs();c(f),f==="granted"?d.success("Notifications enabled"):f==="denied"&&d.error("Notifications denied — change in browser settings to re-enable")},S=async()=>{if(i!=="granted"){d("Please allow notifications first");return}const f=await Es();if(!f){d.error("Subscription failed — check console for details");return}(await Ts(f,r)).ok?(x(!0),d.success("Subscribed to push notifications")):d("Subscribed locally — backend registration failed")},j=async()=>{await zs()?(x(!1),d("Unsubscribed from push notifications")):d.error("Failed to unsubscribe")};return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("div",{className:"hidden sm:flex items-center space-x-2",children:[!e&&s.jsx("p",{className:"text-sm text-gray-500",children:"Push not supported in this browser"}),e&&i!=="granted"&&s.jsx(v,{size:"sm",variant:"outline",onClick:p,children:"Enable Notifications"}),e&&i==="granted"&&!o&&s.jsx(v,{size:"sm",onClick:S,children:"Subscribe"}),e&&i==="granted"&&o&&s.jsx(v,{size:"sm",variant:"destructive",onClick:j,children:"Unsubscribe"})]}),s.jsx("div",{className:"sm:hidden",children:s.jsx(v,{size:"sm",onClick:()=>d("Notifications available in settings"),children:"Notify"})})]})}function Ys({className:r,...e}){return s.jsx("textarea",{"data-slot":"textarea",className:m("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),...e})}const Is=Z("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function Us({className:r,variant:e,...t}){return s.jsx("div",{"data-slot":"alert",role:"alert",className:m(Is({variant:e}),r),...t})}function Vs({className:r,...e}){return s.jsx("div",{"data-slot":"alert-description",className:m("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",r),...e})}function Gs({user:r}){const[e,t]=l.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[i,c]=l.useState(!1),[o,x]=l.useState(!1),[p,S]=l.useState(!1),[j,f]=l.useState(!1),[U,k]=l.useState(!1),[u,b]=l.useState({currentPassword:"",newPassword:"",confirmPassword:""}),J=()=>{const n={currentPassword:"",newPassword:"",confirmPassword:""};let a=!0;if(e.currentPassword||(n.currentPassword="Current password is required",a=!1),!e.newPassword)n.newPassword="New password is required",a=!1;else if(e.newPassword.length<8)n.newPassword="Password must be at least 8 characters long",a=!1;else{const A=/[A-Z]/.test(e.newPassword),P=/[a-z]/.test(e.newPassword),ss=/[0-9]/.test(e.newPassword),es=/[!@#$%^&*(),.?":{}|<>]/.test(e.newPassword);!A||!P||!ss||!es?(n.newPassword="Password must contain uppercase, lowercase, number, and special character",a=!1):e.newPassword===e.currentPassword&&(n.newPassword="New password cannot be the same as the current password",a=!1)}return e.confirmPassword?e.newPassword!==e.confirmPassword&&(n.confirmPassword="Passwords do not match",a=!1):(n.confirmPassword="Please confirm your password",a=!1),b(n),a},V=n=>{if(!n)return n;let a=n.replace(/[\r\n\t]/g,"");return a=a.replace(/[\u200B\u200C\u200D\uFEFF]/g,""),a=a.trim(),a},Q=n=>{n.preventDefault(),b({currentPassword:"",newPassword:"",confirmPassword:""});const a=V(e.newPassword),A=V(e.confirmPassword);t(P=>({...P,newPassword:a,confirmPassword:A})),setTimeout(()=>{J()&&k(!0)},0)},X=async()=>{k(!1),f(!0),d.info("Updating password...",{description:"Please wait while we securely update your password.",duration:2e3});try{const n=await fs.updatePassword(e.currentPassword,e.newPassword);n.success?(d.success("Password Changed Successfully!",{description:"For security, you will now be logged out. Please log back in with your new password.",duration:3e3}),t({currentPassword:"",newPassword:"",confirmPassword:""})):d.error("Failed to update password",{description:n.message})}catch(n){console.error("Password update error:",n);const a=n instanceof Error?n.message:"An error occurred while updating password";d.error("Failed to update password",{description:a})}finally{f(!1)}},M=(n=>{if(n.length===0)return{strength:"",color:""};let a=0;return n.length>=8&&a++,n.length>=12&&a++,/[A-Z]/.test(n)&&a++,/[a-z]/.test(n)&&a++,/[0-9]/.test(n)&&a++,/[!@#$%^&*(),.?":{}|<>]/.test(n)&&a++,a<=2?{strength:"Weak",color:"text-red-600"}:a<=4?{strength:"Fair",color:"text-yellow-600"}:a<=5?{strength:"Good",color:"text-blue-600"}:{strength:"Strong",color:"text-green-600"}})(e.newPassword);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs(L,{children:[s.jsxs(B,{children:[s.jsxs(_,{className:"flex items-center gap-2",children:[s.jsx(W,{className:"h-5 w-5"}),"Profile Information"]}),s.jsx(H,{children:"Your account details and role information"})]}),s.jsx(R,{className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{className:"text-sm font-medium text-gray-600",children:"Full Name"}),s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[s.jsx(W,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"font-medium",children:r.name})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{className:"text-sm font-medium text-gray-600",children:"Email Address"}),s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[s.jsx(bs,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"font-medium",children:r.email})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{className:"text-sm font-medium text-gray-600",children:"Role"}),s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[s.jsx(E,{className:"h-4 w-4 text-gray-500"}),s.jsx(Ns,{variant:r.role==="admin"?"default":"secondary",children:r.role==="admin"?"Administrator":"Faculty"})]})]}),r.department&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{className:"text-sm font-medium text-gray-600",children:"Department"}),s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[s.jsx(ys,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"font-medium",children:r.department})]})]})]})})]}),s.jsxs(L,{children:[s.jsxs(B,{children:[s.jsxs(_,{className:"flex items-center gap-2",children:[s.jsx(N,{className:"h-5 w-5"}),"Change Password"]}),s.jsx(H,{children:"Update your password to keep your account secure"})]}),s.jsxs(R,{children:[s.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[s.jsxs(Us,{children:[s.jsx(E,{className:"h-4 w-4"}),s.jsxs(Vs,{children:[s.jsx("strong",{children:"Security Notice:"})," For your protection, changing your password will sign you out of all active sessions on all devices. You will need to sign back in with your new password."]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium mb-2",children:"Password Requirements:"}),s.jsxs("ul",{className:"text-sm text-muted-foreground list-disc list-inside space-y-1",children:[s.jsx("li",{children:"At least 8 characters long"}),s.jsx("li",{children:"Contains uppercase and lowercase letters"}),s.jsx("li",{children:"Contains at least one number"}),s.jsx("li",{children:"Contains at least one special character (e.g., !@#$%^&*)"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{htmlFor:"current-password",children:"Current Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx(D,{id:"current-password",type:i?"text":"password",placeholder:"Enter your current password",value:e.currentPassword,onChange:n=>{t(a=>({...a,currentPassword:n.target.value})),u.currentPassword&&b(a=>({...a,currentPassword:""}))},className:`pl-10 pr-10 ${u.currentPassword?"border-red-500 focus-visible:ring-red-500":""}`,required:!0}),s.jsx("button",{type:"button",onClick:()=>c(!i),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":i?"Hide current password":"Show current password","aria-pressed":i,title:i?"Hide current password":"Show current password",children:i?s.jsx(T,{className:"h-4 w-4"}):s.jsx(z,{className:"h-4 w-4"})})]}),u.currentPassword&&s.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[s.jsx(I,{className:"h-3 w-3"}),u.currentPassword]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{htmlFor:"new-password",children:"New Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx(D,{id:"new-password",type:o?"text":"password",placeholder:"Enter new password",value:e.newPassword,onChange:n=>{t(a=>({...a,newPassword:n.target.value})),u.newPassword&&b(a=>({...a,newPassword:""}))},className:`pl-10 pr-10 ${u.newPassword?"border-red-500 focus-visible:ring-red-500":""}`,required:!0}),s.jsx("button",{type:"button",onClick:()=>x(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":o?"Hide new password":"Show new password","aria-pressed":o,title:o?"Hide new password":"Show new password",children:o?s.jsx(T,{className:"h-4 w-4"}):s.jsx(z,{className:"h-4 w-4"})})]}),u.newPassword?s.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[s.jsx(I,{className:"h-3 w-3"}),u.newPassword]}):e.newPassword&&s.jsxs("p",{className:`text-sm font-medium ${M.color}`,children:["Strength: ",M.strength]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{htmlFor:"confirm-password",children:"Confirm New Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx(D,{id:"confirm-password",type:p?"text":"password",placeholder:"Confirm new password",value:e.confirmPassword,onChange:n=>{t(a=>({...a,confirmPassword:n.target.value})),u.confirmPassword&&b(a=>({...a,confirmPassword:""}))},className:`pl-10 pr-10 ${u.confirmPassword?"border-red-500 focus-visible:ring-red-500":""}`,required:!0}),s.jsx("button",{type:"button",onClick:()=>S(!p),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":p?"Hide confirm password":"Show confirm password","aria-pressed":p,title:p?"Hide confirm password":"Show confirm password",children:p?s.jsx(T,{className:"h-4 w-4"}):s.jsx(z,{className:"h-4 w-4"})})]}),u.confirmPassword?s.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[s.jsx(I,{className:"h-3 w-3"}),u.confirmPassword]}):e.confirmPassword&&e.newPassword===e.confirmPassword&&s.jsxs("p",{className:"text-sm font-medium text-green-600 flex items-center gap-1",children:[s.jsx(G,{className:"h-3 w-3"}),"Passwords match"]})]})]}),s.jsx("div",{className:"flex gap-3",children:s.jsx(v,{type:"submit",disabled:j||!e.currentPassword||!e.newPassword||!e.confirmPassword,className:"flex-1",children:j?"Updating...":"Update Password"})})]}),s.jsx(is,{open:U,onOpenChange:k,children:s.jsxs(os,{children:[s.jsxs(cs,{children:[s.jsxs(ls,{className:"flex items-center gap-2",children:[s.jsx(E,{className:"h-5 w-5 text-amber-500"}),"Confirm Password Change"]}),s.jsx(ds,{children:s.jsxs("div",{className:"space-y-3 text-sm",children:[s.jsx("p",{children:"Are you sure you want to change your password? This action will:"}),s.jsxs("ul",{className:"list-disc list-inside space-y-1 text-gray-600",children:[s.jsx("li",{children:"Update your account password immediately"}),s.jsx("li",{children:"Log you out from all devices and sessions"}),s.jsx("li",{children:"Require you to log back in with your new password"})]}),s.jsx("p",{className:"font-medium text-amber-600",children:"Make sure you remember your new password before proceeding."})]})})]}),s.jsxs(us,{children:[s.jsx(ms,{children:"Cancel"}),s.jsx(ws,{onClick:X,className:"bg-blue-600 hover:bg-blue-700",children:"Yes, Change Password"})]})]})})]})]})]})}export{Ns as B,L as C,Os as N,Gs as P,Ys as T,B as a,_ as b,H as c,R as d,g as e,Ks as f,$s as g,Cs as h,Ss as i,ks as j};
