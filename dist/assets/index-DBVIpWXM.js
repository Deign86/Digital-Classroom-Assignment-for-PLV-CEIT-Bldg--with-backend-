const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminDashboard-CTwKuHD4.js","assets/radix-vendor-DJ-YvGDu.js","assets/react-vendor-D3F3s8fL.js","assets/card-BzHxhX3E.js","assets/ProfileSettings-CpfM_nvH.js","assets/phosphor-icons-BEaEz7fh.js","assets/lucide-react-zzbXK0ST.js","assets/utils-vendor-Cr9tsIwC.js","assets/analytics-sonner-BjpdSZ9P.js","assets/firebase-firestore-CVEakIoC.js","assets/firebase-core-M-mnVknd.js","assets/firebase-auth-MTDr6AF2.js","assets/firebase-functions-D39bosM8.js","assets/FacultyDashboard-CC17b9pt.js","assets/FacultyDashboard-D27E_wyY.css","assets/SignupHistoryPage-Dgwmultq.js"])))=>i.map(i=>d[i]);
import{r as u,b as ha,j as n,S as ya,P as wa,T as ms,I as xa,c as ba,C as fs,V as va,d as ps,e as Sa,f as Ea,g as Na,h as ja,i as Ra,k as ka,L as gs,l as hs,m as ys,n as Ca,R as te,o as ws,p as kt,O as xs,q as bs,s as vs,D as Ss,t as Ia,u as Aa,v as Es,w as Ns,A as js,x as Rs,y as Ta,z as Pa,B as Ua,E as La,F as _a}from"./radix-vendor-DJ-YvGDu.js";import{a as Fa,g as Da}from"./react-vendor-D3F3s8fL.js";import{t as qa,c as Ba,a as Oa}from"./utils-vendor-Cr9tsIwC.js";import{C as ks,a as $a,b as Ma,X as za,M as pt,c as Va,d as ce,L as Ye,E as ot,e as it,U as Vt,f as Ha,R as Ga}from"./lucide-react-zzbXK0ST.js";import{t as w,T as Wa}from"./analytics-sonner-BjpdSZ9P.js";import{g as Qa,c as L,q as F,o as q,w as G,a as Ee,b as Q,d as _,e as Y,u as le,f as ve,h as He,s as gt,i as Ya}from"./firebase-firestore-CVEakIoC.js";import{s as se,E as Ka,r as Ja,u as Za,c as Xa,a as er,b as Ht,d as tr,e as Gt,f as Wt,g as sr,o as ar}from"./firebase-auth-MTDr6AF2.js";import{B as rr,D as nr,l as or}from"./firebase-core-M-mnVknd.js";import{g as Ie,h as Se}from"./firebase-functions-D39bosM8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();var Ke={},Qt;function ir(){if(Qt)return Ke;Qt=1;var e=Fa();return Ke.createRoot=e.createRoot,Ke.hydrateRoot=e.hydrateRoot,Ke}var lr=ir();const cr=Da(lr),dr="modulepreload",ur=function(e){return"/"+e},Yt={},Ct=function(t,s,a){let r=Promise.resolve();if(s&&s.length>0){let c=function(m){return Promise.all(m.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),i=l?.nonce||l?.getAttribute("nonce");r=c(s.map(m=>{if(m=ur(m),m in Yt)return;Yt[m]=!0;const d=m.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${f}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":dr,d||(p.as="script"),p.crossOrigin="",p.href=m,i&&p.setAttribute("nonce",i),document.head.appendChild(p),d)return new Promise((b,v)=>{p.addEventListener("load",b),p.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(l){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=l,window.dispatchEvent(i),!i.defaultPrevented)throw l}return r.then(l=>{for(const i of l||[])i.status==="rejected"&&o(i.reason);return t().catch(o)})};/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ze(){return ze=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},ze.apply(this,arguments)}var me;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(me||(me={}));const Kt="popstate";function mr(e){e===void 0&&(e={});function t(a,r){let{pathname:o,search:l,hash:i}=a.location;return ht("",{pathname:o,search:l,hash:i},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function s(a,r){return typeof r=="string"?r:Is(r)}return pr(t,s,null,e)}function H(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Cs(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function fr(){return Math.random().toString(36).substr(2,8)}function Jt(e,t){return{usr:e.state,key:e.key,idx:t}}function ht(e,t,s,a){return s===void 0&&(s=null),ze({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Te(t):t,{state:s,key:t&&t.key||a||fr()})}function Is(e){let{pathname:t="/",search:s="",hash:a=""}=e;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),a&&a!=="#"&&(t+=a.charAt(0)==="#"?a:"#"+a),t}function Te(e){let t={};if(e){let s=e.indexOf("#");s>=0&&(t.hash=e.substr(s),e=e.substr(0,s));let a=e.indexOf("?");a>=0&&(t.search=e.substr(a),e=e.substr(0,a)),e&&(t.pathname=e)}return t}function pr(e,t,s,a){a===void 0&&(a={});let{window:r=document.defaultView,v5Compat:o=!1}=a,l=r.history,i=me.Pop,c=null,m=d();m==null&&(m=0,l.replaceState(ze({},l.state,{idx:m}),""));function d(){return(l.state||{idx:null}).idx}function f(){i=me.Pop;let E=d(),N=E==null?null:E-m;m=E,c&&c({action:i,location:S.location,delta:N})}function p(E,N){i=me.Push;let A=ht(S.location,E,N);m=d()+1;let P=Jt(A,m),O=S.createHref(A);try{l.pushState(P,"",O)}catch($){if($ instanceof DOMException&&$.name==="DataCloneError")throw $;r.location.assign(O)}o&&c&&c({action:i,location:S.location,delta:1})}function b(E,N){i=me.Replace;let A=ht(S.location,E,N);m=d();let P=Jt(A,m),O=S.createHref(A);l.replaceState(P,"",O),o&&c&&c({action:i,location:S.location,delta:0})}function v(E){let N=r.location.origin!=="null"?r.location.origin:r.location.href,A=typeof E=="string"?E:Is(E);return A=A.replace(/ $/,"%20"),H(N,"No window.location.(origin|href) available to create URL for href: "+A),new URL(A,N)}let S={get action(){return i},get location(){return e(r,l)},listen(E){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(Kt,f),c=E,()=>{r.removeEventListener(Kt,f),c=null}},createHref(E){return t(r,E)},createURL:v,encodeLocation(E){let N=v(E);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:p,replace:b,go(E){return l.go(E)}};return S}var Zt;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Zt||(Zt={}));function gr(e,t,s){return s===void 0&&(s="/"),hr(e,t,s)}function hr(e,t,s,a){let r=typeof t=="string"?Te(t):t,o=Ps(r.pathname||"/",s);if(o==null)return null;let l=As(e);yr(l);let i=null;for(let c=0;i==null&&c<l.length;++c){let m=Ir(o);i=Rr(l[c],m)}return i}function As(e,t,s,a){t===void 0&&(t=[]),s===void 0&&(s=[]),a===void 0&&(a="");let r=(o,l,i)=>{let c={relativePath:i===void 0?o.path||"":i,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};c.relativePath.startsWith("/")&&(H(c.relativePath.startsWith(a),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(a.length));let m=xe([a,c.relativePath]),d=s.concat(c);o.children&&o.children.length>0&&(H(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+m+'".')),As(o.children,t,d,m)),!(o.path==null&&!o.index)&&t.push({path:m,score:Nr(m,o.index),routesMeta:d})};return e.forEach((o,l)=>{var i;if(o.path===""||!((i=o.path)!=null&&i.includes("?")))r(o,l);else for(let c of Ts(o.path))r(o,l,c)}),t}function Ts(e){let t=e.split("/");if(t.length===0)return[];let[s,...a]=t,r=s.endsWith("?"),o=s.replace(/\?$/,"");if(a.length===0)return r?[o,""]:[o];let l=Ts(a.join("/")),i=[];return i.push(...l.map(c=>c===""?o:[o,c].join("/"))),r&&i.push(...l),i.map(c=>e.startsWith("/")&&c===""?"/":c)}function yr(e){e.sort((t,s)=>t.score!==s.score?s.score-t.score:jr(t.routesMeta.map(a=>a.childrenIndex),s.routesMeta.map(a=>a.childrenIndex)))}const wr=/^:[\w-]+$/,xr=3,br=2,vr=1,Sr=10,Er=-2,Xt=e=>e==="*";function Nr(e,t){let s=e.split("/"),a=s.length;return s.some(Xt)&&(a+=Er),t&&(a+=br),s.filter(r=>!Xt(r)).reduce((r,o)=>r+(wr.test(o)?xr:o===""?vr:Sr),a)}function jr(e,t){return e.length===t.length&&e.slice(0,-1).every((a,r)=>a===t[r])?e[e.length-1]-t[t.length-1]:0}function Rr(e,t,s){let{routesMeta:a}=e,r={},o="/",l=[];for(let i=0;i<a.length;++i){let c=a[i],m=i===a.length-1,d=o==="/"?t:t.slice(o.length)||"/",f=kr({path:c.relativePath,caseSensitive:c.caseSensitive,end:m},d),p=c.route;if(!f)return null;Object.assign(r,f.params),l.push({params:r,pathname:xe([o,f.pathname]),pathnameBase:_r(xe([o,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(o=xe([o,f.pathnameBase]))}return l}function kr(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[s,a]=Cr(e.path,e.caseSensitive,e.end),r=t.match(s);if(!r)return null;let o=r[0],l=o.replace(/(.)\/+$/,"$1"),i=r.slice(1);return{params:a.reduce((m,d,f)=>{let{paramName:p,isOptional:b}=d;if(p==="*"){let S=i[f]||"";l=o.slice(0,o.length-S.length).replace(/(.)\/+$/,"$1")}const v=i[f];return b&&!v?m[p]=void 0:m[p]=(v||"").replace(/%2F/g,"/"),m},{}),pathname:o,pathnameBase:l,pattern:e}}function Cr(e,t,s){t===void 0&&(t=!1),s===void 0&&(s=!0),Cs(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let a=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,i,c)=>(a.push({paramName:i,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(a.push({paramName:"*"}),r+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?r+="\\/*$":e!==""&&e!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,t?void 0:"i"),a]}function Ir(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Cs(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Ps(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,a=e.charAt(s);return a&&a!=="/"?null:e.slice(s)||"/"}function Ar(e,t){t===void 0&&(t="/");let{pathname:s,search:a="",hash:r=""}=typeof e=="string"?Te(e):e;return{pathname:s?s.startsWith("/")?s:Tr(s,t):t,search:Fr(a),hash:Dr(r)}}function Tr(e,t){let s=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(r=>{r===".."?s.length>1&&s.pop():r!=="."&&s.push(r)}),s.length>1?s.join("/"):"/"}function lt(e,t,s,a){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Pr(e){return e.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function Ur(e,t){let s=Pr(e);return t?s.map((a,r)=>r===s.length-1?a.pathname:a.pathnameBase):s.map(a=>a.pathnameBase)}function Lr(e,t,s,a){a===void 0&&(a=!1);let r;typeof e=="string"?r=Te(e):(r=ze({},e),H(!r.pathname||!r.pathname.includes("?"),lt("?","pathname","search",r)),H(!r.pathname||!r.pathname.includes("#"),lt("#","pathname","hash",r)),H(!r.search||!r.search.includes("#"),lt("#","search","hash",r)));let o=e===""||r.pathname==="",l=o?"/":r.pathname,i;if(l==null)i=s;else{let f=t.length-1;if(!a&&l.startsWith("..")){let p=l.split("/");for(;p[0]==="..";)p.shift(),f-=1;r.pathname=p.join("/")}i=f>=0?t[f]:"/"}let c=Ar(r,i),m=l&&l!=="/"&&l.endsWith("/"),d=(o||l===".")&&s.endsWith("/");return!c.pathname.endsWith("/")&&(m||d)&&(c.pathname+="/"),c}const xe=e=>e.join("/").replace(/\/\/+/g,"/"),_r=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Fr=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Dr=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function qr(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const Us=["post","put","patch","delete"];new Set(Us);const Br=["get",...Us];new Set(Br);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ve(){return Ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},Ve.apply(this,arguments)}const It=u.createContext(null),Or=u.createContext(null),st=u.createContext(null),at=u.createContext(null),Ne=u.createContext({outlet:null,matches:[],isDataRoute:!1}),Ls=u.createContext(null);function rt(){return u.useContext(at)!=null}function _s(){return rt()||H(!1),u.useContext(at).location}function Fs(e){u.useContext(st).static||u.useLayoutEffect(e)}function xo(){let{isDataRoute:e}=u.useContext(Ne);return e?Xr():$r()}function $r(){rt()||H(!1);let e=u.useContext(It),{basename:t,future:s,navigator:a}=u.useContext(st),{matches:r}=u.useContext(Ne),{pathname:o}=_s(),l=JSON.stringify(Ur(r,s.v7_relativeSplatPath)),i=u.useRef(!1);return Fs(()=>{i.current=!0}),u.useCallback(function(m,d){if(d===void 0&&(d={}),!i.current)return;if(typeof m=="number"){a.go(m);return}let f=Lr(m,JSON.parse(l),o,d.relative==="path");e==null&&t!=="/"&&(f.pathname=f.pathname==="/"?t:xe([t,f.pathname])),(d.replace?a.replace:a.push)(f,d.state,d)},[t,a,l,o,e])}function bo(){let{matches:e}=u.useContext(Ne),t=e[e.length-1];return t?t.params:{}}function Mr(e,t){return zr(e,t)}function zr(e,t,s,a){rt()||H(!1);let{navigator:r}=u.useContext(st),{matches:o}=u.useContext(Ne),l=o[o.length-1],i=l?l.params:{};l&&l.pathname;let c=l?l.pathnameBase:"/";l&&l.route;let m=_s(),d;if(t){var f;let E=typeof t=="string"?Te(t):t;c==="/"||(f=E.pathname)!=null&&f.startsWith(c)||H(!1),d=E}else d=m;let p=d.pathname||"/",b=p;if(c!=="/"){let E=c.replace(/^\//,"").split("/");b="/"+p.replace(/^\//,"").split("/").slice(E.length).join("/")}let v=gr(e,{pathname:b}),S=Qr(v&&v.map(E=>Object.assign({},E,{params:Object.assign({},i,E.params),pathname:xe([c,r.encodeLocation?r.encodeLocation(E.pathname).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?c:xe([c,r.encodeLocation?r.encodeLocation(E.pathnameBase).pathname:E.pathnameBase])})),o,s,a);return t&&S?u.createElement(at.Provider,{value:{location:Ve({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:me.Pop}},S):S}function Vr(){let e=Zr(),t=qr(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return u.createElement(u.Fragment,null,u.createElement("h2",null,"Unexpected Application Error!"),u.createElement("h3",{style:{fontStyle:"italic"}},t),s?u.createElement("pre",{style:r},s):null,null)}const Hr=u.createElement(Vr,null);class Gr extends u.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,s){return s.location!==t.location||s.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:s.error,location:s.location,revalidation:t.revalidation||s.revalidation}}componentDidCatch(t,s){console.error("React Router caught the following error during render",t,s)}render(){return this.state.error!==void 0?u.createElement(Ne.Provider,{value:this.props.routeContext},u.createElement(Ls.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Wr(e){let{routeContext:t,match:s,children:a}=e,r=u.useContext(It);return r&&r.static&&r.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=s.route.id),u.createElement(Ne.Provider,{value:t},a)}function Qr(e,t,s,a){var r;if(t===void 0&&(t=[]),s===void 0&&(s=null),a===void 0&&(a=null),e==null){var o;if(!s)return null;if(s.errors)e=s.matches;else if((o=a)!=null&&o.v7_partialHydration&&t.length===0&&!s.initialized&&s.matches.length>0)e=s.matches;else return null}let l=e,i=(r=s)==null?void 0:r.errors;if(i!=null){let d=l.findIndex(f=>f.route.id&&i?.[f.route.id]!==void 0);d>=0||H(!1),l=l.slice(0,Math.min(l.length,d+1))}let c=!1,m=-1;if(s&&a&&a.v7_partialHydration)for(let d=0;d<l.length;d++){let f=l[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(m=d),f.route.id){let{loaderData:p,errors:b}=s,v=f.route.loader&&p[f.route.id]===void 0&&(!b||b[f.route.id]===void 0);if(f.route.lazy||v){c=!0,m>=0?l=l.slice(0,m+1):l=[l[0]];break}}}return l.reduceRight((d,f,p)=>{let b,v=!1,S=null,E=null;s&&(b=i&&f.route.id?i[f.route.id]:void 0,S=f.route.errorElement||Hr,c&&(m<0&&p===0?(en("route-fallback"),v=!0,E=null):m===p&&(v=!0,E=f.route.hydrateFallbackElement||null)));let N=t.concat(l.slice(0,p+1)),A=()=>{let P;return b?P=S:v?P=E:f.route.Component?P=u.createElement(f.route.Component,null):f.route.element?P=f.route.element:P=d,u.createElement(Wr,{match:f,routeContext:{outlet:d,matches:N,isDataRoute:s!=null},children:P})};return s&&(f.route.ErrorBoundary||f.route.errorElement||p===0)?u.createElement(Gr,{location:s.location,revalidation:s.revalidation,component:S,error:b,children:A(),routeContext:{outlet:null,matches:N,isDataRoute:!0}}):A()},null)}var Ds=(function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e})(Ds||{}),qs=(function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e})(qs||{});function Yr(e){let t=u.useContext(It);return t||H(!1),t}function Kr(e){let t=u.useContext(Or);return t||H(!1),t}function Jr(e){let t=u.useContext(Ne);return t||H(!1),t}function Bs(e){let t=Jr(),s=t.matches[t.matches.length-1];return s.route.id||H(!1),s.route.id}function Zr(){var e;let t=u.useContext(Ls),s=Kr(),a=Bs();return t!==void 0?t:(e=s.errors)==null?void 0:e[a]}function Xr(){let{router:e}=Yr(Ds.UseNavigateStable),t=Bs(qs.UseNavigateStable),s=u.useRef(!1);return Fs(()=>{s.current=!0}),u.useCallback(function(r,o){o===void 0&&(o={}),s.current&&(typeof r=="number"?e.navigate(r):e.navigate(r,Ve({fromRouteId:t},o)))},[e,t])}const es={};function en(e,t,s){es[e]||(es[e]=!0)}function tn(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function yt(e){H(!1)}function sn(e){let{basename:t="/",children:s=null,location:a,navigationType:r=me.Pop,navigator:o,static:l=!1,future:i}=e;rt()&&H(!1);let c=t.replace(/^\/*/,"/"),m=u.useMemo(()=>({basename:c,navigator:o,static:l,future:Ve({v7_relativeSplatPath:!1},i)}),[c,i,o,l]);typeof a=="string"&&(a=Te(a));let{pathname:d="/",search:f="",hash:p="",state:b=null,key:v="default"}=a,S=u.useMemo(()=>{let E=Ps(d,c);return E==null?null:{location:{pathname:E,search:f,hash:p,state:b,key:v},navigationType:r}},[c,d,f,p,b,v,r]);return S==null?null:u.createElement(st.Provider,{value:m},u.createElement(at.Provider,{children:s,value:S}))}function an(e){let{children:t,location:s}=e;return Mr(wt(t),s)}new Promise(()=>{});function wt(e,t){t===void 0&&(t=[]);let s=[];return u.Children.forEach(e,(a,r)=>{if(!u.isValidElement(a))return;let o=[...t,r];if(a.type===u.Fragment){s.push.apply(s,wt(a.props.children,o));return}a.type!==yt&&H(!1),!a.props.index||!a.props.children||H(!1);let l={id:a.props.id||o.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(l.children=wt(a.props.children,o)),s.push(l)}),s}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const rn="6";try{window.__reactRouterVersion=rn}catch{}const nn="startTransition",ts=ha[nn];function on(e){let{basename:t,children:s,future:a,window:r}=e,o=u.useRef();o.current==null&&(o.current=mr({window:r,v5Compat:!0}));let l=o.current,[i,c]=u.useState({action:l.action,location:l.location}),{v7_startTransition:m}=a||{},d=u.useCallback(f=>{m&&ts?ts(()=>c(f)):c(f)},[c,m]);return u.useLayoutEffect(()=>l.listen(d),[l,d]),u.useEffect(()=>tn(a),[a]),u.createElement(sn,{basename:t,children:s,location:i.location,navigationType:i.action,navigator:l,future:a})}var ss;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(ss||(ss={}));var as;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(as||(as={}));var rs={},ln="@vercel/analytics",cn="1.5.0",dn=()=>{window.va||(window.va=function(...t){(window.vaq=window.vaq||[]).push(t)})};function Os(){return typeof window<"u"}function $s(){try{const e="production"}catch{}return"production"}function un(e="auto"){if(e==="auto"){window.vam=$s();return}window.vam=e}function mn(){return(Os()?window.vam:$s())||"production"}function xt(){return mn()==="development"}function fn(e){return e.scriptSrc?e.scriptSrc:xt()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function pn(e={debug:!0}){var t;if(!Os())return;un(e.mode),dn(),e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend));const s=fn(e);if(document.head.querySelector(`script[src*="${s}"]`))return;const a=document.createElement("script");a.src=s,a.defer=!0,a.dataset.sdkn=ln+(e.framework?`/${e.framework}`:""),a.dataset.sdkv=cn,e.disableAutoTrack&&(a.dataset.disableAutoTrack="1"),e.endpoint?a.dataset.endpoint=e.endpoint:e.basePath&&(a.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(a.dataset.dsn=e.dsn),a.onerror=()=>{const r=xt()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${s}. ${r}`)},xt()&&e.debug===!1&&(a.dataset.debug="false"),document.head.appendChild(a)}function gn({route:e,path:t}){var s;(s=window.va)==null||s.call(window,"pageview",{route:e,path:t})}function hn(){if(!(typeof process>"u"||typeof rs>"u"))return rs.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function Je(e){return u.useEffect(()=>{var t;e.beforeSend&&((t=window.va)==null||t.call(window,"beforeSend",e.beforeSend))},[e.beforeSend]),u.useEffect(()=>{pn({framework:e.framework||"react",basePath:e.basePath??hn(),...e.route!==void 0&&{disableAutoTrack:!0},...e})},[]),u.useEffect(()=>{e.route&&e.path&&gn({route:e.route,path:e.path})},[e.route,e.path]),null}function D(...e){return qa(Ba(e))}const At=Oa("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),fe=u.forwardRef(({className:e,variant:t,size:s,asChild:a=!1,...r},o)=>{const l=a?ya:"button";return n.jsx(l,{"data-slot":"button",className:D(At({variant:t,size:s,className:e})),ref:o,...r})});fe.displayName="Button";function de({className:e,type:t,...s}){return n.jsx("input",{type:t,"data-slot":"input",className:D("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...s})}var yn="Label",Ms=u.forwardRef((e,t)=>n.jsx(wa.label,{...e,ref:t,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));Ms.displayName=yn;var wn=Ms;function oe({className:e,...t}){return n.jsx(wn,{"data-slot":"label",className:D("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...t})}function xn({...e}){return n.jsx(Ra,{"data-slot":"select",...e})}function bn({...e}){return n.jsx(ka,{"data-slot":"select-value",...e})}const zs=u.forwardRef(({className:e,size:t="default",children:s,...a},r)=>n.jsxs(ms,{ref:r,"data-slot":"select-trigger","data-size":t,className:D("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4","border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow,transform] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 data-[state=open]:scale-105 [aria-expanded='true']:scale-105 data-[state=closed]:scale-100 [aria-expanded='false']:scale-100 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...a,children:[s,n.jsx(xa,{asChild:!0,children:n.jsx(ks,{className:"size-4 opacity-50"})})]}));zs.displayName=ms.displayName;const Vs=u.forwardRef(({className:e,children:t,position:s="popper",...a},r)=>n.jsx(ba,{children:n.jsxs(fs,{ref:r,"data-slot":"select-content",className:D("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...a,children:[n.jsx(vn,{}),n.jsx(va,{className:D("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),n.jsx(Sn,{})]})}));Vs.displayName=fs.displayName;const Hs=u.forwardRef(({className:e,children:t,...s},a)=>n.jsxs(ps,{ref:a,"data-slot":"select-item",className:D("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",e),...s,children:[n.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:n.jsx(Sa,{children:n.jsx($a,{className:"size-4"})})}),n.jsx(Ea,{children:t})]}));Hs.displayName=ps.displayName;function vn({className:e,...t}){return n.jsx(Na,{"data-slot":"select-scroll-up-button",className:D("flex cursor-default items-center justify-center py-1",e),...t,children:n.jsx(Ma,{className:"size-4"})})}function Sn({className:e,...t}){return n.jsx(ja,{"data-slot":"select-scroll-down-button",className:D("flex cursor-default items-center justify-center py-1",e),...t,children:n.jsx(ks,{className:"size-4"})})}const En=Ca,Gs=u.forwardRef(({className:e,...t},s)=>n.jsx(gs,{ref:s,className:D("inline-flex h-12 items-center justify-center rounded-xl bg-gray-100 p-1 text-gray-600",e),...t}));Gs.displayName=gs.displayName;const bt=u.forwardRef(({className:e,...t},s)=>n.jsx(hs,{ref:s,className:D("inline-flex items-center justify-center whitespace-nowrap rounded-lg px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-900 data-[state=active]:shadow-sm hover:text-gray-900",e),...t}));bt.displayName=hs.displayName;const vt=u.forwardRef(({className:e,...t},s)=>n.jsx(ys,{ref:s,className:D("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));vt.displayName=ys.displayName;const Ws=u.createContext({announce:()=>{},enabled:!0,setEnabled:()=>{},useTTS:!1,setUseTTS:()=>{}}),Tt=()=>u.useContext(Ws);function Nn({children:e}){const[t,s]=u.useState(()=>{try{const N=localStorage.getItem("a11y:screenReaderEnabled");return N===null?!0:N==="true"}catch{return!0}}),[a,r]=u.useState(""),[o,l]=u.useState(""),[i,c]=u.useState(""),[m,d]=u.useState(()=>{try{return localStorage.getItem("a11y:useTTS")==="true"}catch{return!1}}),f=te.useRef(null),p=te.useRef(null);u.useEffect(()=>{try{localStorage.setItem("a11y:screenReaderEnabled",String(t))}catch{}},[t]),u.useEffect(()=>{try{localStorage.setItem("a11y:useTTS",String(m))}catch{}},[m]);const b=te.useCallback((N,A="polite")=>{if(!(!t&&!m)){try{const P=Date.now(),O=p.current;if(O&&O.msg===N&&P-O.t<1e3)return;p.current={msg:N,t:P}}catch{}try{if(A==="assertive"?(c(""),setTimeout(()=>c(N),50)):(l(""),setTimeout(()=>l(N),50)),m&&typeof window<"u"&&"speechSynthesis"in window)try{const P=window.speechSynthesis;A==="assertive"&&P.cancel();const O=new SpeechSynthesisUtterance(N);O.lang=navigator.language||"en-US",O.rate=1,f.current=O,P.speak(O)}catch(P){console.warn("TTS announce failed",P)}}catch(P){console.warn("Announce failed",P)}}},[t,m]),v=N=>s(N),S=N=>d(N),E=te.useMemo(()=>({announce:b,enabled:t,setEnabled:v,useTTS:m,setUseTTS:S}),[b,t,v,m,S]);return n.jsxs(Ws.Provider,{value:E,children:[e,n.jsxs("div",{className:"sr-only",children:[n.jsx("div",{"aria-live":"polite","aria-atomic":"true",children:o}),n.jsx("div",{"aria-live":"assertive","aria-atomic":"true",children:i})]})]})}function jn({...e}){return n.jsx(Aa,{"data-slot":"dialog",...e})}const Qs=u.forwardRef(({...e},t)=>n.jsx(ws,{ref:t,"data-slot":"dialog-trigger",...e}));Qs.displayName=ws.displayName;function Rn({...e}){return n.jsx(Ia,{"data-slot":"dialog-portal",...e})}const kn=u.forwardRef(({...e},t)=>n.jsx(kt,{ref:t,"data-slot":"dialog-close",...e}));kn.displayName=kt.displayName;const Ys=u.forwardRef(({className:e,...t},s)=>n.jsx(xs,{ref:s,"data-slot":"dialog-overlay",className:D("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t}));Ys.displayName=xs.displayName;const Ks=u.forwardRef(({className:e,children:t,...s},a)=>n.jsxs(Rn,{"data-slot":"dialog-portal",children:[n.jsx(Ys,{}),n.jsxs(bs,{ref:a,"data-slot":"dialog-content",className:D("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...s,children:[t,n.jsxs(kt,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[n.jsx(za,{}),n.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ks.displayName=bs.displayName;function Cn({className:e,...t}){return n.jsx("div",{"data-slot":"dialog-header",className:D("flex flex-col gap-2 text-center sm:text-left",e),...t})}function vo({className:e,...t}){return n.jsx("div",{"data-slot":"dialog-footer",className:D("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...t})}const Js=u.forwardRef(({className:e,...t},s)=>n.jsx(vs,{ref:s,"data-slot":"dialog-title",className:D("text-lg leading-none font-semibold",e),...t}));Js.displayName=vs.displayName;const Zs=u.forwardRef(({className:e,...t},s)=>n.jsx(Ss,{ref:s,"data-slot":"dialog-description",className:D("text-muted-foreground text-sm",e),...t}));Zs.displayName=Ss.displayName;const In={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyApNtEkpd38KXPSS60lAQE8dBjZBd8orPQ",VITE_FIREBASE_APP_ID:"1:361326467083:web:f83bf156d030dcf463cf0e",VITE_FIREBASE_AUTH_DOMAIN:"plv-classroom-assigment.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-BQJCQ8B3H7",VITE_FIREBASE_MESSAGING_SENDER_ID:"361326467083",VITE_FIREBASE_PROJECT_ID:"plv-classroom-assigment",VITE_FIREBASE_STORAGE_BUCKET:"plv-classroom-assigment.firebasestorage.app"},An=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID","VITE_FIREBASE_STORAGE_BUCKET","VITE_FIREBASE_MESSAGING_SENDER_ID","VITE_FIREBASE_APP_ID"],Tn=()=>{const e=[],t=An.reduce((s,a)=>{const r=In[a];return r?s[a]=r:e.push(a),s},{});if(e.length>0)throw new Error(`Missing Firebase environment variables: ${e.join(", ")}. Please create a .env file based on .env.example and restart the dev server.`);return t},Pn=()=>{const e=Tn(),t={apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID};try{return rr().length===0?(console.log("Initializing Firebase app with projectId:",t.projectId),nr(t)):or()}catch(s){throw console.error("Failed to initialize Firebase app:",s),new Error(`Firebase initialization failed: ${s instanceof Error?s.message:"Unknown error"}`)}};let ct=null,dt=null;const pe=()=>(ct||(ct=Pn()),ct),Xs=()=>{if(!dt)try{const e=pe();dt=Qa(e),console.log("Firestore instance initialized for project:",e.options.projectId)}catch(e){throw console.error("Failed to initialize Firestore:",e),new Error(`Firestore initialization failed: ${e instanceof Error?e.message:"Unknown error"}`)}return dt},Pt="notifications",Ut=()=>Xs(),ns=()=>new Date().toISOString(),ut=e=>e==null?null:typeof e=="object"&&typeof e.toDate=="function"?e.toDate().toISOString():typeof e=="string"?e:typeof e=="number"?new Date(e).toISOString():null,ea=(e,t)=>({id:e,userId:t.userId,type:t.type,message:t.message,bookingRequestId:t.bookingRequestId,adminFeedback:t.adminFeedback,acknowledgedBy:t.acknowledgedBy??null,acknowledgedAt:ut(t.acknowledgedAt),createdAt:ut(t.createdAt)??ns(),updatedAt:ut(t.updatedAt)??ns()}),Un=async(e,t,s,a)=>{const r=pe(),o=Ie(r),l=Se(o,"createNotification"),i={userId:e,type:t,message:s,bookingRequestId:a?.bookingRequestId,adminFeedback:a?.adminFeedback},d=(await l(i))?.data?.id;if(!d)throw new Error("Notification creation failed: no id returned");return d},Ln=async(e,t)=>{const s=pe(),a=Ie(s);if(!(await Se(a,"acknowledgeNotification")({notificationId:e}))?.data?.success)throw new Error("Failed to acknowledge notification")},_n=async e=>{const t=Ut(),s=_(t,Pt,e),a=await Y(s);if(!a.exists())return null;const r=a.data();return ea(a.id,r)},Fn=async e=>{const t=Ut(),s=L(t,Pt),a=F(s,G("userId","==",e),G("acknowledgedAt","==",null));return(await Q(a)).size},Dn=(e,t,s)=>{const a=Ut(),r=L(a,Pt);let o;return s?o=F(r,G("userId","==",s),q("createdAt","desc")):o=F(r,q("createdAt","desc")),Ee(o,i=>{try{const c=i.docs.map(m=>{const d=m.data();return ea(m.id,d)});e(c)}catch(c){console.error("Notifications listener error:",c),t?.(c instanceof Error?c:new Error(String(c)))}},i=>{console.error("Notifications listener error (snapshot):",i),t?.(i instanceof Error?i:new Error(String(i)))})},qn={createNotification:Un,acknowledgeNotification:Ln,getNotificationById:_n,getUnreadCount:Fn,setupNotificationsListener:Dn};function tt(e){if(!e)return"";const[t,s]=e.split(":").map(Number),a=t>=12?"PM":"AM";return`${t===0?12:t>12?t-12:t}:${s.toString().padStart(2,"0")} ${a}`}function Ae(e){if(!e)return"";const[t,s]=e.split(" "),[a,r]=t.split(":").map(Number);let o=a;return s==="AM"&&a===12?o=0:s==="PM"&&a!==12&&(o=a+12),`${o.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}function So(){const e=[];for(let t=7;t<=20;t++)for(let s=0;s<60;s+=30){const a=`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;e.push(tt(a))}return e}function Eo(e){const t=Ae(e),[s]=t.split(":").map(Number);return s>=7&&s<=20}function No(e,t){const s=Ae(e),a=Ae(t),[r,o]=s.split(":").map(Number),[l,i]=a.split(":").map(Number),c=r*60+o,f=(l*60+i-c)/60;return f>=.5&&f<=8}function jo(e,t){if(!e)return t;const s=Ae(e),[a,r]=s.split(":").map(Number),o=a*60+r;return t.filter(l=>{const i=Ae(l),[c,m]=i.split(":").map(Number),d=c*60+m,p=(d-o)/60;return d>o&&p<=8&&c<=20})}function Ro(e,t){return`${e} - ${t}`}function $e(e,t){if(!e||!t)return!1;const s=new Date,[a,r,o]=e.split("-").map(Number),l=Ae(t),[i,c]=l.split(":").map(Number),m=new Date(a,r-1,o,i,c,0,0),d=new Date(s.getTime()+300*1e3);return m<=d}let mt=null;const ae=()=>{if(!mt){const e=pe();mt=sr(e)}return mt},j={USERS:"users",CLASSROOMS:"classrooms",BOOKING_REQUESTS:"bookingRequests",SCHEDULES:"schedules",SIGNUP_REQUESTS:"signupRequests",SIGNUP_HISTORY:"signupHistory"};let Ze=null,Xe=null;const C=()=>{if(Xe)throw Xe;if(Ze)return Ze;try{return Ze=Xs(),Ze}catch(e){throw Xe=e instanceof Error?e:new Error(String(e)),Xe}};let M=null;const St=new Set,Bn={classrooms:new Set,bookingRequests:new Set,schedules:new Set,signupRequests:new Set,users:new Set};let X=[];const ee=()=>{console.log(`Unsubscribing from ${X.length} real-time listeners.`),X.forEach(e=>{try{e()}catch(t){console.warn("Error during listener unsubscribe:",t)}}),X=[]},On=(e,t)=>{const s=C(),a=L(s,j.CLASSROOMS),r=F(a,q("name")),o=Ee(r,l=>{try{const i=l.docs.map(c=>{const m=c.data();return Fe(c.id,m)});e(i)}catch(i){console.error("Classrooms listener error:",i),t?.(i instanceof Error?i:new Error(String(i)))}},l=>{console.error("Classrooms listener error:",l),t?.(l)});return X.push(o),o},os=(e,t,s)=>{const a=C(),r=L(a,j.BOOKING_REQUESTS);let o;s?o=F(r,G("facultyId","==",s),q("requestDate","desc")):o=F(r,q("requestDate","desc"));const l=Ee(o,i=>{try{const c=i.docs.map(m=>{const d=m.data();return ke(m.id,d)});e(c)}catch(c){console.error("BookingRequests listener error:",c),t?.(c instanceof Error?c:new Error(String(c)))}},i=>{console.error("BookingRequests listener error:",i),t?.(i)});return X.push(l),l},is=(e,t,s)=>{const a=C(),r=L(a,j.SCHEDULES);let o;s?o=F(r,G("facultyId","==",s),q("date"),q("startTime")):o=F(r,q("date"),q("startTime"));const l=Ee(o,i=>{try{const c=i.docs.map(m=>{const d=m.data();return Ce(m.id,d)});e(c)}catch(c){console.error("Schedules listener error:",c),t?.(c instanceof Error?c:new Error(String(c)))}},i=>{console.error("Schedules listener error:",i),t?.(i)});return X.push(l),l},$n=(e,t)=>{const s=C(),a=L(s,j.SIGNUP_REQUESTS),r=F(a,q("requestDate","desc")),o=Ee(r,l=>{try{const i=l.docs.map(c=>{const m=c.data();return ue(c.id,m)});e(i)}catch(i){console.error("SignupRequests listener error:",i),t?.(i instanceof Error?i:new Error(String(i)))}},l=>{console.error("SignupRequests listener error:",l),t?.(l)});return X.push(o),o},Mn=(e,t)=>{const s=C(),a=L(s,j.SIGNUP_HISTORY),r=F(a,q("resolvedAt","desc")),o=Ee(r,l=>{try{const i=l.docs.map(c=>{const m=c.data();return De(c.id,m)});e(i)}catch(i){console.error("SignupHistory listener error:",i),t?.(i instanceof Error?i:new Error(String(i)))}},l=>{console.error("SignupHistory listener error:",l),t?.(l instanceof Error?l:new Error(String(l)))});return X.push(o),o},zn=(e,t)=>{const s=C(),a=L(s,j.USERS),r=F(a,q("name")),o=Ee(r,l=>{try{const i=l.docs.map(c=>{const m=be(c);return ie(c.id,m)});e(i)}catch(i){console.error("Users listener error:",i),t?.(i instanceof Error?i:new Error(String(i)))}},l=>{console.error("Users listener error:",l),t?.(l)});return X.push(o),o},W=e=>{St.forEach(t=>{try{t(e)}catch(s){console.error("Auth listener error:",s)}})},B=()=>new Date().toISOString(),Ge=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0)),ta=async(e,t)=>{if(!t||t.length===0)return;const s=C(),a=Ya(s);for(const r of t){const o=_(s,e,r.id),l=Ge(r.data);a.set(o,{...l,updatedAt:B()},{merge:!0})}await a.commit()},Et=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0));class ls extends Error{status;constructor(t,s){super(s),this.name="AuthStatusError",this.status=t}}const ie=(e,t)=>({id:e,email:t.email,name:t.name,role:t.role,department:t.department,status:t.status,failedLoginAttempts:t.failedLoginAttempts||0,accountLocked:t.accountLocked||!1,lockedUntil:t.lockedUntil}),be=e=>{const t=e.data();if(!t)throw new Error("User record is missing.");return t},Vn=async e=>{const t=e.toLowerCase(),s=C(),a=L(s,j.USERS),r=F(a,G("emailLower","==",t)),o=await Q(r);if(o.empty)return null;const l=o.docs[0],i=be(l);return{id:l.id,record:i}},Hn=async e=>{const t=C(),s=_(t,j.USERS,e),a=await Y(s);if(!a.exists())return null;const r=be(a);return ie(a.id,r)},Fe=(e,t)=>({id:e,name:t.name,capacity:t.capacity,equipment:Array.isArray(t.equipment)?t.equipment:[],building:t.building,floor:t.floor,isAvailable:t.isAvailable}),ke=(e,t)=>({id:e,facultyId:t.facultyId,facultyName:t.facultyName,classroomId:t.classroomId,classroomName:t.classroomName,date:t.date,startTime:t.startTime,endTime:t.endTime,purpose:t.purpose,status:t.status,requestDate:t.requestDate,adminFeedback:t.adminFeedback}),Ce=(e,t)=>({id:e,classroomId:t.classroomId,classroomName:t.classroomName,facultyId:t.facultyId,facultyName:t.facultyName,date:t.date,startTime:t.startTime,endTime:t.endTime,purpose:t.purpose,status:t.status}),ue=(e,t)=>({id:e,userId:t.uid,email:t.email,name:t.name,department:t.department,requestDate:t.requestDate,status:t.status,adminFeedback:t.adminFeedback,resolvedAt:t.resolvedAt}),De=(e,t)=>({id:e,userId:t.uid,email:t.email,name:t.name,department:t.department,requestDate:t.requestDate,status:t.status,adminFeedback:t.adminFeedback,resolvedAt:t.resolvedAt,processedBy:t.processedBy});let cs=!1,Nt=null,K=null,qe=!1;const Be=async(e,t={})=>{const s=C(),a=_(s,j.USERS,e.uid),r=await Y(a),o=t.email??e.email;if(!o)throw new Error("Authenticated user is missing an email address.");const l=o.toLowerCase(),i=B();if(!r.exists()){const p=t.role==="admin";let b=p?"approved":"pending",v=t.department,S=t.name??e.displayName??o;if(!p&&!t.status)try{const A=await Oe.getById(e.uid);A&&A.status==="approved"&&(b="approved",v=v||A.department,S=t.name||A.name||e.displayName||o)}catch(A){console.warn("Could not fetch signup request for user:",e.uid,A)}const E={email:o,emailLower:l,name:S,role:t.role??(p?"admin":"faculty"),department:v,status:t.status??b,photoURL:t.photoURL??e.photoURL??void 0,lastSignInAt:i,createdAt:i,updatedAt:i},N=Et(E);return await gt(a,N),N}const c=be(r),m={...t,lastSignInAt:i,updatedAt:i};m.role===void 0&&(m.role=c.role),m.status===void 0&&(m.status=c.status),e.displayName&&e.displayName!==c.name&&(m.name=e.displayName),e.photoURL&&e.photoURL!==c.photoURL&&(m.photoURL=e.photoURL);const d=Et(m);return Object.keys(d).some(p=>p!=="lastSignInAt"&&p!=="updatedAt"&&d[p]!==c[p])||!c.lastSignInAt?(await le(a,d),{...c,...d}):c},Le=()=>{if(cs)return;cs=!0,Nt=new Promise(t=>{K=t});const e=ae();ar(e,async t=>{if(qe){console.log("Auth state change suppressed temporarily (registration/reactivation flow)"),K&&(K(),K=null);return}if(!t){M=null,W(null),ee(),K&&(K(),K=null);return}try{try{await t.getIdToken(!0)}catch(r){console.error("Token refresh failed in auth listener:",r),M=null,W(null),ee(),K&&(K(),K=null);return}const s=await Be(t),a=ie(t.uid,s);a.status!=="approved"?(M=null,W(null),ee()):(M=a,W(a))}catch(s){console.error("Auth state listener error:",s),M=null,W(null),ee()}finally{K&&(K(),K=null)}})},Gn=e=>{switch(e.code){case"auth/invalid-email":return"The provided email address is invalid.";case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":return"Invalid email or password.";case"auth/email-already-in-use":return"This email is already registered.";case"auth/weak-password":return"Password should be at least 6 characters long.";case"auth/too-many-requests":return"Too many attempts. Please try again later.";case"auth/requires-recent-login":return"Please sign in again before updating your password.";default:return"An authentication error occurred."}},J={async handleRejectedUserReactivation(e,t,s,a){if(!await Me.getByEmail(e))return console.log(`Reactivation attempt for non-existent user ${e}. Treating as new registration.`),this.registerFaculty(e,t,s,a);Le();const o=ae();qe=!0;try{const i=(await Ht(o,e,t)).user;i&&await Gt(i,{displayName:s}).catch(()=>{});const c=await Be(i,{email:e,name:s,department:a,role:"faculty",status:"pending"}),m=C(),d=B(),f={uid:i.uid,email:c.email,emailLower:c.emailLower,name:c.name,department:a,status:"pending",requestDate:d,createdAt:d,updatedAt:d};return await gt(_(m,j.SIGNUP_REQUESTS,i.uid),f),await Wt(i).catch(()=>{}),{request:ue(i.uid,f)}}finally{qe=!1,await se(o).catch(()=>{}),M=null,W(null)}},async registerFaculty(e,t,s,a){Le();const r=ae();qe=!0;const l=(await tr(r,e,t)).user;try{l&&await Gt(l,{displayName:s}).catch(()=>{});const i=await Be(l,{email:e,name:s,department:a,role:"faculty",status:"pending"}),c=C(),m=B(),d={uid:l.uid,email:i.email,emailLower:i.emailLower,name:i.name,department:a,status:"pending",requestDate:m,createdAt:m,updatedAt:m};return await gt(_(c,j.SIGNUP_REQUESTS,l.uid),d),await Wt(l).catch(()=>{}),{request:ue(l.uid,d)}}catch(i){console.error("Signup failed, cleaning up Auth user:",i);try{await l.delete(),console.log("Auth user deleted successfully")}catch(c){console.error("Failed to delete Auth user:",c)}throw i}finally{qe=!1,await se(r).catch(()=>{}),M=null,W(null)}},async signIn(e,t){Le();const s=ae(),a=C(),r=Ie(pe());try{const l=(await Ht(s,e,t)).user;try{await l.getIdToken(!0)}catch(m){console.warn("Failed to refresh token on sign in:",m)}const i=await Be(l),c=ie(l.uid,i);if(c.accountLocked&&c.lockedUntil){const m=new Date(c.lockedUntil),d=new Date;if(d<m){await se(s),M=null,W(null);const f=Math.ceil((m.getTime()-d.getTime())/6e4);throw new Error(`Account is locked due to too many failed login attempts. Please try again in ${f} minute${f!==1?"s":""}.`)}}if(c.status!=="approved")throw await se(s),M=null,W(null),ee(),new ls(c.status,c.status==="pending"?"Your account is awaiting administrator approval.":"Your account was rejected. Please contact the administrator.");try{await Se(r,"resetFailedLogins")(),console.log(" Failed login attempts reset")}catch(m){console.warn(" Failed to call resetFailedLogins cloud function:",m);try{const d=_(a,j.USERS,l.uid);await le(d,{failedLoginAttempts:0,accountLocked:!1,lockedUntil:null,lastSignInAt:B(),updatedAt:B()})}catch(d){console.error("Failed to reset login attempts (fallback):",d)}}return M=c,W(c),c}catch(o){if(o instanceof ls)throw o;if(console.log(" Login error details:",{error:o,code:o&&typeof o=="object"&&"code"in o?o.code:"no-code",message:o instanceof Error?o.message:"unknown"}),o&&typeof o=="object"&&"code"in o&&o.code?.startsWith("auth/")){console.log(" Calling trackFailedLogin for:",e);try{const m=(await Se(r,"trackFailedLogin")({email:e})).data;if(console.log(" trackFailedLogin response:",m),m.locked)throw new Error(m.message||"Account locked due to too many failed login attempts. Please try again in 30 minutes.");if(m.message)throw new Error(m.message)}catch(i){if(console.error(" trackFailedLogin error:",i),i instanceof Error&&(i.message.includes("Account locked")||i.message.includes("attempts remaining")))throw i;console.warn(" Failed to track login attempt:",i)}}throw o instanceof Error&&(o.message.includes("Account locked")||o.message.includes("attempts remaining"))?o:new Error("Invalid credentials. Please check your email and password.")}},async signOut(){const e=ae();await se(e).catch(()=>{}),M=null,W(null),ee()},async resetPassword(e){const t=ae();try{return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(await er(t,e),{success:!0,message:"Password reset instructions sent. If an account exists with this email, you will receive a link shortly."}):{success:!1,message:"Please enter a valid email address."}}catch(s){if(console.error("Password reset error:",s),s&&typeof s=="object"&&"code"in s)switch(s.code){case"auth/invalid-email":return{success:!1,message:"Please enter a valid email address."};case"auth/too-many-requests":return{success:!1,message:"Too many reset attempts. Please try again later."};case"auth/missing-email":return{success:!1,message:"Please enter an email address."};default:return{success:!1,message:"Unable to process request. Please try again or contact support."}}return{success:!1,message:"An unexpected error occurred. Please try again."}}},async confirmPasswordReset(e,t){const s=ae();try{return await Xa(s,e,t),{success:!0,message:"Password has been reset successfully. You can now log in with your new password."}}catch(a){const r=a;let o="Failed to reset password. The link may be invalid or expired.";return r.code==="auth/invalid-action-code"?o="The password reset link is invalid or has expired. Please request a new one.":r.code==="auth/weak-password"&&(o="The new password is too weak. Please choose a stronger password."),console.error("Confirm password reset error:",a),{success:!1,message:o}}},async updatePassword(e,t){const s=ae(),a=s.currentUser;if(!a||!a.email)return{success:!1,message:"No authenticated user found or user has no email."};try{const r=Ka.credential(a.email,e);return await Ja(a,r),await Za(a,t),await se(s).catch(()=>{}),M=null,W(null),ee(),{success:!0,message:"Password updated successfully. You have been logged out for security.",requiresSignOut:!0}}catch(r){const o=r;return o.code==="auth/wrong-password"||o.code==="auth/invalid-credential"?{success:!1,message:"The current password you entered is incorrect."}:{success:!1,message:Gn(o)}}},async getCurrentUser(){if(Le(),Nt&&await Nt,M)return M;const e=ae(),t=e.currentUser;if(!t)return null;try{try{await t.getIdToken(!0)}catch(r){return console.warn("Failed to refresh token:",r),await se(e),M=null,W(null),ee(),null}const s=await Be(t),a=ie(t.uid,s);return a.status!=="approved"?(await se(e),M=null,W(null),ee(),null):(M=a,a)}catch(s){return console.error("Failed to fetch current user:",s),await se(e).catch(()=>{}),M=null,W(null),ee(),null}},async isAuthenticated(){return!!await J.getCurrentUser()},onAuthStateChange(e,t){return Le(),St.add(e),{data:{subscription:{unsubscribe:()=>{try{St.delete(e)}catch(s){console.error("Failed to remove auth listener",s),t?.("Failed to unsubscribe from auth updates")}}}}}},async signOutDueToIdleTimeout(){console.log(" User session expired due to inactivity - logging out");const e=ae();await se(e).catch(()=>{}),M=null,W(null),ee()}},Me={async getAll(){const e=C(),t=L(e,j.USERS),s=F(t,q("name"));return(await Q(s)).docs.map(r=>{const o=be(r);return ie(r.id,o)})},async getByEmail(e){const t=await Vn(e);return t?ie(t.id,t.record):null},async getById(e){return Hn(e)},async update(e,t){const s=C(),a=_(s,j.USERS,e),r={updatedAt:B()};typeof t.email=="string"&&(r.email=t.email,r.emailLower=t.email.toLowerCase()),typeof t.name=="string"&&(r.name=t.name),typeof t.role=="string"&&(r.role=t.role),t.department!==void 0&&(r.department=t.department),t.status&&(r.status=t.status);const o=Et(r);Object.keys(o).length>0&&await le(a,o);const l=await Y(a);if(!l.exists())throw new Error("User not found");const i=be(l),c=ie(l.id,i);return M?.id===e&&c.status==="approved"&&(M=c,W(c)),c},async updateStatus(e,t,s={}){return Me.update(e,{...s,status:t})},async unlockAccount(e){const t=C(),s=_(t,j.USERS,e);await le(s,{failedLoginAttempts:0,accountLocked:!1,lockedUntil:null,updatedAt:B()});const a=await Y(s);if(!a.exists())throw new Error("User not found");const r=be(a);return ie(a.id,r)},async delete(e){const t=C(),s=_(t,j.USERS,e);await ve(s),M?.id===e&&await J.signOut()}},ko={async getAll(){const e=C(),t=L(e,j.CLASSROOMS),s=F(t,q("name"));return(await Q(s)).docs.map(r=>{const o=r.data();return Fe(r.id,o)})},async getById(e){const t=C(),s=_(t,j.CLASSROOMS,e),a=await Y(s);if(!a.exists())return null;const r=a.data();return Fe(a.id,r)},async create(e){const t=C(),s={...e,createdAt:B(),updatedAt:B()},a=await He(L(t,j.CLASSROOMS),s);return Fe(a.id,s)},async update(e,t){const s=C(),a=_(s,j.CLASSROOMS,e),o={...Ge(t),updatedAt:B()};await le(a,o);const l=await Y(a);if(!l.exists())throw new Error("Classroom not found");const i=l.data();return Fe(l.id,i)},async delete(e){const t=C(),s=_(t,j.CLASSROOMS,e);try{const a=async p=>{for(let v=0;v<p.length;v+=450){const S=p.slice(v,v+450),N=C().batch?.();if(N)S.forEach(A=>N.delete(A)),await N.commit();else for(const A of S)await ve(A)}},r=L(t,j.BOOKING_REQUESTS),o=F(r,G("classroomId","==",e)),l=await Q(o),i=[];for(const p of l.docs){const b=p.data();$e(b.date,b.endTime)||i.push(_(t,j.BOOKING_REQUESTS,p.id))}const c=L(t,j.SCHEDULES),m=F(c,G("classroomId","==",e)),d=await Q(m),f=[];for(const p of d.docs){const b=p.data();$e(b.date,b.endTime)||f.push(_(t,j.SCHEDULES,p.id))}i.length>0&&(await a(i),console.log(`Deleted ${i.length} related booking request(s) for classroom ${e}`)),f.length>0&&(await a(f),console.log(`Deleted ${f.length} related schedule(s) for classroom ${e}`))}catch(a){console.error("Error during cascade deletion for classroom:",a)}await ve(s)},async deleteCascade(e){const t=pe(),s=Ie(t);return(await Se(s,"deleteClassroomCascade")({classroomId:e})).data}},Wn=(e,t,s,a)=>e>=s&&e<a||t>s&&t<=a||e<=s&&t>=a,et={async getAll(){const e=C(),t=L(e,j.BOOKING_REQUESTS),s=F(t,q("requestDate","desc"));return(await Q(s)).docs.map(r=>{const o=r.data();return ke(r.id,o)})},async getAllForFaculty(e){const t=C(),s=L(t,j.BOOKING_REQUESTS),a=F(s,G("facultyId","==",e),q("requestDate","desc"));return(await Q(a)).docs.map(o=>{const l=o.data();return ke(o.id,l)})},async getById(e){const t=C(),s=_(t,j.BOOKING_REQUESTS,e),a=await Y(s);if(!a.exists())return null;const r=a.data();return ke(a.id,r)},async create(e){const t=C(),s={...e,status:"pending",requestDate:B(),createdAt:B(),updatedAt:B()},a=await He(L(t,j.BOOKING_REQUESTS),s);return ke(a.id,s)},async update(e,t){const s=C(),a=_(s,j.BOOKING_REQUESTS,e),o={...Ge(t),updatedAt:B()};await le(a,o);const l=await Y(a);if(!l.exists())throw new Error("Booking request not found");const i=l.data();if(o.status==="approved"||o.status==="rejected"||o.status==="cancelled")try{const c=o.status,m=c==="cancelled"?"cancelled":`was ${c}`,d=c==="cancelled"?`Your approved reservation for ${i.classroomName} on ${i.date} ${i.startTime}-${i.endTime} was cancelled.`:`Your booking request for ${i.classroomName} on ${i.date} ${i.startTime}-${i.endTime} ${m}.`;await jt.createNotification(i.facultyId,c,d,{bookingRequestId:l.id,adminFeedback:o.adminFeedback})}catch(c){console.warn("Could not create notification after booking update:",c)}return ke(l.id,i)},async delete(e){const t=C(),s=_(t,j.BOOKING_REQUESTS,e);await ve(s)},async checkConflicts(e,t,s,a,r){const o=C(),l=L(o,j.BOOKING_REQUESTS),i=F(l,G("classroomId","==",e),G("date","==",t),G("status","in",["pending","approved"])),m=(await Q(i)).docs.map(d=>({id:d.id,...d.data()})).filter(d=>d.id!==r);for(const d of m)if(Qn(s,a,d.startTime,d.endTime))return!0;return!1},async bulkUpdate(e){const t=e.map(s=>({id:s.id,data:s.data}));await ta(j.BOOKING_REQUESTS,t)}};function Qn(e,t,s,a){return e>=s&&e<a||t>s&&t<=a||e<=s&&t>=a}const ft={async getAll(){const e=C(),t=L(e,j.SCHEDULES),s=F(t,q("date"),q("startTime"));return(await Q(s)).docs.map(r=>{const o=r.data();return Ce(r.id,o)})},async getAllForFaculty(e){const t=C(),s=L(t,j.SCHEDULES),a=F(s,G("facultyId","==",e),q("date"),q("startTime"));return(await Q(a)).docs.map(o=>{const l=o.data();return Ce(o.id,l)})},async getById(e){const t=C(),s=_(t,j.SCHEDULES,e),a=await Y(s);if(!a.exists())return null;const r=a.data();return Ce(a.id,r)},async create(e){const t=C(),s={...e,createdAt:B(),updatedAt:B()},a=await He(L(t,j.SCHEDULES),s);return Ce(a.id,s)},async update(e,t){const s=C(),a=_(s,j.SCHEDULES,e),o={...Ge(t),updatedAt:B()};await le(a,o);const l=await Y(a);if(!l.exists())throw new Error("Schedule not found");const i=l.data();return Ce(l.id,i)},async delete(e){const t=C(),s=_(t,j.SCHEDULES,e);await ve(s)},async checkConflict(e,t,s,a,r){const o=C(),l=L(o,j.SCHEDULES);return(await Q(F(l,G("classroomId","==",e),G("date","==",t)))).docs.some(c=>{if(r&&c.id===r)return!1;const m=c.data();return m.status==="cancelled"?!1:Wn(s,a,m.startTime,m.endTime)})},async cancelApprovedBooking(e){const t=await J.getCurrentUser();if(!t||t.role!=="admin")throw new Error("Only administrators can cancel approved bookings");const s=C(),a=_(s,j.SCHEDULES,e);if(!(await Y(a)).exists())throw new Error("Schedule not found");await le(a,{status:"cancelled",updatedAt:B()})}},Oe={async getAll(){const e=C(),t=L(e,j.SIGNUP_REQUESTS),s=F(t,q("requestDate","desc"));return(await Q(s)).docs.map(r=>{const o=r.data();return ue(r.id,o)})},async getById(e){const t=C(),s=_(t,j.SIGNUP_REQUESTS,e),a=await Y(s);if(!a.exists())return null;const r=a.data();return ue(a.id,r)},async getByEmail(e){const t=e.toLowerCase(),s=C(),a=L(s,j.SIGNUP_REQUESTS),r=F(a,G("emailLower","==",t),G("status","==","pending")),o=await Q(r);if(o.empty)return null;const l=o.docs[0],i=l.data();return ue(l.id,i)},async create(e){const t=C(),s=B(),a={uid:e.userId,email:e.email,emailLower:e.email.toLowerCase(),name:e.name,department:e.department,status:"pending",requestDate:s,adminFeedback:e.adminFeedback,resolvedAt:e.resolvedAt,createdAt:s,updatedAt:s},r=await He(L(t,j.SIGNUP_REQUESTS),a);return ue(r.id,a)},async update(e,t){const s=C(),a=_(s,j.SIGNUP_REQUESTS,e),r=Ge(t),o={...r,updatedAt:B()};typeof r.email=="string"&&(o.emailLower=r.email.toLowerCase()),await le(a,o);const l=await Y(a);if(!l.exists())throw new Error("Signup request not found");const i=l.data();if(o.status==="approved"||o.status==="rejected")try{await jt.createNotification(i.uid,o.status==="approved"?"approved":"rejected",o.status==="approved"?"Your account request has been approved. You can now sign in.":`Your account request was rejected. Admin feedback: ${o.adminFeedback||"No feedback provided."}`,{adminFeedback:o.adminFeedback})}catch(c){console.warn("Failed to create signup notification:",c)}return ue(l.id,i)},async delete(e){const t=C(),s=_(t,j.SIGNUP_REQUESTS,e);await ve(s)},async rejectAndCleanup(e,t,s){const a=await this.getById(e);if(!a)throw new Error("Signup request not found");const r=B(),o=await Rt.create({userId:a.userId,email:a.email,name:a.name,department:a.department,requestDate:a.requestDate,status:"rejected",adminFeedback:s,resolvedAt:r,processedBy:t});try{await jt.createNotification(a.userId,"rejected",`Your signup request was rejected by an administrator. Feedback: ${s}`,{adminFeedback:s})}catch(l){console.warn("Failed to notify user about signup rejection cleanup:",l)}try{const l=pe(),i=Ie(l),m=await Se(i,"deleteUserAccount")({userId:a.userId});return console.log("Account deletion result:",m.data),await this.delete(e),o}catch(l){try{await Rt.delete(o.id)}catch(i){console.error("Failed to clean up history record after failed rejection:",i)}throw l}},async bulkCleanupRejectedAccounts(){try{const e=pe(),t=Ie(e);return(await Se(t,"bulkCleanupRejectedAccounts")({})).data}catch(e){throw console.error("Bulk cleanup error:",e),new Error(`Failed to perform bulk cleanup: ${e instanceof Error?e.message:"Unknown error"}`)}},async bulkUpdate(e){const t=e.map(s=>({id:s.id,data:s.data}));await ta(j.SIGNUP_REQUESTS,t)}},jt=qn,Rt={async getAll(){const e=C(),t=L(e,j.SIGNUP_HISTORY),s=F(t,q("resolvedAt","desc"));return(await Q(s)).docs.map(r=>{const o=r.data();return De(r.id,o)})},async getById(e){const t=C(),s=_(t,j.SIGNUP_HISTORY,e),a=await Y(s);if(!a.exists())return null;const r=a.data();return De(a.id,r)},async getByEmail(e){const t=e.toLowerCase(),s=C(),a=L(s,j.SIGNUP_HISTORY),r=F(a,G("emailLower","==",t),q("resolvedAt","desc"));return(await Q(r)).docs.map(l=>{const i=l.data();return De(l.id,i)})},async create(e){const t=C(),s=B(),a={uid:e.userId,email:e.email,emailLower:e.email.toLowerCase(),name:e.name,department:e.department,requestDate:e.requestDate,status:e.status,adminFeedback:e.adminFeedback,resolvedAt:e.resolvedAt,processedBy:e.processedBy,createdAt:s,updatedAt:s},r=await He(L(t,j.SIGNUP_HISTORY),a);return De(r.id,a)},async delete(e){const t=C(),s=_(t,j.SIGNUP_HISTORY,e);await ve(s)}},_e={cleanup(){console.log(" Cleaning up real-time listeners..."),X.forEach(e=>{try{e()}catch(t){console.error("Error unsubscribing listener:",t)}}),X=[],Object.values(Bn).forEach(e=>{e.clear()})},subscribeToData(e,t){console.log(" Setting up real-time listeners for user:",e?.email),this.cleanup();const{onClassroomsUpdate:s,onBookingRequestsUpdate:a,onSchedulesUpdate:r,onSignupRequestsUpdate:o,onSignupHistoryUpdate:l,onUsersUpdate:i,onError:c}=t;try{On(s,c),e?.role==="admin"?(os(a,c),is(r,c),o&&$n(o,c),l&&Mn(l,c),i&&zn(i,c)):e?.role==="faculty"&&(os(a,c,e.id),is(r,c,e.id)),console.log(` Real-time listeners setup complete for ${e?.role||"anonymous"} user`)}catch(m){console.error(" Failed to setup real-time listeners:",m),c?.(m instanceof Error?m:new Error(String(m)))}},getListenerCount(){return X.length}};function Yn({children:e}){const[t,s]=u.useState(""),[a,r]=u.useState(!1),[o,l]=u.useState(!1),[i,c]=u.useState(!1),m=async f=>{if(f.preventDefault(),!t.trim()){w.error("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){w.error("Please enter a valid email address");return}r(!0);try{const b=await J.resetPassword(t);b.success?(c(!0),w.success("Password reset email sent!",{description:"Please check your inbox for the reset link.",duration:5e3})):w.error("Unable to send reset email",{description:b.message,duration:5e3})}catch(b){console.error("Password reset error:",b),w.error("An error occurred",{description:"Please try again or contact your administrator.",duration:5e3})}finally{r(!1)}},d=f=>{l(f),s(""),c(!1),r(!1)};return n.jsxs(jn,{open:o,onOpenChange:d,children:[n.jsx(Qs,{asChild:!0,children:e}),n.jsxs(Ks,{className:"sm:max-w-md",children:[n.jsxs(Cn,{children:[n.jsx(Js,{className:"text-xl font-semibold",children:"Reset Password"}),n.jsx(Zs,{children:i?"Check your email for reset instructions":"Enter your email address and we'll send you a link to reset your password."})]}),i?n.jsxs("div",{className:"space-y-6 pt-4",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center py-6 space-y-4",children:[n.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:n.jsx(Va,{className:"h-8 w-8 text-green-600"})}),n.jsxs("div",{className:"text-center space-y-2",children:[n.jsx("p",{className:"text-sm font-medium",children:"Email sent successfully!"}),n.jsxs("p",{className:"text-xs text-gray-600",children:["Check your inbox at ",n.jsx("span",{className:"font-medium",children:t})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"Don't see it? Check your spam folder."}),n.jsx("p",{className:"text-xs text-amber-600 font-medium",children:" Link expires in 1 hour"})]})]}),n.jsx(fe,{onClick:()=>l(!1),className:"w-full",children:"Close"})]}):n.jsxs("form",{onSubmit:m,className:"space-y-6 pt-4",noValidate:!0,children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(oe,{htmlFor:"reset-email",children:"Email Address"}),n.jsxs("div",{className:"relative",children:[n.jsx(pt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),n.jsx(de,{id:"reset-email",type:"email",placeholder:"your.email@plv.edu.ph",value:t,onChange:f=>s(f.target.value),className:"pl-10",disabled:a,autoComplete:"email"})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"You'll receive an email with a link to reset your password."})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(fe,{type:"button",variant:"outline",onClick:()=>l(!1),className:"flex-1",disabled:a,children:"Cancel"}),n.jsx(fe,{type:"submit",className:"flex-1",disabled:a,children:a?"Sending...":"Send Reset Link"})]})]})]})]})}function Kn({onLogin:e,onSignup:t,users:s}){const[a,r]=u.useState(""),[o,l]=u.useState(""),[i,c]=u.useState({email:"",firstName:"",lastName:"",department:"",password:"",confirmPassword:""}),[m,d]=u.useState(!1),[f,p]=u.useState("login"),[b,v]=u.useState({email:"",password:""}),[S,E]=u.useState({firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""}),[N,A]=u.useState(!1),[P,O]=u.useState(!1),[$,nt]=u.useState(!1),{announce:je}=Tt(),ge=["Civil Engineering","Information Technology"],he=T=>{if(!T)return T;let R=T.replace(/[[\r\n\t]]/g,"");return R=R.replace(/[\u200B\u200C\u200D\uFEFF]/g,""),R=R.trim(),R},We=T=>{const R={firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""};let z=!1;return T.firstName.trim()||(R.firstName="First name is required",z=!0),T.lastName.trim()||(R.lastName="Last name is required",z=!0),T.email.trim()||(R.email="Email is required",z=!0),T.department||(R.department="Please select a department",z=!0),T.password?T.password.length<8&&(R.password="Password must be at least 8 characters long",z=!0):(R.password="Please create a password",z=!0),T.confirmPassword?T.password!==T.confirmPassword&&(R.confirmPassword="Passwords do not match",z=!0):(R.confirmPassword="Please confirm your password",z=!0),{errors:R,hasErrors:z}},Qe=async T=>{T.preventDefault(),v({email:"",password:""});const R=he(o);R!==o&&l(R);const z={email:"",password:""};let ne=!1;if(a.trim()||(z.email="Email is required",ne=!0),R.trim()||(z.password="Password is required",ne=!0),ne){v(z);try{je(Object.values(z).filter(Boolean).join(". "),"assertive")}catch{}return}d(!0);try{if(await e(a,R))try{je("Login successful. Redirecting to your dashboard.","polite")}catch{}else{l("");try{je("Login failed. Please check your email and password.","assertive")}catch{}}}finally{d(!1)}},re=async T=>{T.preventDefault(),E({firstName:"",lastName:"",email:"",department:"",password:"",confirmPassword:""});const{errors:R,hasErrors:z}=We(i);if(z){E(R);return}const ne=he(i.password),Re=he(i.confirmPassword);(ne!==i.password||Re!==i.confirmPassword)&&c(Ue=>({...Ue,password:ne,confirmPassword:Re}));const Pe=`${i.firstName.trim()} ${i.lastName.trim()}`;if(await t(i.email,Pe,i.department,i.password)){c({email:"",firstName:"",lastName:"",department:"",password:"",confirmPassword:""});try{je("Signup request submitted. You will be notified when your account is approved.","polite")}catch{}setTimeout(()=>{p("login")},1500)}};return n.jsxs("div",{className:"w-full space-y-6",children:[n.jsxs("div",{className:"text-center space-y-4",children:[n.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Welcome Back"}),n.jsx("p",{className:"text-gray-600",children:"Sign in to access the Digital Classroom Assignment System"})]}),n.jsxs(En,{value:f,onValueChange:p,className:"w-full",children:[n.jsxs(Gs,{className:"grid w-full grid-cols-2 mb-8 bg-gray-100 rounded-xl p-1 mx-auto max-w-full overflow-hidden",children:[n.jsx(bt,{value:"login",children:"Faculty Sign In"}),n.jsx(bt,{value:"signup",children:"Faculty Request"})]}),n.jsx(vt,{value:"login",className:"space-y-8 mt-8",children:n.jsxs("form",{onSubmit:Qe,className:"space-y-8",noValidate:!0,children:[n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(oe,{htmlFor:"email",children:"Email Address"}),n.jsxs("div",{className:"relative",children:[n.jsx(pt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),n.jsx(de,{id:"email",type:"email",placeholder:"your.email@plv.edu.ph",value:a,onChange:T=>{r(T.target.value),b.email&&v(R=>({...R,email:""}))},className:`pl-10 h-12 rounded-xl ${b.email?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),b.email&&n.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[n.jsx(ce,{className:"h-3 w-3"}),b.email]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(oe,{htmlFor:"password",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),n.jsx(de,{id:"password",type:N?"text":"password",placeholder:"Enter your password",value:o,onChange:T=>{l(T.target.value),b.password&&v(R=>({...R,password:""}))},className:`pl-10 h-12 rounded-xl ${b.password?"border-red-500 focus-visible:ring-red-500":""}`,required:!0}),n.jsx("button",{type:"button",onClick:()=>A(!N),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":N?"Hide password":"Show password","aria-pressed":N,title:N?"Hide password":"Show password",children:N?n.jsx(ot,{className:"h-4 w-4"}):n.jsx(it,{className:"h-4 w-4"})})]}),b.password&&n.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[n.jsx(ce,{className:"h-3 w-3"}),b.password]}),n.jsx("div",{className:"text-right",children:n.jsx(Yn,{children:n.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-700 hover:underline font-medium",children:"Forgot password?"})})})]})]}),n.jsx(fe,{type:"submit",className:"w-full h-12 bg-blue-600 hover:bg-blue-700 rounded-xl",disabled:m,children:m?"Signing In...":"Sign In"})]})}),n.jsx(vt,{value:"signup",className:"space-y-8 mt-8",children:n.jsxs("form",{onSubmit:re,className:"space-y-8",noValidate:!0,children:[n.jsxs("div",{className:"space-y-5",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(oe,{htmlFor:"signup-firstName",children:"First Name"}),n.jsxs("div",{className:"relative",children:[n.jsx(Vt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),n.jsx(de,{id:"signup-firstName",type:"text",placeholder:"First name",value:i.firstName,onChange:T=>{c(R=>({...R,firstName:T.target.value})),S.firstName&&E(R=>({...R,firstName:""}))},className:`pl-10 h-12 rounded-xl ${S.firstName?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),S.firstName&&n.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[n.jsx(ce,{className:"h-3 w-3"}),S.firstName]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(oe,{htmlFor:"signup-lastName",children:"Last Name"}),n.jsxs("div",{className:"relative",children:[n.jsx(Vt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),n.jsx(de,{id:"signup-lastName",type:"text",placeholder:"Last name",value:i.lastName,onChange:T=>{c(R=>({...R,lastName:T.target.value})),S.lastName&&E(R=>({...R,lastName:""}))},className:`pl-10 h-12 rounded-xl ${S.lastName?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),S.lastName&&n.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[n.jsx(ce,{className:"h-3 w-3"}),S.lastName]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(oe,{htmlFor:"signup-email",children:"Email Address"}),n.jsxs("div",{className:"relative",children:[n.jsx(pt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),n.jsx(de,{id:"signup-email",type:"email",placeholder:"your.email@plv.edu.ph",value:i.email,onChange:T=>{c(R=>({...R,email:T.target.value})),S.email&&E(R=>({...R,email:""}))},className:`pl-10 h-12 rounded-xl ${S.email?"border-red-500 focus-visible:ring-red-500":""}`,required:!0})]}),S.email&&n.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[n.jsx(ce,{className:"h-3 w-3"}),S.email]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(oe,{htmlFor:"signup-department",children:"Department"}),n.jsxs(xn,{value:i.department,onValueChange:T=>{c(R=>({...R,department:T})),S.department&&E(R=>({...R,department:""}))},required:!0,children:[n.jsx(zs,{className:`h-12 rounded-xl ${S.department?"border-red-500 focus-visible:ring-red-500":""}`,children:n.jsx(bn,{placeholder:"Select your department"})}),n.jsx(Vs,{children:ge.map(T=>n.jsx(Hs,{value:T,children:T},T))})]}),S.department&&n.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[n.jsx(ce,{className:"h-3 w-3"}),S.department]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(oe,{htmlFor:"signup-password",children:"Create Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),n.jsx(de,{id:"signup-password",type:P?"text":"password",placeholder:"Enter a strong password",value:i.password,onChange:T=>{c(R=>({...R,password:T.target.value})),S.password&&E(R=>({...R,password:""}))},className:`pl-10 h-12 rounded-xl ${S.password?"border-red-500 focus-visible:ring-red-500":""}`,required:!0}),n.jsx("button",{type:"button",onClick:()=>O(!P),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":P?"Hide password":"Show password","aria-pressed":P,title:P?"Hide password":"Show password",children:P?n.jsx(ot,{className:"h-4 w-4"}):n.jsx(it,{className:"h-4 w-4"})})]}),S.password?n.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[n.jsx(ce,{className:"h-3 w-3"}),S.password]}):n.jsxs("div",{className:"text-sm text-gray-700 text-left",children:[n.jsx("p",{className:"font-medium mb-1",children:"Password Requirements:"}),n.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs text-gray-600 text-left pl-4",children:[n.jsx("li",{children:"At least 8 characters long"}),n.jsx("li",{children:"Contains uppercase and lowercase letters"}),n.jsx("li",{children:"Contains at least one number"}),n.jsx("li",{children:"Contains at least one special character (e.g., !@#$%^&*)"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(oe,{htmlFor:"signup-confirm-password",children:"Confirm Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),n.jsx(de,{id:"signup-confirm-password",type:$?"text":"password",placeholder:"Re-enter your password",value:i.confirmPassword,onChange:T=>{c(R=>({...R,confirmPassword:T.target.value})),S.confirmPassword&&E(R=>({...R,confirmPassword:""}))},className:`pl-10 h-12 rounded-xl ${S.confirmPassword?"border-red-500 focus-visible:ring-red-500":""}`,required:!0}),n.jsx("button",{type:"button",onClick:()=>nt(!$),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":$?"Hide confirm password":"Show confirm password","aria-pressed":$,title:$?"Hide confirm password":"Show confirm password",children:$?n.jsx(ot,{className:"h-4 w-4"}):n.jsx(it,{className:"h-4 w-4"})})]}),S.confirmPassword&&n.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[n.jsx(ce,{className:"h-3 w-3"}),S.confirmPassword]})]}),n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Ye,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Account Review"}),n.jsx("p",{className:"text-xs text-blue-700",children:"You can sign in with this password once the administrator approves your request. If the request is rejected, the account will remain inactive."})]})]})})]}),n.jsx(fe,{type:"submit",className:"w-full h-12 bg-green-600 hover:bg-green-700 rounded-xl",children:"Request Faculty Account"})]})})]})]})}function ds(){return n.jsx("footer",{className:"bg-white/80 backdrop-blur-xl border-t border-gray-100 py-6 mt-12",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 text-center",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm text-gray-600",children:" 2025 Pamantasan ng Lungsod ng Valenzuela"}),n.jsx("p",{className:"text-sm text-gray-500",children:"College of Engineering and Information Technology"})]})})})}class Jn extends u.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("ErrorBoundary caught an error:",t,s),(t.message.includes("timeout")||t.message.includes("timed out"))&&console.error("Timeout error detected:",t)}render(){return this.state.hasError?this.props.fallback||n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-pink-50 flex items-center justify-center",children:n.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[n.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-red-500 to-pink-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4",children:n.jsx("div",{className:"text-white text-lg font-bold",children:"!"})}),n.jsx("h1",{className:"text-2xl font-bold text-red-800 mb-4",children:"Something went wrong"}),n.jsx("p",{className:"text-red-600 mb-6",children:this.state.error?.message||"An unexpected error occurred"}),n.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:void 0}),window.location.reload()},className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Refresh Page"})]})}):this.props.children}}function sa({...e}){return n.jsx(Pa,{"data-slot":"alert-dialog",...e})}function Co({...e}){return n.jsx(Ua,{"data-slot":"alert-dialog-trigger",...e})}function Zn({...e}){return n.jsx(Ta,{"data-slot":"alert-dialog-portal",...e})}const aa=u.forwardRef(({className:e,...t},s)=>n.jsx(Es,{ref:s,"data-slot":"alert-dialog-overlay",className:D("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t}));aa.displayName=Es.displayName;const Lt=u.forwardRef(({className:e,children:t,...s},a)=>{const r=u.useId(),o=u.Children.map(t,l=>u.isValidElement(l)&&l.props?.["data-slot"]==="alert-dialog-title"?u.cloneElement(l,{id:r}):l);return n.jsxs(Zn,{children:[n.jsx(aa,{}),n.jsx(Ns,{ref:a,"data-slot":"alert-dialog-content",role:"alertdialog","aria-modal":"true","aria-labelledby":r,className:D("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...s,children:o})]})});Lt.displayName=Ns.displayName;function ra({className:e,...t}){return n.jsx("div",{"data-slot":"alert-dialog-header",className:D("flex flex-col gap-2 text-center sm:text-left",e),...t})}function na({className:e,...t}){return n.jsx("div",{"data-slot":"alert-dialog-footer",className:D("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...t})}function oa({className:e,...t}){return n.jsx(La,{"data-slot":"alert-dialog-title",className:D("text-lg font-semibold",e),...t})}function ia({className:e,...t}){return n.jsx(_a,{"data-slot":"alert-dialog-description",className:D("text-muted-foreground text-sm",e),...t})}const la=u.forwardRef(({className:e,...t},s)=>n.jsx(js,{ref:s,className:D(At(),e),...t}));la.displayName=js.displayName;const ca=u.forwardRef(({className:e,...t},s)=>n.jsx(Rs,{ref:s,className:D(At({variant:"outline"}),e),...t}));ca.displayName=Rs.displayName;function Xn({isOpen:e,timeRemaining:t,onExtendSession:s,onLogout:a}){const[r,o]=u.useState(Math.ceil(t/1e3));u.useEffect(()=>{if(!e)return;const i=setInterval(()=>{const c=Math.ceil(t/1e3);o(c),c<=0&&a()},1e3);return()=>clearInterval(i)},[e,t,a]);const l=i=>{const c=Math.floor(i/60),m=i%60;return`${c}:${m.toString().padStart(2,"0")}`};return n.jsx(sa,{open:e,children:n.jsxs(Lt,{className:"sm:max-w-md",children:[n.jsxs(ra,{children:[n.jsxs(oa,{className:"flex items-center gap-2",children:[n.jsx(Ha,{className:"h-5 w-5 text-amber-500"}),"Session Timeout Warning"]}),n.jsxs(ia,{className:"space-y-2",children:[n.jsx("p",{children:"Your session will expire due to inactivity. You will be automatically logged out in:"}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-3xl font-mono font-bold text-amber-600",children:l(r)}),n.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"minutes:seconds"})]}),n.jsx("p",{className:"text-sm text-gray-600",children:'Click "Stay Logged In" to extend your session, or you will be redirected to the login page.'})]})]}),n.jsxs(na,{className:"flex gap-2",children:[n.jsx(fe,{variant:"outline",onClick:a,className:"flex-1",children:"Logout Now"}),n.jsxs(fe,{onClick:s,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[n.jsx(Ga,{className:"h-4 w-4 mr-2"}),"Stay Logged In"]})]})]})})}var eo=(e,t,s,a,r,o,l,i)=>{let c=document.documentElement,m=["light","dark"];function d(b){(Array.isArray(e)?e:[e]).forEach(v=>{let S=v==="class",E=S&&o?r.map(N=>o[N]||N):r;S?(c.classList.remove(...E),c.classList.add(o&&o[b]?o[b]:b)):c.setAttribute(v,b)}),f(b)}function f(b){i&&m.includes(b)&&(c.style.colorScheme=b)}function p(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(a)d(a);else try{let b=localStorage.getItem(t)||s,v=l&&b==="system"?p():b;d(v)}catch{}},to=u.createContext(void 0),so={setTheme:e=>{},themes:[]},ao=()=>{var e;return(e=u.useContext(to))!=null?e:so};u.memo(({forcedTheme:e,storageKey:t,attribute:s,enableSystem:a,enableColorScheme:r,defaultTheme:o,value:l,themes:i,nonce:c,scriptProps:m})=>{let d=JSON.stringify([s,t,o,e,i,l,a,r]).slice(1,-1);return u.createElement("script",{...m,suppressHydrationWarning:!0,nonce:typeof window>"u"?c:"",dangerouslySetInnerHTML:{__html:`(${eo.toString()})(${d})`}})});const us=({...e})=>{const{theme:t="system"}=ao(),{announce:s}=Tt();return u.useEffect(()=>{if(!s||!w)return;const a=w.success?.bind(w)??null,r=w.error?.bind(w)??null,o=w.message?.bind(w)??null,l=w.info?.bind(w)??null,i=w.warning?.bind(w)??null,c=w.loading?.bind(w)??null;a&&(w.success=((d,f)=>{try{let p="";typeof d=="string"?(p=d,f&&typeof f.description=="string"&&(p=`${p}. ${f.description}`)):d&&typeof d=="object"?(p=d?.title??d?.message??"",d?.description&&(p=`${p}. ${d.description}`)):p="Success",s(String(p),"polite")}catch{}return a(d,f)})),r&&(w.error=((d,f)=>{try{let p="";typeof d=="string"?(p=d,f&&typeof f.description=="string"&&(p=`${p}. ${f.description}`)):d&&typeof d=="object"?(p=d?.title??d?.message??"",d?.description&&(p=`${p}. ${d.description}`)):p="Error",s(String(p),"assertive")}catch{}return r(d,f)})),i&&(w.warning=((d,f)=>{try{let p="";typeof d=="string"?(p=d,f&&typeof f.description=="string"&&(p=`${p}. ${f.description}`)):d&&typeof d=="object"?(p=d?.title??d?.message??"",d?.description&&(p=`${p}. ${d.description}`)):p="Warning",s(String(p),"polite")}catch{}return i(d,f)})),o&&(w.message=((d,f)=>{try{const p=typeof d=="string"?f&&typeof f.description=="string"?`${d}. ${f.description}`:d:d&&typeof d=="object"?`${d?.title??d?.message??""}${d?.description?`. ${d.description}`:""}`:String(d??"");s(String(p),"polite")}catch{}return o(d,f)})),l&&(w.info=((d,f)=>{try{const p=typeof d=="string"?f&&typeof f.description=="string"?`${d}. ${f.description}`:d:d&&typeof d=="object"?`${d?.title??d?.message??""}${d?.description?`. ${d.description}`:""}`:String(d??"");s(String(p),"polite")}catch{}return l(d,f)})),c&&(w.loading=((d,f)=>{try{const p=typeof d=="string"?d:d?.toString?.()??"Loading";s(String(p),"polite")}catch{}return c(d,f)}));const m=w.promise?.bind(w);return m&&(w.promise=(d,f,p)=>{try{d.then(b=>{try{let v=typeof f?.success=="function"?f.success(b):f?.success;if(v&&typeof v=="object"){const S=v?.title??v?.message??"",E=v?.description??"";v=E?`${S}. ${E}`:S}v&&s(String(v),"polite")}catch{}}).catch(b=>{try{let v=typeof f?.error=="function"?f.error(b):f?.error;if(v&&typeof v=="object"){const S=v?.title??v?.message??"",E=v?.description??"";v=E?`${S}. ${E}`:S}v&&s(String(v),"assertive")}catch{}})}catch{}return m(d,f,p)}),()=>{try{a&&(w.success=a),r&&(w.error=r),i&&(w.warning=i),o&&(w.message=o),l&&(w.info=l),c&&(w.loading=c)}catch{}}},[s]),n.jsx(Wa,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-white group-[.toaster]:text-gray-900 group-[.toaster]:border-gray-300 group-[.toaster]:shadow-lg",title:"group-[.toast]:text-gray-900 group-[.toast]:font-semibold",description:"!group-[.toast]:text-gray-900",actionButton:"group-[.toast]:bg-blue-600 group-[.toast]:text-white group-[.toast]:hover:bg-blue-700",cancelButton:"group-[.toast]:bg-gray-200 group-[.toast]:text-gray-800 group-[.toast]:hover:bg-gray-300",error:"group-[.toaster]:bg-red-50 group-[.toaster]:text-red-900 group-[.toaster]:border-red-300",success:"group-[.toaster]:bg-green-50 group-[.toaster]:text-green-900 group-[.toaster]:border-green-300",warning:"group-[.toaster]:bg-amber-50 group-[.toaster]:text-amber-900 group-[.toaster]:border-amber-300",info:"group-[.toaster]:bg-blue-50 group-[.toaster]:text-blue-900 group-[.toaster]:border-blue-300"}},style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...e})},ro=({timeout:e,onIdle:t,onActive:s,onWarning:a,warningTime:r=300*1e3,disabled:o=!1})=>{const[l,i]=u.useState(!1),[c,m]=u.useState(e),d=u.useRef(null),f=u.useRef(null),p=u.useRef(null),b=u.useRef(Date.now()),v=u.useCallback(()=>{d.current&&(clearTimeout(d.current),d.current=null),f.current&&(clearTimeout(f.current),f.current=null),p.current&&(clearInterval(p.current),p.current=null)},[]),S=u.useCallback(()=>{const P=Date.now()+e;p.current=setInterval(()=>{const O=Date.now(),$=Math.max(0,P-O);m($),$<=0&&(v(),i(!0),t())},1e3)},[e,t,v]),E=u.useCallback(()=>{if(o)return;v(),b.current=Date.now(),m(e),l&&(i(!1),s?.()),S();const A=e-r;A>0&&(f.current=setTimeout(()=>{a?.(r)},A)),d.current=setTimeout(()=>{i(!0),t()},e)},[o,e,r,l,t,s,a,v,S]),N=u.useCallback(()=>{E()},[E]);return u.useEffect(()=>{if(o){v();return}const A=["mousedown","mousemove","keypress","scroll","touchstart","click"];let P=null;const O=()=>{P||(P=setTimeout(()=>{P=null},1e3),E())};return A.forEach($=>{document.addEventListener($,O,!0)}),E(),()=>{A.forEach($=>{document.removeEventListener($,O,!0)}),v(),P&&clearTimeout(P)}},[o,E,v]),u.useEffect(()=>()=>{v()},[v]),{isIdle:l,timeRemaining:c,extendSession:N,resetTimer:E}},no=te.lazy(()=>Ct(()=>import("./AdminDashboard-CTwKuHD4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),oo=te.lazy(()=>Ct(()=>import("./FacultyDashboard-CC17b9pt.js"),__vite__mapDeps([13,1,2,3,4,5,6,7,8,9,10,11,12,14]))),io=te.lazy(()=>Ct(()=>import("./SignupHistoryPage-Dgwmultq.js"),__vite__mapDeps([15,1,2,3,7,6,8,9,10,11,12])));function lo(){const[e,t]=u.useState(null),[s,a]=u.useState([]),[r,o]=u.useState([]),[l,i]=u.useState([]),[c,m]=u.useState([]),[d,f]=u.useState([]),[p,b]=u.useState([]),[v,S]=u.useState(!0),[E,N]=u.useState(!1),[A,P]=u.useState(null),[O,$]=u.useState(!1),[nt,je]=u.useState(0),[ge,he]=u.useState(null),We=u.useMemo(()=>e?d.filter(y=>y.facultyId===e.id):[],[d,e]),Qe=u.useMemo(()=>e?r.filter(y=>y.facultyId===e.id):[],[r,e]),re=u.useCallback(y=>{if(console.log(" Setting up real-time data listeners..."),!y){b([]),a([]),i([]),o([]),f([]),_e.cleanup();return}try{S(!0),_e.subscribeToData(y,{onClassroomsUpdate:g=>{console.log(" Real-time update: Classrooms",g.length),a(g)},onBookingRequestsUpdate:g=>{console.log(" Real-time update: Booking Requests",g.length),o(g)},onSchedulesUpdate:g=>{console.log(" Real-time update: Schedules",g.length),f(g)},onSignupRequestsUpdate:y.role==="admin"?g=>{console.log(" Real-time update: Signup Requests",g.length),i(g)}:void 0,onSignupHistoryUpdate:y.role==="admin"?g=>{console.log(" Real-time update: Signup History",g.length),m(g)}:void 0,onUsersUpdate:y.role==="admin"?g=>{console.log(" Real-time update: Users",g.length),b(g)}:void 0,onError:g=>{console.error(" Real-time listener error:",g),w.error("Real-time sync error. Some data may be outdated.")}}),y.role==="faculty"?(b([y]),i([]),m([])):y.role==="admin"&&Rt.getAll().then(g=>{console.log(" Loaded signup history:",g.length),m(g)}).catch(g=>{console.error(" Failed to load signup history:",g);try{const x=g instanceof Error?g.message:String(g);w.error("Failed to load signup history",{description:x||"Please refresh the page or try again later.",duration:7e3})}catch(x){console.warn("Could not show toast for signup history error:",x)}}),console.log(" Real-time listeners setup complete")}catch(g){console.error(" Failed to setup real-time listeners:",g),w.error("Failed to setup real-time data sync")}finally{S(!1)}},[]),T=u.useCallback(async(y,g)=>{const x=J.signIn(y,g);w.promise(x,{success:h=>h?(t(h),re(h),`${h.role==="admin"?"Welcome back, Administrator":"Welcome back"}, ${h.name}!`):"Login failed. Please check your credentials.",error:h=>h instanceof Error?h.message:"An unknown login error occurred.",duration:4e3});try{return!!await x}catch{return!1}},[re]);u.useCallback(async(y,g)=>{try{const x=await J.signIn(y,g);if(x){t(x);const h=x.role==="admin"?"Welcome back, Administrator":"Welcome back";return w.success(`${h}, ${x.name}!`,{description:`You're logged in as ${x.role==="admin"?"Administrator":"Faculty"}`,duration:4e3}),re(x),!0}return y&&g&&w.error("Invalid credentials",{description:"Please check your email and password and try again."}),!1}catch(x){if(console.error("Login error:",x),x instanceof Error&&"status"in x){const k=x.status;if(k==="pending")return w.info("Awaiting approval",{description:"Your account is pending administrator approval. Watch your email for updates.",duration:6e3}),!1;if(k==="rejected")return w.error("Account rejected",{description:"Please contact the administrator for assistance.",duration:6e3}),!1}let h="Please check your email and password and try again.";if(x&&typeof x=="object"&&"code"in x){const k=x.code;switch(k){case"auth/invalid-email":h="Invalid email address format.";break;case"auth/user-not-found":h="No account found with this email address.";break;case"auth/wrong-password":h="Incorrect password. Please try again.";break;case"auth/too-many-requests":h="Too many login attempts from this device. Access temporarily restricted by Firebase security. Please wait 15-30 minutes or try password reset.";break;case"auth/user-disabled":h="This account has been disabled.";break;case"permission-denied":h="Permission denied. Please contact administrator.";break;default:"message"in x&&typeof x.message=="string"?h=x.message:h=`Authentication error: ${k}`}}else x instanceof Error&&x.message&&(x.message.includes("Account locked")||x.message.includes("Account is locked")||x.message.includes("attempts remaining"),h=x.message);return w.error("Login failed",{description:h,duration:6e3}),!1}},[re]);const R=u.useCallback(async(y,g,x,h)=>{try{try{if(await J.getCurrentUser()&&await Oe.getByEmail(y))return w.error("Request already pending",{description:"Please wait for an administrator to review your existing request."}),!1}catch(I){console.warn("Could not check for existing requests (possibly unauthenticated):",I instanceof Error?I.message:I)}let k;try{k=(await J.registerFaculty(y,h,g,x)).request}catch(I){if(I?.code==="auth/email-already-in-use")return console.log("Signup failed: email already in use. Directing user to sign in."),w.error("Account already exists",{description:"This email is already associated with an account. Please sign in or use the password reset link if you forgot your password.",duration:8e3}),!1;throw I}i(I=>{const U=I.filter(V=>V.id!==k.id);return[k,...U]});try{if(await J.getCurrentUser()){const U=await Me.getByEmail(y);U&&b(V=>[...V.filter(we=>we.id!==U.id),U])}}catch(I){console.warn("Could not load user data (possibly unauthenticated):",I instanceof Error?I.message:I)}return k&&w.success("Signup request submitted!",{description:"Your account has been created with pending status. An administrator will approve your access shortly.",duration:6e3}),!0}catch(k){console.error("Signup error:",k);let I="Unable to submit signup request.";if(k&&typeof k=="object")if("code"in k){const U=k.code;switch(U){case"auth/email-already-in-use":I="This email already has an account. Try signing in or resetting your password.";break;case"auth/weak-password":I="Password should be at least 6 characters and hard to guess.";break;case"auth/password-does-not-meet-requirements":I="Password must contain uppercase letter, lowercase letter, number, and special character.";break;case"permission-denied":I="Permission denied. Please check Firebase security rules.";break;default:"message"in k&&typeof k.message=="string"?I=k.message:I=`Firebase error: ${U}`}}else"message"in k&&typeof k.message=="string"&&(I=k.message);else k instanceof Error&&k.message&&(I=k.message);return w.error("Signup failed",{description:I,duration:8e3}),!1}},[]),z=u.useCallback(async()=>{try{console.log(" Logout clicked - user:",e?.email),await J.signOut(),sessionStorage.setItem("logoutSuccess","true"),t(null),_e.cleanup(),a([]),o([]),i([]),f([]),b([]),console.log(" User state cleared")}catch(y){console.error(" Logout error:",y),t(null),sessionStorage.setItem("logoutError","true"),_e.cleanup(),a([]),o([]),i([]),f([]),b([])}},[e]),ne=u.useCallback(async()=>{console.log(" Session expired due to inactivity");try{await J.signOutDueToIdleTimeout(),sessionStorage.setItem("sessionExpired","true"),t(null),a([]),o([]),i([]),f([]),b([]),$(!1)}catch(y){console.error(" Idle timeout logout error:",y),sessionStorage.setItem("sessionExpired","true"),t(null),$(!1)}},[]),Re=u.useCallback(y=>{console.log(` Session warning - ${Math.ceil(y/1e3)}s remaining`),je(y),$(!0),w.warning("Session Expiring Soon",{description:`Your session will expire in ${Math.ceil(y/6e4)} minutes due to inactivity`,duration:8e3})},[]),Pe=u.useCallback(()=>{console.log(" Session extended by user"),$(!1),w.success("Session extended successfully")},[]),{extendSession:_t}=ro({timeout:1800*1e3,warningTime:300*1e3,onIdle:ne,onWarning:Re,disabled:!e}),Ue=u.useCallback(async y=>{a(y)},[]),ye=u.useCallback(async(y,g,x,h,k=!1,I)=>{if(k&&$e(g,tt(x)))return!0;try{return await et.checkConflicts(y,g,x,h,I)}catch(U){return console.error("Error checking conflicts:",U),w.error("Failed to check for conflicts"),!0}},[]),Ft=u.useCallback(async y=>{try{if($e(y.date,tt(y.startTime))){w.error("Cannot request time slots that have already passed");return}if(await ye(y.classroomId,y.date,y.startTime,y.endTime,!1)){w.error("Classroom conflict detected - time slot already booked or has pending request");return}const x=await et.create(y);o(h=>[...h,x]),w.success("Reservation request submitted!")}catch(g){console.error("Booking request error:",g);const x=g instanceof Error?g.message:"";x.includes("conflict")||x.includes("duplicate")?w.error("Request failed: time slot was just booked by another user"):w.error("Failed to submit booking request. Please try again.")}},[ye]),Dt=u.useCallback(async(y,g,x)=>{try{const h=r.find(U=>U.id===y);if(!h){w.error("Request not found");return}if(h.status!=="pending"){w.error("Request has already been processed");return}if(g){if($e(h.date,tt(h.startTime))){w.error("Cannot approve: booking time has already passed");return}if(await ye(h.classroomId,h.date,h.startTime,h.endTime,!1,y)){w.error("Cannot approve: conflicts with existing confirmed booking. Please reject this request.");return}}const k={status:g?"approved":"rejected"};x&&x.trim()&&(k.adminFeedback=x.trim());const I=await et.update(y,k);if(o(U=>U.map(V=>V.id===y?I:V)),g){const U=await ft.create({classroomId:h.classroomId,classroomName:h.classroomName,facultyId:h.facultyId,facultyName:h.facultyName,date:h.date,startTime:h.startTime,endTime:h.endTime,purpose:h.purpose,status:"confirmed"});f(V=>[...V,U])}w.success(g?"Reservation approved!":"Reservation rejected.")}catch(h){console.error("Approval error:",h),w.error("Failed to process request")}},[r]),qt=u.useCallback(async(y,g,x,h=!1)=>{try{const k=l.find(U=>U.id===y);if(!k){w.error("Request not found");return}if(k.status!=="pending"){w.error("Request has already been processed");return}const I=new Date().toISOString();if(g){const U=await Oe.update(y,{status:"approved",adminFeedback:x||"Account approved",resolvedAt:I}),V=await Me.updateStatus(k.userId,"approved",{name:k.name,department:k.department,role:"faculty"});i(Z=>Z.map(we=>we.id===y?U:we)),b(Z=>{const we=Z.findIndex(ga=>ga.id===V.id);if(we===-1)return[...Z,V];const zt=[...Z];return zt[we]=V,zt}),w.success(`Faculty account approved for ${k.name}!`,{description:"They can now sign in with the password they created during signup.",duration:8e3})}else{if(!x||!x.trim()){w.error("Feedback is required when rejecting a request");return}if(!e){w.error("Admin user information not available");return}if(h){try{const U=await Oe.rejectAndCleanup(y,e.id,x.trim());i(V=>V.filter(Z=>Z.id!==y)),m(V=>[U,...V]),b(V=>V.filter(Z=>Z.id!==k.userId)),w.success(`Signup request rejected for ${k.name}.`,{description:"The account has been completely removed. They can submit a new signup request.",duration:6e3})}catch(U){console.error("Signup rejection error (bulk):",U),w.error("Failed to reject signup request")}return}he({requestId:y,userId:k.userId,feedback:x.trim(),requestName:k.name});return}}catch(k){console.error("Signup approval error:",k);const I=k instanceof Error?k.message:"Unknown error occurred";w.error("Failed to process signup request",{description:I,duration:5e3})}},[l]),Bt=u.useCallback(async y=>{try{await ft.cancelApprovedBooking(y),f(g=>g.map(x=>x.id===y?{...x,status:"cancelled"}:x)),w.success("Reservation cancelled!")}catch(g){console.error("Cancel schedule error:",g),w.error("Failed to cancel booking")}},[]),Ot=u.useCallback(async y=>{try{const g=d.find(x=>x.facultyId===r.find(h=>h.id===y)?.facultyId&&x.date===r.find(h=>h.id===y)?.date&&x.startTime===r.find(h=>h.id===y)?.startTime&&x.endTime===r.find(h=>h.id===y)?.endTime&&x.classroomId===r.find(h=>h.id===y)?.classroomId);g&&(await ft.cancelApprovedBooking(g.id),f(x=>x.map(h=>h.id===g.id?{...h,status:"cancelled"}:h))),await et.update(y,{status:"cancelled",adminFeedback:"Reservation cancelled by administrator"}),o(x=>x.map(h=>h.id===y?{...h,status:"cancelled",adminFeedback:"Reservation cancelled by administrator"}:h)),w.success("Approved reservation cancelled!")}catch(g){console.error("Cancel approved booking error:",g),w.error("Failed to cancel approved booking")}},[d,r]),$t=u.useCallback(async y=>{try{const g=await Me.unlockAccount(y);b(x=>x.map(h=>h.id===y?g:h)),w.success("Account unlocked successfully!",{description:`${g.name}'s account has been unlocked and can now login.`,duration:5e3})}catch(g){console.error("Unlock account error:",g),w.error("Failed to unlock account",{description:"Please try again or contact support.",duration:5e3})}},[]),da=u.useCallback(async()=>{if(!ge||!e)return;const{requestId:y,userId:g,feedback:x,requestName:h}=ge;try{const k=await Oe.rejectAndCleanup(y,e.id,x);i(I=>I.filter(U=>U.id!==y)),m(I=>[k,...I]),b(I=>I.filter(U=>U.id!==g)),w.success(`Signup request rejected for ${h}.`,{description:"The account has been completely removed. They can submit a new signup request.",duration:6e3})}catch(k){console.error("Failed to reject signup request:",k),w.error("Failed to reject signup request")}finally{he(null)}},[ge,e]),Mt=u.useCallback(()=>{he(null),w.info("Rejection cancelled")},[]),ua=u.useMemo(()=>({user:e,classrooms:s,bookingRequests:r,signupRequests:l,signupHistory:c,schedules:d,users:p,onLogout:z,onClassroomUpdate:Ue,onRequestApproval:Dt,onSignupApproval:qt,onCancelSchedule:Bt,onCancelApprovedBooking:Ot,onUnlockAccount:$t,checkConflicts:ye}),[e,s,r,l,c,d,p,z,Ue,Dt,qt,Bt,Ot,$t,ye]),ma=u.useMemo(()=>({user:e,classrooms:s,schedules:We,allSchedules:d,bookingRequests:Qe,allBookingRequests:r,onLogout:z,onBookingRequest:Ft,checkConflicts:ye}),[e,s,We,d,Qe,r,z,Ft,ye]);if(u.useEffect(()=>{(async()=>{try{console.log(" Initializing app...");const g=await J.getCurrentUser();g?(console.log(" Valid user session found:",g.email),t(g),console.log(" Setting up real-time listeners..."),re(g),console.log(" Real-time listeners setup")):console.log(" No valid session found"),console.log(" App initialized successfully")}catch(g){console.error(" Failed to initialize app:",g);const x=g instanceof Error?g.message:"Unknown error";P(`Failed to load application data: ${x}. Please refresh the page.`)}finally{console.log(" Setting isLoading to false"),N(!0),S(!1)}})()},[re]),u.useEffect(()=>{const{data:{subscription:y}}=J.onAuthStateChange(async g=>{console.log(" Auth state changed, new user:",g?.email||"none"),t(x=>{if(x?.id===g?.id)return console.log(" Same user, skipping update"),x;if(g&&!x){console.log(" New user detected, setting up listeners...");try{re(g)}catch(h){console.error("Failed to setup listeners after auth change:",h)}}return g})},g=>{console.error("Auth error:",g),w.error("Authentication Error",{description:g,duration:8e3})});return()=>{y.unsubscribe(),_e.cleanup()}},[]),u.useEffect(()=>{e||(sessionStorage.getItem("logoutSuccess")==="true"&&(sessionStorage.removeItem("logoutSuccess"),w.success("Logged out successfully",{description:"You have been signed out",duration:4e3})),sessionStorage.getItem("logoutError")==="true"&&(sessionStorage.removeItem("logoutError"),w.error("Logged out with errors",{description:"Please refresh if you experience any issues",duration:5e3})),sessionStorage.getItem("sessionExpired")==="true"&&(sessionStorage.removeItem("sessionExpired"),w.warning("Session expired",{description:"You have been logged out due to inactivity",duration:5e3})))},[e]),te.useEffect(()=>{},[e]),A)return n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-pink-50 flex items-center justify-center",children:n.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[n.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-red-500 to-pink-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4",children:n.jsx("div",{className:"text-white text-lg font-bold",children:"!"})}),n.jsx("h1",{className:"text-2xl font-bold text-red-800 mb-4",children:"Application Error"}),n.jsx("p",{className:"text-red-600 mb-6",children:A}),n.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Refresh Page"}),n.jsx(Je,{})]})});if(!E||v)return n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-full flex items-center justify-center shadow-lg mx-auto mb-4 animate-pulse",children:n.jsx("div",{className:"text-white text-lg font-bold",children:"PLV"})}),n.jsx("p",{className:"text-gray-600",children:"Loading..."}),n.jsx(Je,{})]})});if(!e)return n.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex flex-col",children:[n.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:n.jsxs("div",{className:"text-center space-y-8 w-full max-w-md",children:[n.jsxs("div",{children:[n.jsx("div",{className:"flex justify-center mb-6",children:n.jsx("div",{className:"h-24 w-24 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-full flex items-center justify-center shadow-lg",children:n.jsx("div",{className:"text-white text-2xl font-bold",children:"PLV"})})}),n.jsx("p",{className:"text-blue-600 mb-2",children:"PLV CEIT"}),n.jsx("h1",{className:"mb-6",children:"Digital Classroom"}),n.jsx("p",{className:"text-gray-600 mb-8",children:"Streamlined classroom assignment and reservation system for PLV CEIT."})]}),n.jsx("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/20",children:n.jsx(Kn,{onLogin:T,onSignup:R,users:p})})]})}),n.jsx(ds,{}),n.jsx(us,{}),n.jsx(Je,{})]});const fa=e;function pa(){const{enabled:y,setEnabled:g,announce:x,useTTS:h,setUseTTS:k}=Tt(),I=te.useRef(!1);te.useEffect(()=>{I.current=!0},[]);const U=()=>{if(g(!y),I.current)try{x(y?"Screen reader disabled":"Screen reader enabled","polite")}catch{}},V=()=>{if(k(!h),I.current)try{x(h?"Browser text to speech disabled":"Browser text to speech enabled","polite")}catch{}};return n.jsxs("div",{className:"fixed bottom-4 left-4 z-40 flex items-center gap-2",children:[n.jsx("button",{onClick:U,className:"bg-white/90 text-xs px-2 py-1 rounded-full border shadow-sm","aria-pressed":y?"true":"false","aria-label":y?"Disable screen reader announcements":"Enable screen reader announcements",title:y?"Disable screen reader announcements":"Enable screen reader announcements",children:y?"SR: On":"SR: Off"}),n.jsx("button",{onClick:V,className:"bg-white/90 text-xs px-2 py-1 rounded-full border shadow-sm","aria-pressed":h?"true":"false","aria-label":h?"Disable browser text to speech":"Enable browser text to speech",title:h?"Disable browser text to speech":"Enable browser text to speech",children:h?"TTS: On":"TTS: Off"})]})}return n.jsx(Jn,{children:n.jsx(Nn,{children:n.jsxs(on,{children:[n.jsx("a",{href:"#main",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-white text-blue-700 px-3 py-2 rounded shadow",children:"Skip to main"}),n.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[n.jsx(pa,{}),n.jsx("div",{className:"flex-1",children:n.jsx(u.Suspense,{fallback:n.jsx("div",{className:"p-8 flex items-center justify-center",children:n.jsx("div",{className:"text-gray-600",children:"Loading"})}),children:n.jsxs(an,{children:[n.jsx(yt,{path:"/admin/signups/history/:id?",element:n.jsx(io,{signupHistory:c})}),n.jsx(yt,{path:"/*",element:fa.role==="admin"?n.jsx(no,{...ua}):n.jsx(oo,{...ma})})]})})}),n.jsx(ds,{}),n.jsx(Xn,{isOpen:O,timeRemaining:nt,onExtendSession:()=>{_t(),Pe()},onLogout:ne}),n.jsx(us,{}),n.jsx(sa,{open:!!ge,onOpenChange:y=>{y||Mt()},children:n.jsxs(Lt,{children:[n.jsxs(ra,{children:[n.jsx(oa,{children:"Reject and Delete Account?"}),n.jsxs(ia,{children:["This will permanently delete the account and associated data for"," ",n.jsx("strong",{children:ge?.requestName}),". This action cannot be undone."]})]}),n.jsxs(na,{children:[n.jsx(ca,{onClick:Mt,children:"Cancel"}),n.jsx(la,{onClick:da,className:"ml-2 bg-red-600 text-white",children:"Confirm Delete"})]})]})}),n.jsx(Je,{})]})]})})})}cr.createRoot(document.getElementById("root")).render(n.jsx(te.StrictMode,{children:n.jsx(lo,{})}));export{sa as A,fe as B,vo as C,jn as D,kn as E,So as F,jo as G,Ae as H,de as I,No as J,Eo as K,oe as L,ft as M,et as N,qn as O,J as P,bo as Q,xo as R,xn as S,En as T,Qs as a,Ks as b,D as c,Cn as d,Js as e,Zs as f,zs as g,bn as h,Vs as i,Hs as j,ko as k,$e as l,tt as m,Ro as n,Co as o,Lt as p,ra as q,oa as r,ia as s,na as t,Tt as u,ca as v,la as w,Gs as x,bt as y,vt as z};
