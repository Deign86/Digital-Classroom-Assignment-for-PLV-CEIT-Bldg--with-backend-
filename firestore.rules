rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Users collection
    match /users/{userId} {
      allow read: if request.auth != null;
      // Allow users to write their own documents OR allow admin emails to write any user document
      allow write: if (request.auth != null && request.auth.uid == userId) || 
                      (request.auth != null && request.auth.token.email in ['admin@plv.edu.ph', 'registrar@plv.edu.ph']);
    }
    
    // Classrooms collection - Anyone authenticated can read and write (temporary fix)
    match /classrooms/{classroomId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // Booking Requests collection
    match /bookingRequests/{requestId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update: if request.auth != null;
      allow delete: if request.auth != null;
    }
    
    // Schedules collection - Allow users to update their own schedules
    match /schedules/{scheduleId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update: if request.auth != null && 
                      (resource.data.facultyId == request.auth.uid || 
                       request.auth != null);
      allow delete: if request.auth != null;
    }
    
    // Signup Requests collection - Simple rules for signup approvals
    match /signupRequests/{requestId} {
      // Anyone authenticated can read signup requests 
      allow read: if request.auth != null;
      // Allow anyone to create signup requests (for initial signup)
      allow create: if true;
      // Anyone authenticated can update (approve/reject) signup requests  
      allow update: if request.auth != null;
      // Anyone authenticated can delete signup requests
      allow delete: if request.auth != null;
    }
  }
}
